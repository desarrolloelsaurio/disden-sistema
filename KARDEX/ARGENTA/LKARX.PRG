LAFECHA=GOMON(DATE(),-1)
CLOSE DATA
SELE 1
USE KARDEX ALIAS KAR
CREATE TABLE RESUMEN.DBF (ARTICULO C(20),;
STOCK N(10),VENDIDO N(10),COMPRADO N(10),MERMA N(10))
USE
USE RESUMEN ALIAS RES
INDE ON ARTICULO TAG ARTICULO OF RESUMEN
SELE KAR
SET ORDER TO TAG ARTICULO
SCAN
   SELE RES
   IF !SEEK(KAR.ARTICULO)
      APPE BLAN
      REPL ARTICULO WITH KAR.ARTICULO
   ENDIF
   IF KAR.FECHAOP<LAFECHA
      REPL STOCK WITH STOCK+KAR.ENTRADA-KAR.SALIDA
   ELSE
      IF KAR.DOCREF='RE' .AND. !EMPTY(KAR.SALIDA)
         REPL MERMA WITH MERMA+KAR.SALIDA
      ELSE
         IF !EMPTY(KAR.SALIDA)
            REPL VENDIDO WITH VENDIDO+KAR.SALIDA
         ELSE
            REPL COMPRADO WITH COMPRADO+KAR.ENTRADA
         ENDIF
      ENDIF
   ENDIF
   SELE KAR
ENDSCAN
SELE RES
BROW
