********************************************************************************
*-- Programa: KARX.PRG
*-- Fecha   : 09/29/92 11:46am
*-- Version : G. BANALOTTI
*-- Notas   : DERIVA A LISTADOS DE KARDEX
********************************************************************************
=OPKAR()
STORE NUL TO FECINI,FECFIN
STORE 2 TO FILFEC
STORE .T. TO QUEFEC
=MOVEWIN(15,30,19,50,'ALGO','Rango de Fechas')
LAFECHA=QW_FEC(1,1,'KAR.FECHAOP')
=RELEWIN('ALGO')
IF LASTKEY()#27
 CREATE TABLE RESUMEN.TMP (ARTICULO C(20),;
 STOCK N(10),VENDIDO N(10),COMPRADO N(10),MERMA N(10))
 USE
 SELE 21
 USE RESUMEN.TMP ALIAS RES
 INDE ON ARTICULO TAG ARTICULO OF RESUMEN
 SELE KAR
 SET ORDER TO TAG ARTICULO
 SCAN
   SELE RES
   IF !SEEK(KAR.ARTICULO)
      APPE BLAN
      REPL ARTICULO WITH KAR.ARTICULO
   ENDIF
   IF KAR.FECHAOP< M.FECINI
      REPL STOCK WITH STOCK+KAR.ENTRADA-KAR.SALIDA
   ELSE
     IF KAR.FECHAOP>= M.FECINI .AND. KAR.FECHAOP<= M.FECFIN
       IF KAR.DOCREF='RE' .AND. !EMPTY(KAR.SALIDA)
         REPL MERMA WITH MERMA+KAR.SALIDA
      ELSE
         IF !EMPTY(KAR.SALIDA)
            REPL VENDIDO WITH VENDIDO+KAR.SALIDA
         ELSE
            REPL COMPRADO WITH COMPRADO+KAR.ENTRADA
         ENDIF
      ENDIF
    ENDIF
   ENDIF
   SELE KAR
 ENDSCAN
 SELE RES
ENDIF
RETURN
