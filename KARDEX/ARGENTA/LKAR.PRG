FUNCTION LKAR
PARAMETER PORPAN
EXTERNAL REPORT LSTOPR
ULPR=HORA_ULP(PROGRAM())
IF CHEQSEG()
   DIJO=ALLTRIM(PROMPT())
   DO CASE
   CASE DIJO='Existencia por Remesa'
      =working()
      SET ORDER TO TAG PROCOD IN PRO
      SET ORDER TO TAG ARTICULO IN MER
      SELE REM
      SET ORDER TO TAG REMESA
      SET RELA TO PROVEEDOR INTO PRO
      SET RELA TO MERCA INTO MER ADDI
      IF PORPAN
         =REPORTE('LSTOPR')
      ELSE
         LARGOJA=36
         ULPR="LSTOIR"
         REPO FORM LSTOIR TO PRIN PDSETUP
      ENDIF
      =REOPKAR()
   CASE DIJO='Existencia por '+ruvro
      =working()
      SET ORDER TO TAG PROCOD IN PRO
      SET ORDER TO TAG ARTICULO IN MER
      SELE REM
      SET RELA TO PROVEEDOR INTO PRO
      SET RELA TO MERCA INTO MER ADDI
      IF TYPE("ORDMER")#'L' .OR. ORDMER
         IF TYPE("ORDPRO")#'L' .OR. ORDPRO
            INDEX ON merca+PROVEEDOR+STR(REMESA) TO (GENTMP()) FOR EMPTY(AGOTADA) COMP
         ELSE
            INDEX ON merca+PRO.PROVEEDOR+STR(REMESA) TO (GENTMP()) FOR EMPTY(AGOTADA) COMP
         ENDIF
      ELSE
         IF TYPE("ORDPRO")#'L' .OR. ORDPRO
            INDEX ON MER.PALPOPUP+PROVEEDOR+STR(REMESA) TO (GENTMP()) FOR EMPTY(AGOTADA) COMP
         ELSE
            INDEX ON MER.PALPOPUP+PRO.PROVEEDOR+STR(REMESA) TO (GENTMP()) FOR EMPTY(AGOTADA) COMP
         ENDIF
      ENDIF
      IF PORPAN
         =REPORTE('LSTOPRU')
      ELSE
         ULPR="LSTOIRU"
         REPO FORM LSTOIRU TO PRIN PDSETUP
      ENDIF
      =REOPKAR()
   ENDCASE
ELSE
   =IAUDI()
ENDIF
ULPR=PROGRAM()
=MEN_LIN(BOTOM)
RETURN
