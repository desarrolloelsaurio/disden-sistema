FUNCTION LKARF
#DEFINE CRLF CHR(13)+CHR(10)                     && CRLF
ULPR=HORA_ULP(PROGRAM())
=WORKING()
=DOTALK()
SELE KAR
SET ORDER TO
=FLOCK("KAR") .OR. FLOK("KAR")
TMP=GENTMP()
SORT ON TIPO,ARTICULO ;
TO (TMP) ;
FOR KAR.FECHAOP<=M.FECINI
USE (TMP) ALIAS KAR EXCL
SET DELE OFF
SET ORDER TO TAG AVICOD IN AVI
SET ORDER TO TAG TELCOD IN TEL
SET RELA TO ARTICULO INTO TEL
SET RELA TO ARTICULO INTO AVI ADDI
ACLA=PAIP+;
PADC("ARTICULO",10)+PAIP+;
PADC(ALLTRIM(TELLA)+"/"+ALLTRIM(ABIO),30)+PAIP+;
PADC("STOCK",XACDIGI-2)+PAIP+;
PADC("VALORIZ.",XACDIGI)+PAIP
M.LINEA=REPL("=",LEN(ACLA))
TT="LISTADO DE STOCK"+;
CRLF+;
"AL "+DATECOMP(M.FECINI)
STORE NUL TO CASOS,LACANTIDAD,ELTOT
GO TOP
ELART=KAR.ARTICULO
IF TIPO=LEFT(ABIOS,1)
   *** SON AVIOS
   ELNOM=AVI.AVIOS
   ELMONTO=AVI.MONTO
ELSE
   *** SON TELAS
   ELNOM=TEL.TELA
   ELMONTO=TEL.MONTO
ENDIF
=UNTALK()
=UNWORK()
IF PORPAN
   DO LKARFP
ELSE
   DO LKARFI
ENDIF
SET DELE ON
=REOPKAR()
RETURN MEN_LIN(BOTOM)
