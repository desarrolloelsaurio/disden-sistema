* LISTA DIFERENCIAS DE KARDEX CON STOCK
PROCEDURE DIFCKAR
PARAMETER EL_EMENTO,SOLODIF
EXTERNAL PROCEDURE DIFCKAR0
#DEFINE BOTOM  "  "+repl("°",78)                 && BOTOM
#DEFINE CRLF CHR(13)+CHR(10)                     && CRLF
#DEFINE PAIP   "|"                               && PAIP
=WORKING()
=DOTALK()
=OPAVIS()
=OPTELS()
=OPKARS()
SET ORDER TO
TMP=GENTMP()
TMP1=GENTMP()
TMP2=GENTMP()
SELE KARS
SET ORDER TO
=FLOCK() .OR. FLOK()
DO CASE
CASE EL_EMENTO="A"
   TT="Stock s/Avios - Stock s/Kardex"
   AUDI="Avios "
   SORT ON AVICODPRO TO (TMP) FOR !EMPTY(AVICODPRO)
   =UNLO_PRX("KARS",TMP,"TMPKAR")
   INDEX ON AVICODPRO TAG AVICODPRO
   SET ORDER TO TAG AVICODPRO
   TOTAL ON AVICODPRO FIELD ENTRADA,SALIDA TO (TMP1)
   =PRXAREA(.T.)
   USE (TMP1) ALIAS TMP1 EXCL
   SET ORDER TO TAG AVICODPRO IN AVIS
   SET RELA TO AVICODPRO INTO AVIS
   COPY TO (TMP2) ;
     FIELD AVICODPRO,TMP1.ENTRADA,TMP1.SALIDA,AVIS.STOCK,AVIS.STOCKRES,AVIS.STKRESPEN,AVIS.AVIO
   =PRXAREA(.T.)
   USE (TMP2) ALIAS TMP2 EXCL
   REPL ALL STOCKRES WITH ENTRADA-SALIDA
   ACLA=PAIP+;
     padc("C¢digo",20)+;
     paip+;
     PADC("Av¡o",30)
CASE EL_EMENTO="T"
   TT="Stock s/Telas - Stock s/Kardex"
   AUDI="Telas "
   SORT ON TELCODPRO TO (TMP) FOR !EMPTY(TELCODPRO)
   =UNLO_PRX("KARS",TMP,"TMPKAR")
   INDEX ON TELCODPRO TAG TELCODPRO
   SET ORDER TO TAG TELCODPRO
   TOTAL ON TELCODPRO FIELD ENTRADA,SALIDA TO (TMP1)
   =PRXAREA(.T.)
   USE (TMP1) ALIAS TMP1 EXCL
   SET ORDER TO TAG TELCODPRO IN TELS
   SET RELA TO TELCODPRO INTO TELS
   COPY TO (TMP2) ;
     FIELD TELCODPRO,TMP1.ENTRADA,TMP1.SALIDA,TELS.STOCK,TELS.STOCKRES,TELS.STKRESPEN,TELS.TELA
   =PRXAREA(.T.)
   USE (TMP2) ALIAS TMP2 EXCL
   REPL ALL STOCKRES WITH ENTRADA-SALIDA
   ACLA=PAIP+;
     padc("C¢digo",20)+;
     paip+;
     PADC("Tela",30)     
ENDCASE
IF SOLODIF
   TT=TT+CRLF+"Art¡culos con Diferencia"
   DELE FOR STOCK=STOCKRES
   audi=audi+" solo diferencias"
   PACK
ENDIF
REPL ALL STKRESPEN WITH STOCK-STOCKRES
=UNTALK()
=UNWORK()
ACLA=ACLA+paip+;
  PADC("Stk Stock",xacdigi)+;
  paip+;
  PADC("Stk Kardex",xacdigi)+;
  paip+;
  PADC("Diferencia",xacdigi)+;
  paip
=XPRN1(4,"TMP2","DIFCKAR0()",AUDI,"LDIF"+EL_EMENTO+"K")
=OFF_TMP()
RETURN MEN_LIN(BOTOM)
