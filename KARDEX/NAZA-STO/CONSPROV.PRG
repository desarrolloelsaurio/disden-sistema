#DEFINE CRLF CHR(13)+CHR(10)                     && CRLF
#DEFINE PAIP   "|"                               && PAIP
#DEFINE NUL  0
#DEFINE BOTOM  "  "+repl("°",78)                 && BOTOM
PARAMETER PORPAN
ULPR=HORA_ULP(PROGRAM())
IF CHEQSEG()
	ANIO=INFIC(YEAR(DATE()),"A¤o a Listar")
	IF LAST()#27 .AND. ;
			!EMPTY(M.ANIO) .AND. ;
			M.ANIO>1993
		=OPPRO()
		=OPKARS()
		=OPTELS()
		=OPAVIS()
		=WORKING()
		=DOTALK()
		SELE KARS
		TMP2=GENTMP()
		=FLOCK("KARS") .OR. FLOK("KARS")
		SORT ON FECHAOP FIELD;
			FECHAOP, SALIDA, AVICODPRO, TELCODPRO, AVIS.PROCOD;
			TO (TMP2) FOR ;
			(!EMPTY(AVICODPRO) .OR. !EMPTY(TELCODPRO)) .AND. ;
			YEAR(FECHAOP)=ANIO .AND. ;
			!EMPTY(SALIDA)
		UNLO IN KARS
		=PRXAREA(.T.)
		USE (TMP2) ALIAS TMP2 EXCL
		SET RELA TO AVICODPRO INTO AVIS
		REPL PROCOD WITH AVIS.PROCOD ,;
			SALIDA WITH AVIS.MONTO*SALIDA FOR ;
			!EMPTY(AVICODPRO)
		SET RELA TO TELCODPRO INTO TELS
		REPL PROCOD WITH TELS.PROCOD ,;
			SALIDA WITH TELS.MONTO*SALIDA FOR ;
			!EMPTY(TELCODPRO)
		SET RELA TO
		TMP=GENTMP()
		SET ORDER TO TAG CODCLI IN PER
		SET RELA TO PROCOD INTO PER
		SORT ON PER.CLIENTE FIELD ;
			FECHAOP, SALIDA, PER.CLIENTE, PROCOD;
			TO (TMP)
		=PRXAREA(.T.)
		USE (TMP) ALIAS TMP EXCL
		CREA CURSOR TEMPORAL (;
			E1 N(14,4),;
			E2 N(14,4),;
			E3 N(14,4),;
			E4 N(14,4),;
			E5 N(14,4),;
			E6 N(14,4),;
			E7 N(14,4),;
			E8 N(14,4),;
			E9 N(14,4),;
			E10 N(14,4),;
			E11 N(14,4),;
			E12 N(14,4),;
			FECHAOP D,;
			SALIDA N(14,4),;
			PROCOD C(10),;
			CLIENTE C(30))
		SET TALK OFF
		SCATTER TO KK BLANK
		SELE TMP
		SCAN
			ELMES=MONTH(TMP.FECHAOP)
			STORE TMP.SALIDA TO KK[ELMES], KK[14]
			KK[13]=TMP.FECHAOP
			KK[15]=TMP.PROCOD
			KK[16]=TMP.CLIENTE
			INSERT INTO TEMPORAL FROM ARRAY KK
			KK[ELMES]=0
		ENDS
		SET TALK ON
		SELE TEMPORAL
		TMP11=GENTMP()
		TOTAL ON PROCOD TO (TMP11)
		=PRXAREA(.T.)
		USE (TMP11) ALIAS TMP11
		=UNTALK()
		=UNWORK()
		TT="Listado de Consumos Por Proveedor Valorizado"+;
			crlf+"A¤o "+str(anio,4)
		ACLA=PAIP+PADC("PROVEEDOR",20)+PAIP
		FOR AX=1 TO 12
			ACLA=ACLA+PADC(QMES(AX),XACDIGI)+PAIP
		NEXT
		ACLA=ACLA+PADC("ANUAL",XACDIGI+2)+PAIP
		=LGRL2(PORPAN,"TMP11","CONSPRO0()","","CONSPRO")
		sele tmp11
		inde on SALIDA tag SALIDA DESCEND
		ACLA=PAIP+PADC("PROVEEDOR",20)+PAIP+PADC("MONTO ANUAL",16)+PAIP
		=LGRL2(PORPAN,"TMP11","CONSPRO0(.T.)","","CONSPRO")
		STOR NUL TO CASOS
		STORE '' TO LINEA
		ACLA=PAIP+PADC("MES",20)+PAIP+PADC("MONTO ANUAL",16)+PAIP
		PAG=1
		IF PORPAN
			=WIN0()
			=CABPAN()
			=TIT_LIN(1)
		ELSE
			=CABPRI()
			=CABPRI1()
			=TIT_LIN(3)
		ENDIF
		SELE TMP11
		SUM TO ARRAY TOTTAL
		STORE NUL TO ELTOT
		FOR A=1 TO 12
			?PAIP
			?? QMES(A)
			??PAIP AT 21
			?? TOTTAL[A] PICT "9,999,999,999.99"
			?? PAIP
		NEXT
		?M.LINEA
		?PAIP
		?? "TOTAL:"
		?? PAIP AT 21
		?? TOTTAL[13] PICT "9,999,999,999.99"
		?? PAIP
		IF PORPAN
		   =FIN_LIN(2)
           =RELEWIN("WIN")
        ELSE
		   =FIN_LIN(4)
		   =FINIMP()
		ENDIF
		=OFF_TMP()
	ENDIF
ELSE
	=IAUDI()
ENDIF
RETURN MEN_LIN(BOTOM)
