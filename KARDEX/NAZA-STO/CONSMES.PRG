PROCEDURE CONSMES
	#DEFINE CRLF CHR(13)+CHR(10)                  && CRLF
	#DEFINE BOTOM  "  "+repl("°",78)              && BOTOM
	#DEFINE PAIP   "|"                            && PAIP
	PARAMETER PORPAN,QTIP,C_VALOR,PORPROV
	ULPR=HORA_ULP(PROGRAM())
	IF CHEQSEG()
		ANIO=INFIC(YEAR(DATE()),"A¤o a Listar")
		IF LAST()#27 .AND. ;
				!EMPTY(M.ANIO) .AND. ;
				M.ANIO>1993
			=OPPRO()
			=OPKARS()
			=WORKING()
			=DOTALK()
			ACLA=PAIP
			DO CASE
			CASE QTIP="A"
				=OPAVIS()
				ACLA=ACLA+PADC("AVIO",20)
				SELE KARS
				TMP=GENTMP()
				=FLOCK("KARS") .OR. FLOK("KARS")
				IF PORPROV
					SET RELA TO AVICODPRO INTO AVIS
					SORT ON AVICODPRO FIELD;
						FECHAOP, SALIDA, AVICODPRO, TELCODPRO, AVIS.PROCOD;
						TO (TMP) FOR ;
						!EMPTY(AVICODPRO) .AND. ;
						YEAR(FECHAOP)=ANIO .AND. ;
						!EMPTY(SALIDA) .AND. ;
						AVIS.PROCOD=PER.CODCLI
					SET RELA TO 
				ELSE
					SORT ON AVICODPRO FIELD;
						FECHAOP, SALIDA, AVICODPRO, TELCODPRO, AVIS.PROCOD;
						TO (TMP) FOR ;
						!EMPTY(AVICODPRO) .AND. ;
						YEAR(FECHAOP)=ANIO .AND. ;
						!EMPTY(SALIDA)
				ENDIF
				UNLO IN KARS
				=PRXAREA(.T.)
				USE (TMP) ALIAS TMP EXCL
				ART="TMP.AVICODPRO"
				SET RELA TO AVICODPRO INTO AVIS
				IF C_VALOR
					** REEMPLAZO SALIDA POR CANTIDAD*SALIDA
					** (SIN MANOS)
					REPL SALIDA WITH AVIS.MONTO*SALIDA ALL
				ENDIF
			CASE QTIP="T"
				=OPTELS()
				ACLA=ACLA+PADC("TELA",20)
				SELE KARS
				TMP=GENTMP()
				=FLOCK("KARS") .OR. FLOK("KARS")
				IF PORPROV
					SET RELA TO TELCODPRO INTO TELS
					SORT ON TELCODPRO FIELD;
						FECHAOP, SALIDA, AVICODPRO, TELCODPRO, TELS.PROCOD;
						TO (TMP) FOR ;
						!EMPTY(TELCODPRO) .AND. ;
						YEAR(FECHAOP)=ANIO .AND. ;
						!EMPTY(SALIDA) .AND. ;
						TELS.PROCOD=PER.CODCLI
					SET RELA TO 
				ELSE
					SORT ON TELCODPRO FIELD;
						FECHAOP, SALIDA, AVICODPRO, TELCODPRO, TELS.PROCOD;
						TO (TMP) FOR ;
						!EMPTY(TELCODPRO) .AND. ;
						YEAR(FECHAOP)=ANIO .AND. ;
						!EMPTY(SALIDA)
				ENDIF
				UNLO IN KARS
				=PRXAREA(.T.)
				USE (TMP) ALIAS TMP EXCL
				ART="TMP.TELCODPRO"
				SET RELA TO TELCODPRO INTO TELS
				IF C_VALOR
					** REEMPLAZO SALIDA POR CANTIDAD*SALIDA
					** (SIN MANOS)
					REPL SALIDA WITH TELS.MONTO*SALIDA ALL
				ENDIF
			OTHERWISE
				ACLA=ACLA+PADC("COMPRA",20)
				********
				********  ACA NO SE QUE VA A IR !!!! 
				********
			ENDCASE
			IF PORPAN
				ACLA="|"
			ELSE
				ACLA=ACLA+PAIP+PADC("DENOMINACION",15)+PAIP
			ENDIF
			FOR AX=1 TO 12
 				ACLA=ACLA+" "+LEFT(QMES(AX),3)+" "+PAIP
			NEXT
			IF !PORPAN
				ACLA=ACLA+PADC("ANUAL",10)+PAIP
			ENDIF
			ACLA=ACLA+"P.PED"+PAIP
			=UNTALK()
			=UNWORK()
			TT="Listado de Consumo Mensual"+ IIF(C_VALOR, " Valorizado", "")+;
				crlf+"A¤o "+str(anio,4)+;
				IIF(PORPROV, CRLF+"Proveedor: "+ALLT(PER.CLIENTE),"")
			=IIF(PORPAN,CONSMESP(),CONSMESI())
			=OFF_TMP()
		ENDIF
	ELSE
		=IAUDI()
	ENDIF
RETURN MEN_LIN(BOTOM)
