*
*                         IMPRIME LIBRO DIARIO
*
* DIARIO1.PRG
*
IF HAYMOV()
	STORE " " TO T1,T2,RES,TR,AP,FISC,FISC1
	STORE 0 TO INICIO,FINAL,NPAG,MLIM
	STORE .F. TO PORFEC
	IF LISDIA("LIBRO DIARIO",.T.)
		WAIT "TRABAJANDO..." WIND NOWA
		=LISTADO4(.F.,.T.)
		STORE " " TO RES
		IF CONFIRM1("El Listado Requerido")
			SELE MOV1
			STORE 1 TO C
			DO TEST_IMP
			DO CABPRI
			??? CHR(27)
			??? CHR(15)
			AP="P"
			PERINI=KPERIODO
			TIT="LISTADO DE LIBRO DIARIO "+QUEAP(.t.)
			DO TITD1
			GO TOP
			STORE ASIENTO TO NROASI
			SCAN
				IF NROASI#ASIENTO
					? REPL("-",64)+STR(NROASI,5)+" "+REPL("-",64)
					STORE ASIENTO TO NROASI
				ENDIF
				? PAIPD
				?? STR(MOVIMIENTO,4)
				?? PAIP2
				?? STR(CODIGO,8)
				?? PAIP2
				?? LEFT(NOMBRE,20)
				?? PAIP2
				?? CONCEPTO
				?? PAIP2
				?? TRAN(FECHA,PICFEC)
				?? PAIP2
				?? TRAN(DEBE,PICU9)
				?? PAIP2
				?? TRAN(HABER,PICU9)
				?? PAIPI
				STORE C+1 TO C
				IF _PLINENO>66
					DO LINF WITH 67
					STORE NPAG+1 TO NPAG
					STORE 1 TO C
					DO TITD1
				ENDIF
			ENDS
			? REPL("-",64)+STR(NROASI,5)+" "+REPL("-",64)
			DO FINIMP
		ENDIF
		SELE MOV1
		=OFF_TMP()
	ENDIF
ENDIF
=MEN_LIN(SYSNOMBRE)
RETURN
