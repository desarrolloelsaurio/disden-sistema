**********************************
*-- Programa: CMI1.PRG
*-- Fecha   : 04-30-92 01:00pm
*-- Version : G. REINER
*-- Notas   : CORRIGE BASE MI1TA
**********************************
FUNCTION CMI1
	PARAMETER MENSAJE,texto,OTROS
	PRIVATE MENSAJE,texto,OTROS
	STOR RECNO() TO ff
	REGISTRO=STR(FF)
	STOR HORA_ULP(PROGRAM()) TO ULPR
	IF CHEQSEG()
		SELE MI1
		=LOCK(REGISTRO,"MI1") .OR. lok("MI1")
		SCAT MEMV
		STOR MENSAJE[1] TO me1
		STOR OTROS[2] TO COL
		STOR .F. TO kok,CAMBIO
		=MOVEWIN(OTROS[3],OTROS[4],OTROS[5],OTROS[6],'WIN',MENSAJE[2])
		=MMI1()
		@ 1,COL GET m.texto1 PICT TEXTO[1,3];
			VALID !YAESTABA(&TEXTO[1,4],'MI1',TEXTO[1,5],TEXTO[1,6],TEXTO[1,7],TEXTO[1,8]);
			ERROR MENSAJE[3]+ALLTRIM(M.TEXTO1)+' EXISTE';
			MESS me1+'[ENTER] para Men£'
		READ
		STORE UPDATE() TO CAMBIO
		@ 2,COL GET m.texto2 PICT TEXTO[2,3];
			VALID !YAESTABA(&TEXTO[2,4],'MI1',TEXTO[2,5],TEXTO[2,6],TEXTO[2,7],TEXTO[2,8]);
			ERROR MENSAJE[4]+ALLTRIM(M.TEXTO2)+' EXISTE';
			MESS me1+'[ENTER] para Men£'
		READ WHEN !EMPTY(M.TEXTO1) .AND. LAST()#27
		STORE IIF(CAMBIO,CAMBIO,UPDATE()) TO CAMBIO
		IF CAMBIO .AND. !EMPTY(M.TEXTO1) .AND. !EMPTY(M.TEXTO2) .AND. LAST()#27
			SELE MI1
			GO FF
			GATH MEMV
			=REPUSE()
			STORE .T. TO KOK
		ENDIF
		UNLO IN MI1
		=IIF(KOK,IAUD(M.TEXTO1),.T.)
		=RELEWIN("WIN")
	ELSE
		=IAUDI()
	ENDIF
RETURN MEN_LIN(BOTOM)
