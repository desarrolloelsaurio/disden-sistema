PROCEDURE LSEGUNDA
#DEFINE CRLF CHR(13)+CHR(10)                     && CRLF
	PARAMETER PORPAN
	EXTERNAL PROCEDURE LSEGUND0.PRG
	STORE {} TO M.FECINI,M.FECFIN
	IF ENTRE_FE("a Listar")
		=WORKING()
		=DOTALK()
		**************************************
		* GENERA TEMPORAL SOBRE COR
		* A PARTIR DE FECHAS DE INICIO Y FINAL
		**************************************
		TMP=GENTMP()
		SELE COR
		SET ORDER TO
		=FLOCK() .OR. FLOK()
		SORT ON NUMERO TO (TMP) FOR ;
			BETW(COR.FECHAFAB,M.FECINI,M.FECFIN)
		UNLO IN COR
		=PRXAREA(.T.)
		USE (TMP) ALIAS TMPCOR
		INDEX ON NUMERO TAG NUMERO
		SET ORDER TO TAG NUMERO
		******************************************
		* GENERA TEMPORAL SOBRE FAX LLAMADA TMPFAX
		* A PARTIR DE CORTES EXISTENTES EN TMPCOR
		******************************************
		SELE FAX
		SET ORDER TO
		SET RELA TO NUMERO INTO TMPCOR
		TMP=GENTMP()
		=FLOCK() .OR. FLOK()
		SORT ON NUMERO,TALLER ;
			TO (TMP) FOR ;
			TIPO="@" .AND. !EOF("TMPCOR")
		UNLO IN FAX
		=PRXAREA(.T.)
		USE (TMP) ALIAS TMPFAX
		SET RELA TO NUMERO INTO TMPCOR
		*************************************************
		* CREA BASE "TEMPORAL" PARA CARGAR LA INFORMACION
		* CRUZADA DE FAX Y N§ FINALES DEL CORTE
		*************************************************
		CREATE CURSOR TEMPORAL (;
		    NUMERO N(10),;
			TALLER C(10),;
			TALLERNOM C(30),;
			CANTCOR N(10,2),;
			CANTINI N(10,2),;
			CANTFIN N(10,2),;
			TERM1 N(10,2),;
			TERM1L N(10,2),;
			TERM2 N(10,2),;
			TERM2E N(10,2),;
			REPROCESO N(10,2),;
			REINTEGRO N(10,2),;
			PERDIDO N(10,2),;
			FECHA D,;
			USUARIO C(10))
		**************************************
		* COPIA DATOS DE FAX A BASE TEMPORAL
		**************************************
		SELE TEMPORAL
		APPE FROM (DBF("TMPFAX"))
		INDEX ON STR(NUMERO)+TALLER TAG NUMERO
		SET ORDER TO TAG NUMERO
		TMP=GENTMP()
		TOTAL ON TALLER TO (TMP) FIELD CANTCOR
		=PRXAREA(.T.)
		USE (TMP) ALIAS TEMPORAL1
        SET RELA TO NUMERO INTO TMPCOR
        REPL ALL ;
        	CANTCOR   WITH TMPCOR.CANTCOR   ,;
			CANTINI   WITH TMPCOR.CANTINI   ,;
			CANTFIN   WITH TMPCOR.CANTFIN   ,;
			TERM1     WITH TMPCOR.TERM1     ,;
			TERM1L    WITH TMPCOR.TERM1L    ,;
			TERM2     WITH TMPCOR.TERM2     ,;
			TERM2E    WITH TMPCOR.TERM2E    ,;
			REPROCESO WITH TMPCOR.REPROCESO ,;
			REINTEGRO WITH TMPCOR.REINTEGRO ,;
			PERDIDO   WITH TMPCOR.PERDIDO   
			=OFF_RELA()
			REPL ALL NUMERO WITH 1
		TMP=GENTMP()
		INDEX ON TALLER TAG NUMERO
		SET ORDER TO TAG NUMERO
		TOTAL ON TALLER TO (TMP)
		=PRXAREA(.T.)
		USE (TMP) ALIAS TMPTAL
		SET ORDER TO TAG TALCOD IN PER
		SET RELA TO TALLER INTO PER
		REPL ALL TALLERNOM WITH PER.CLIENTE
	    INDEX ON TALLERNOM TAG TALLERNOM
	    SET ORDER TO TAG TALLERNOM
		TT="Listado de Talleres"+;
		CRLF+;
		"Cortes entre el "+dtoc(m.fecini)+;
		"y el "+dtoc(m.fecfin)
		acla=paip+;
		padc("TALLER",30)+;
		PAIP+;
		"CORTES"+;
		PAIP+;
		PADC("INICIO",XACDIGI)+;
		PAIP+;
		PADC("PRIMERA",XACDIGI)+;
		PAIP+;
		PADC("SEGUNDA",XACDIGI)+;
		PAIP+;
		PADC("OTROS",XACDIGI)+;		
		PAIP+;		
		PADC("FINAL",XACDIGI)+;
		PAIP
		=UNTALK()
		=UNWORK()
		=LGRL2(PORPAN,"TMPTAL","LSEGUND0()","","LSEGUND")
		=OFF_TMP()
		=OFF_RELA()
	ENDIF
RETURN MEN_LIN(BOTOM)
