* LISTADO DE ORDENES POR FECHA PREVISTA
FUNCTION FABFINPR
PARAMETER PORPAN
#DEFINE CRLF CHR(13)+CHR(10)                     && CRLF
=WORKING()
=DOTALK()
SET ORDER TO TAG ARTIRED IN MER
SET ORDER TO TAG NUMERO IN CO1
SELE COR
SET ORDER TO
SET RELA TO NUMERO INTO CO1
SET RELA TO LEFT(ARTICULO,10) INTO MER ADDI
=FLOCK("COR") .OR. FLOK("COR")
TMP=GENTMP()
SORT ON ARTICULO ,;
  FECHAFIN ;
  FIELDS ;
  NUMERO ,;
  ARTICULO ,;
  MER.MERCA ,;
  FECHAINI ,;
  FECHAPRE ,;
  CANTCOR ;
  TO (TMP) ;
  FOR EMPTY(FECHAFIN)
SELE COR
USE (TMP) ALIAS COR EXCL
SET ORDER TO TAG NUMERO IN CO1
REPL ALL CANTCOR WITH NUL
SCAN
   SELE CO1
   SEEK COR.NUMERO
   CALC SUM(CANTINI) WHILE CO1.NUMERO=COR.NUMERO TO M.SHIT
   SELE COR
   REPL CANTCOR WITH M.SHIT
ENDSCAN
STORE NUL TO CASOS,TOTRUB,TOTTOT
ACLA=PAIP+;
  PADC("O. CORTE",10)+PAIP+;
  PADC("ARTICULO",10)+PAIP+;
  PADC("DETALLE",IIF(PORPAN,20,30))+PAIP+;
  "F.INICIO"+PAIP+;
  "PREVISTO"+PAIP+;
  "FALTA"+PAIP+;
  "CANTI."+PAIP
M.LINEA=REPL("=",LEN(ACLA))
=UNTALK()
=UNWORK()
TT="LISTADO DE ORDENES DE CORTE"+;
  CRLF+;
  "POR FECHA DE FINALIZACION PREVISTA"
GO TOP
ELRUBRO=LEFT(ARTICULO,3)
ELRUBTEX=ALLTRIM(SAYMIX(ELRUBRO,"RUBCOD"))
ELARTICULO=ARTICULO
=IIF(PORPAN,FABFINPP(),FABFINPI())
RETURN REOPCOR()
