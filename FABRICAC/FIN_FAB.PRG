*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º 07/29/96             FIN_FAB.PRG               09:16:35 º
*       º                                                         º
*       ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
*       º                                                         º
*       º Author's Name                                           º
*       º                                                         º
*       º Copyright (c) 1996 Company Name                         º
*       º Address                                                 º
*       º City,     Zip                                           º
*       º                                                         º
*       º Description:                                            º
*       º This program was automatically generated by GENSCRN.    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º                MS-DOS Window definitions                º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

=MOVEWIX("finfab",	INT((SROW()-19)/2), INT((SCOL()-37)/2), INT((SROW()-19)/2)+18, INT((SCOL()-37)/2)+36, ;
 " Finalizaci¢n de Orden "		,' '+janname+' ')		


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º          FIN_FAB/MS-DOS Setup Code - SECTION 2          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1

ULPR=HORA_ULP(PROGRAM())
IF CHEQSEG()
   SELE COR
   IF EMPTY(COR.FECHAFIN)
** Start of inserted file \SISTEMAS\DEFINES.PRG ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄstart
#DEFINE BOTOM  "  "+repl("°",78)                 && BOTOM
#DEFINE ABA    "Abriendo Base de "               && ABA
#DEFINE NUL    0                                 && NUL
#DEFINE PICUMAX "9,999,999,999,999.99"           && PICUMAX
#DEFINE PICUMA1 "9,999,999,999,999"              && PICUMA1
#DEFINE PAIP   "|"                               && PAIP
#DEFINE FOLC  ".F."                              && FOLC
#DEFINE CRLF CHR(13)+CHR(10)                     && CRLF
#DEFINE FOLL  .F.                                && FOLL
#DEFINE TRUC  ".T."                              && TRUC
#DEFINE TRUL  .T.                                && TRUL
#DEFINE IMPRIMIENDO  PADC(' IMPRIMIENDO LOS DATOS REQUERIDOS - [TECLA] Interrumpe ',80,'°') && IMPRIMIENDO
#DEFINE ELYES  "SI"                              && ELYES
#DEFINE ELNOU  "NO"                              && ELNOU
#DEFINE ONE    1                                 && ONE
#DEFINE TWO    2                                 && TWO
#DEFINE THREE  3                                 && THREE
#DEFINE FOUR   4                                 && FOUR
#DEFINE TEX_EFES " - [F2] Popup - [F3] B£squeda" && TEX_EFES
#DEFINE TEX_CALC "CALCULANDO - ESPERE POR FAVOR" && TEX_CALC
#DEFINE GRABANDO PADC(' Grabando los datos ingresados - Espere por Favor ',80,"°")
#DEFINE NOVACIO "CAMPO DE INGRESO OBLIGATORIO - NO PUEDE ESTAR VACIO" && NOVACIO
#DEFINE NOFECHA "LAS FECHAS ESTAN ENTRE VALORES INACEPTABLES" && NOFECHA
#DEFINE ESPAOPC " - Barra Espac. para cambiar de Opci¢n" && ESPAOPC
#DEFINE ESCANUL " - [ESC] para Anular"           && ESCANUL
#DEFINE ESCAMEN " - [ESC] para Men£"             && ESCAMEN
#DEFINE ESCAFIN " - [ESC] para Fin"              && ESCAFIN
#DEFINE NOACVAL "LOS VALORES INGRESADOS ESTAN ENTRE LIMITES INACEPTABLES"    && NOACVAL
#DEFINE CONTIX  " Continuaci¢n"                  && CONTIX
#DEFINE RH      36 								 && RH
#DEFINE RP 		47 								 && RP
#DEFINE ENTERCON "PULSE [ENTER] PARA CONTINUAR"  && ENTERCON
#DEFINE ORQ      "Orden de Requerimiento"        && ORQ
#DEFINE ORQS     "Ordenes de Requerimiento"      && ORQS
#DEFINE NOSEL "NO SE HA SELECCIONADO"            && NOSEL
#DEFINE PIC30 "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"	 && PIC30
#DEFINE T_REINGRE "Reingrese el DATO"	 		 && T_REINGRE

** End of inserted file \SISTEMAS\DEFINES.PRG ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄend

      STORE .T. TO OK
       =LOCK("COR") .OR. LOK("COR")
       SCAT MEMV
       SELE EST
       SET ORDER TO TAG ARTICULO
       IF SEEK (LEFT(COR.ARTICULO,10)+"/"+COR.ESTRUC)
          STORE {} TO MAXFEC
          IF USED("TEST")
             USE IN TEST
          ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º              FIN_FAB/MS-DOS Screen Layout               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
IF WVISIBLE("finfab")
	ACTIVATE WINDOW finfab SAME
ELSE
	ACTIVATE WINDOW finfab NOSHOW
ENDIF
@ 1,1 SAY "Fecha de Inicio" ;
	SIZE 1,15, 0
@ 2,1 SAY "Fecha de Finalizaci¢n" ;
	SIZE 1,21, 0
@ 3,1 SAY "Cantidad Programada" ;
	SIZE 1,19, 0
@ 4,1 SAY "Cantidad Iniciada" ;
	SIZE 1,17, 0
@ 6,1 SAY "Productos de 1¦" ;
	SIZE 1,15, 0
@ 8,1 SAY "Productos de 2¦ Esp." ;
	SIZE 1,20, 0
@ 9,1 SAY "Productos de 2¦" ;
	SIZE 1,15, 0
@ 12,1 SAY "P‚rdida Absoluta" ;
	SIZE 1,16, 0
@ 13,1 SAY "Cantidad Final" ;
	SIZE 1,14, 0
@ 7,1 SAY "Productos de 1¦ Local" ;
	SIZE 1,21, 0
@ 10,1 SAY "Reintegro" ;
	SIZE 1,9, 0
@ 11,1 SAY "Anulaci¢n" ;
	SIZE 1,9, 0
@ 1,25 GET m.fechaini ;
	SIZE 1,8 ;
	DEFAULT {  /  /  } ;
	WHEN _rcj0jvtl1()
@ 2,25 GET m.fechafin ;
	SIZE 1,8 ;
	DEFAULT {  /  /  } ;
	WHEN _rcj0jvuae() ;
	VALID M.FECHAFIN>=M.MAXFEC ;
	MESSAGE "Fecha de Finalizaci¢n de la Orden de "+korte ;
	ERROR "LA FECHA NO PUEDE SER ANTERIOR AL ULTIMO REMITO"
@ 3,23 SAY m.cantcor ;
	SIZE 1,10
@ 4,23 SAY m.cantini ;
	SIZE 1,10
@ 6,23 GET m.term1 ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	WHEN last()#27 .and. ok ;
	VALID posit(m.term1) ;
	MESSAGE "Cantidad de Productos Terminados de Primera" ;
	ERROR nomenor("0")
@ 7,23 GET m.term1l ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	WHEN last()#27 .and. ok ;
	VALID posit(m.term1l) ;
	MESSAGE "Cantidad de Productos Terminados de Primera al Local" ;
	ERROR nomenor("0")
@ 8,23 GET m.term2e ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	WHEN last()#27 .and. ok ;
	VALID posit(m.term2e) ;
	MESSAGE "Cantidad de Productos Terminados de Segunda Especial" ;
	ERROR nomenor("0")
@ 9,23 GET m.term2 ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	WHEN last()#27 .and. ok ;
	VALID posit(m.term2) ;
	MESSAGE "Cantidad de Productos Terminados de Segunda" ;
	ERROR nomenor("0")
@ 10,23 GET m.reintegro ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	WHEN last()#27 .and. ok ;
	VALID posit(m.reintegro) ;
	MESSAGE "Cantidad de Productos a Reintegrados por los Talleres" ;
	ERROR nomenor("0")
@ 11,23 GET m.reproceso ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	WHEN last()#27 .and. ok ;
	VALID posit(m.reproceso) ;
	MESSAGE "Cantidad de Productos Anulados por los Talleres" ;
	ERROR nomenor("0")
@ 12,23 GET m.perdido ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	WHEN last()#27 .and. ok ;
	VALID posit(m.perdido) ;
	MESSAGE "Cantidad de Productos Perdidos por Completo" ;
	ERROR nomenor("0")
@ 13,23 GET COR.cantfin ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	WHEN _rcj0jvuoi()
@ 15,7 GET m.opcion ;
	PICTURE "@*HN \<Confirma;\?\<Anula" ;
	SIZE 1,10,1 ;
	DEFAULT 1 ;
	VALID _rcj0jvuu8() ;
	MESSAGE "Conrfirma los Datos de Finalizaci¢n de la Orden de Corte ?"

IF NOT WVISIBLE("finfab")
	ACTIVATE WINDOW finfab
ENDIF

READ CYCLE ;
	SHOW _rcj0jvv99()

=RELEWIN("finfab")

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º               FIN_FAB/MS-DOS Cleanup Code               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
      ELSE
         =CARTEL("LA ESTRUCTURA DEL ARTICULO "+ALLTRIM(EST.ARTICULO),;
           "NO HA SIDO ENCONTRADA",;
           "ES IMPOSIBLE CERRAR LA ORDEN DE CORTE SIN LA ESTRUCTURA",;
           "PULSE [ENTER] PARA CONTINUAR")
      ENDIF
ELSE
   =CARTEL("LA ORDEN DE CORTE N§ "+ALLTRIM(STR(COR.NUMERO)),;
     "HA SIDO FINALIZADA EL DIA "+DTOC(COR.FECHAFIN),;
     "ES IMPOSIBLE HACER CORRECCIONES SOBRE LOS DATOS INGRESADOS",;
     "PULSE [ENTER] PARA CONTINUAR")
ENDIF
ELSE
=IAUDI()
ENDIF
=RELEWIN("FINFAB")
=RELEWIN("WIN1")
=RELEWIN("cor")
UNLO ALL
RETURN MEN_LIN(BOTOM)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º   FIN_FAB/MS-DOS Supporting Procedures and Functions    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
FUNCTION LFIN_ERR1
	IF USUARIO="ZZZZ"
		? PAIP
		?? STR(POSIC,3)
		?? PAIP
		?? IIF(EMPTY(REMITO),REPL("?",LEN(REMITO)),REMITO)
		?? PAIP
		?? IIF(EMPTY(EF),"????????",DTOC(EF))
		?? PAIP
		?? IIF(EMPTY(EEC),"????????",STR(EEC,8))
		?? PAIP
		?? IIF(EMPTY(ESC),"????????",STR(ESC,8))
		?? PAIP
		?? IIF(EMPTY(SF),"????????",DTOC(SF))
		?? PAIP
		?? IIF(EMPTY(SEC),"????????",STR(SEC,8))
		?? PAIP
		?? IIF(EMPTY(SSC),"????????",STR(SSC,8))
		?? PAIP
	ENDIF
RETURN

FUNCTION LFIN_ERR2
	IF USUARIO="ZZZZ"
		?  PAIP
		?? PRC
		?? PAIP
		?? IIF(XSEEK(PRC,"PRC","PRCCOD"), PRC.PROCFAB, SPACE(30))
		?? PAIP
		?? LEFT(CONDICION, 35)
		?? PAIP
	ENDIF
RETURN


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _RCJ0JVTL1           m.fechaini WHEN                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         FIN_FAB,     Record Number:   14   º
*       º Variable:            m.fechaini                         º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      1                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _rcj0jvtl1     &&  m.fechaini WHEN
#REGION 1
=WORKING()
=DOTALK()

* COPIO LOS REGISTROS DE REMITOS (O SEA DE PROCESOS EFECTUADOS)
TMP=GENTMP()
SELE FAX
SET ORDE TO NUMTRU
IF !SEEK (COR.NUMERO)
   =CARTEL("LA ORDEN DE CORTE N§ "+ALLTRIM(STR(COR.NUMERO)),;
   		"NO POSEE REMITOS")
ENDIF
=FLOCK("FAX") .OR. FLOK("FAX")
COPY TO (TMP) WHILE NUMERO=COR.NUMERO
UNLO IN FAX
STORE .T. TO OK
=PRXAREA(.T.)
USE (TMP) ALIAS TMP EXCL
SCAN
	IF EMPTY(REMITO) .OR. ;
		EMPTY(EF)    .OR. ;
		EMPTY(SF)    .OR. ;
		EMPTY(EEC)   .OR. ;
		EMPTY(ESC)   .OR. ;
		EMPTY(SEC)   .OR. ;
		EMPTY(SSC)
		REPL TMP.USUARIO WITH "ZZZZ"
		STORE .F. TO OK
	ENDIF
ENDSCAN

* RECORRO LAS ESTRUCTURAS Y BUSCO SI SE LE HIZO EL PROCESO NECESARIO
SELE TMP
INDE ON PRC TAG PRC
SET ORDE TO PRC

TMP2=GENTMP()
M.ARTICULO = COR.ARTICULO+"/"+COR.ESTRUC
SELE EST
SET ORDE TO ARTICULO
=FLOCK("EST") .OR. FLOK("EST")
COPY TO (TMP2) WHILE ARTICULO=M.ARTICULO
UNLO IN EST
STORE .T. TO OK2
=PRXAREA(.T.)
USE (TMP2) ALIAS TMP2 EXCL
SCAN
	IF FECHA<=COR.FECHAFAB
		IF !SEEK(PRC,"TMP")
			REPL TMP2.USUARIO WITH 'ZZZZ'
			STORE .F. TO OK2
		ENDIF
    ENDIF
ENDS
IF !OK
	WAIT "SE HAN DETECTADO ERRORES O FALTAS DE INFORMACION" WIND NOWA
	ACLA=PAIP+"PSC"+PAIP+;
		PADC("REMITO",LEN(FAX.REMITO))+PAIP+;
		" F. ENT "+PAIP+;
		" C. ENT "+PAIP+;			
		" C. ENT "+PAIP+;				
		" F. REC "+PAIP+;	
		" C. REC "+PAIP+;			
		" C. REC "+PAIP
	TT="Listado de Control de Cierre de Orden de "+alltrim(favri)+CRLF+;
		"ORDEN DE CORTE N§ "+ALLTRIM(STR(M.NUMERO))+CRLF+;
		"(LOS CONCEPTOS MARCADOS SE DEBEN COMPLETAR EN LA BASE DE DATOS)"
    =XPRN1(4,"TMP","LFIN_ERR1()",TT,"FIN_FAB")
ENDIF
IF !OK2
	WAIT "SE HAN DETECTADO PROCESOS NO REALIZADOS" WIND NOWA
	ACLA=PAIP+;
		PADC("CODIGO PRC",10)+PAIP+;
		PADC("PROCESO",30)+PAIP+;
		PADC("CONDICION",35)+PAIP
	TT="Listado de Control de Cierre de Orden de "+alltrim(favri)+CRLF+;
		"ORDEN DE CORTE N§ "+ALLTRIM(STR(M.NUMERO))+CRLF+;
		"(PROCESOS FALTANTES)"
    =XPRN1(4,"TMP2","LFIN_ERR2()",TT,"FIN_FAB")
ENDIF
=UNWORK()
=UNTALK()
=OFF_TMP()
SELE COR
IF !OK .OR. !OK2
	CLEA READ
	RETURN
ENDIF
RETURN .f.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _RCJ0JVUAE           m.fechafin WHEN                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         FIN_FAB,     Record Number:   15   º
*       º Variable:            m.fechafin                         º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      2                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _rcj0jvuae     &&  m.fechafin WHEN
#REGION 1
M.FECHAFIN=M.MAXFEC
RETURN last()#27


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _RCJ0JVUOI           COR.cantfin WHEN                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         FIN_FAB,     Record Number:   25   º
*       º Variable:            COR.cantfin                        º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      3                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _rcj0jvuoi     &&  COR.cantfin WHEN
#REGION 1
if last()=27 .or. !ok
   return .f.
endif
m.cantfin=m.term1+m.term2+m.term2e+m.term1l
return sget("finfab")

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _RCJ0JVUU8           m.opcion VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         FIN_FAB,     Record Number:   26   º
*       º Variable:            m.opcion                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      4                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _rcj0jvuu8     &&  m.opcion VALID
#REGION 1
IF M.OPCION=1
      IF confirma("FINALIZAR Orden de "+favri,.T.,20,0)
   M.PARC=M.TERM1+M.TERM2E+M.TERM2+M.REINTEGRO+;
   		  M.PERDIDO+M.TERM1L+M.REPROCESO
   =SGET("FINFAB")
   IF !EMPTY(M.FECHAFIN) .AND. ;
        M.PARC=M.CANTINI
      IF CONFIRMA("CERRAR LA ORDEN DE CORTE "+;
           ALLTRIM(STR(COR.NUMERO)),.T.,10,10)
         SELE COR
         set order to tag numero
         if seek(cor.numero)
            SELE COR
            =LOCK("COR") .OR. LOK("COR")
            GATH MEMV
            REPL COR.FECHAFIN WITH M.FECHAFIN
            UNLO IN COR
            =IAUD(STR(COR.NUMERO))
            =DOTALK()
            WAIT "COPIANDO ORDEN DE CORTE A ARCHIVO HISTORICO" WIND NOWA
            =OPCORHIS()
            ELNUMERO=COR.NUMERO
            SELE CORHIS
            APPE FROM DBF("COR") FOR ;
              NUMERO=ELNUMERO
            SELE CO1HIS
            APPE FROM DBF("CO1") FOR ;
              NUMERO=ELNUMERO
            =OPFABHIS()
            SELE FAXHIS
            APPE FROM DBF("FAX") FOR ;
              NUMERO=ELNUMERO .AND. ;
              TIPO="@"
            USE IN CORHIS
            USE IN CO1HIS
            USE IN FAXHIS
            =UNTALK()
            =WCL()
         ELSE
            WAIT "NO HA SIDO ENCONTRADO EL REGISTRO DE FABRICACION " WIND
         ENDIF
      ENDIF
   ELSE
      WAIT "FALTAN DATOS - IMPOSIBLE CERRAR LA ORDEN " WIND NOWA
      _CUROBJ=1
      RETURN .T.
   ENDIF
   ENDIF
ENDIF
CLEA READ
RETURN .T.



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _RCJ0JVV99           Read Level Show                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         FIN_FAB                            º
*       º Called By:           READ Statement                     º
*       º Snippet Number:      5                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _rcj0jvv99     && Read Level Show
PRIVATE currwind
STORE WOUTPUT() TO currwind
*
* Show Code from screen: FIN_FAB
*
#REGION 1
IF SYS(2016) = "FINFAB" OR SYS(2016) = "*"
	ACTIVATE WINDOW finfab SAME
	@ 3,23 SAY m.cantcor ;
		SIZE 1,10, 0
	@ 4,23 SAY m.cantini ;
		SIZE 1,10, 0
ENDIF
IF NOT EMPTY(currwind)
	ACTIVATE WINDOW (currwind) SAME
ENDIF