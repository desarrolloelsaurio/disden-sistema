* 旼 PROGRAMA 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
*     File Name: ICOBTJ.PRG                                                 
*        Author: G. REINER                                                  
*  Date created: 11-04-92                                                   
*     Copyright: SISTEMAS INFORMATICOS S.R.L.                               
* 읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
* INGRESA FORMULARIOS DE TARJETA DE CREDITO CLIENTE MINORISTA
FUNCTION ICOBTJ
PARAMETER ICO_TIPO,LOSPESOS
DEFI WIND WIN2 FROM 3,30 TO 12,79 TITL ' Descripci줻 del Pago ' colo sche 3
=CENTWIN("WIN2")
STORE NUL TO CHEQUES,PNCHE,TTL,GTTL
STORE .F. TO ENCONTRE,LATAR,CODTAR
STORE '' TO CODTAR
STORE .F. TO SALIDA
SELE MIX
SET ORDER TO TAG TARTEX
SCAN
   IF MIX.TEXTO1=LEFT(PER.CLIENTE,20)
      STORE .T. TO ENCONTRE
      STORE LEFT(MIX.TEXTO2,2) TO CODTAR
      STORE MIX.TEXTO1 TO LATAR
      EXIT
   ENDIF
ENDSCAN
IF !ENCONTRE
   STORE NUL TO RESPUESTA
   IF ELITAR("",-1,1)
      STORE LEFT(MIX.TEXTO2,2) TO CODTAR
      STORE MIX.TEXTO1 TO LATAR
      STORE .T. TO SIGUE
   ELSE
      STORE .F. TO SIGUE
   ENDIF
ELSE
   STORE .T. TO SIGUE
ENDIF
IF SIGUE
   elDIA=30
   elnumero=space(15)
   @ 1,1 GET LATAR
   @ 2,1 SAY 'N DE FORMULARIO' COLO SCHE 3
   @ 3,1 SAY 'DIA DE VENCIMIENTO' COLO SCHE 3
   @ 4,1 SAY 'IMPUTACION' COLO SCHE 3
   @ 6,1 SAY "CONFIRMA" COLO SCHE 3
   CLEA GETS
   @ 2,20 GET M.ELNUMERO ;
     MESS 'N DEL FORMULARIO DE TARJETA'
   @ 3,20 GET ELDIA ;
     MESS 'FECHA DE PRESENTACION DE LA TARJETA' ;
     VALID ELDIA<31 .AND. ELDIA>0 ;
     ERROR "LA FECHA VA ENTRE 1 Y 31"
   READ
   STORE NUL TO RESPUESTA
   =ELIGAS("",4,20)
   ELGASTO=MIX.TEXTO2
   NADA=ALLTRIM(MIX.TEXTO1)+'-'+ALLTRIM(MIX.TEXTO2)
   @ 4,20 GET NADA
   CLEA GETS
   IF LAST()#27 .AND. !EMPTY(M.ELNUMERO) .AND. CONFIRMA('PAGO',.F.,6,1)
      ARCHIVO=GENTMP()
      SELE CCL
      SET ORDER TO TAG NUMERORE
      SEEK FAC.FACTURA
      COPY TO (ARCHIVO) WHILE NUMERORE=FAC.FACTURA
      USE (ARCHIVO) ALIAS TMP
      DELE FOR TMP.PAGADA
      DELE FOR TMP.COMPRRE#'FA'
      REPL ALL FECHAOP WITH DATE(),;
        COMPRRE WITH 'RE',;
        NUMERORE WITH NADAREC,;
        PAGADA WITH .F.,;
        USUARIO WITH USADOR,;
        CUOTA WITH MONTO,;
        FECHA WITH DATE(),;
        DETALLE WITH 'Cbr '+alltrim(clitxtna)+'-'+alltrim(clitxtnt),;
        FECHAVE WITH GODAY(fechave,ELDIA)
      STORE NUL TO TARJETA
      SCAN
         SELE CAJ
         SCAT MEMV BLAN
         M.CAJA=LATAR
         M.PROVEEDOR=.F.
         M.GASTO=M.ELGASTO
         M.CODCLI=PER.CODCLI
         M.FECHAOP=DATE()
         M.COMPR='RE N '+FAC.FACTURA
         M.COMPRE="RE"
         M.NUMERE=NADAREC
         M.MONTO=TMP.MONTO
         M.MONEDA=TMP.MONEDA
         M.EQUIVALE=TMP.EQUIVALE
         M.NROCHE=ELNUMERO
         M.FECHADE=TMP.FECHAVE
         M.FECHA=TMP.FECHA
         M.USUARIO=TMP.USUARIO
         =AGRABAR("CAJ")
         M.TIPO='TA'
         M.BANCO=LATAR
         M.NROCHE=ELNUMERO
         M.ENTREGADO=.F.
         M.SELECCION=''
         =AGRABAR("CCH")
         SELE TMP
         TARJETA=TARJETA+TMP.MONTO
      ENDS
		=OPCCL()
      APPE FROM (ARCHIVO)
      =RESTACCL(PER.CODCLI,FAC.FACTURA,FAC.MONTONET,.F.)
      STORE .T. TO SALIDA
   ENDIF
ENDIF
=RELEWIN("WIN2")
RETURN SALIDA
