FUNCTION ANULRES
PARAMETER NRO_OCOR
#DEFINE NUL    0                                 && NUL

=WORKING()
=DOTALK()
=OPAVIS()
=OPTELS()
=OPRPV()
SELE COR
=LOCK() .OR. LOK()
REPL RESERVA WITH .F.
=REPUSE()
UNLO IN COR
SELE RPV
SET ORDER TO TAG NUMERO
IF SEEK(NRO_OCOR)
   SCAN WHILE RPV.NUMERO=NRO_OCOR
      =FLOCK() .OR. FLOK()
      IF EMPTY(RPV.TELCODPRO)
         IF XSEEK(RPV.AVICODPRO,"AVIS","AVICODPRO")
            =LOCK(STR(RECNO("AVIS")),"AVIS") .OR. LOCK(RECNO("AVIS")),"AVIS")
            IF AVIS.STOCKRES>RPV.CANTIDAD
               REPL AVIS.STOCKRES WITH AVIS.STOCKRES-RPV.CANTIDAD
            ELSE
               REPL AVIS.STOCKRES WITH NUL
            ENDIF
            UNLO IN AVIS
         ENDIF
      ELSE
         IF XSEEK(RPV.TELCODPRO,"TELS","TELCODPRO")
            =LOCK(STR(RECNO("TELS")),"TELS") .OR. LOCK(RECNO("TELS")),"TELS")
            IF TELS.STOCKRES>RPV.CANTIDAD
               REPL TELS.STOCKRES WITH TELS.STOCKRES-RPV.CANTIDAD
            ELSE
               REPL TELS.STOCKRES WITH NUL
            ENDIF
            UNLO IN TELS
         ENDIF
      ENDIF
      DELE
      UNLO IN RPV
   ENDSCAN
   =IAUD("BORRADO EN RESPREV.DBF O.C. "+ALLTRIM(STR(NRO_OCOR)))
   IF XSEEK(NRO_OCOR,"CO2","NUMERO")
      SELE CO2
      SET ORDER TO
      DELE FOR NUMERO=NRO_OCOR
      =IAUD("BORRADO EN ORDCOR2.DBF O.C. "+ALLTRIM(STR(NRO_OCOR)))
   ENDIF
ENDIF
=UNTALK()
=UNWORK()
RETURN .T.
