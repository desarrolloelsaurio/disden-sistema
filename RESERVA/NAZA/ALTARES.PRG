FUNCTION ALTARES
PARAMETER EL_OCOR,ALLAS
** MODIFICACION 22/1/96 PARA HACER ALTA DE BASE CO1 O CO2
=WORKING()
=DOTALK()
=OPCID()
SET ORDE TO ARTITAL IN DES
EL_ALLAS=IIF(EMPTY(ALLAS),"CO2","CO1")
SELE (EL_ALLAS)
SCAN FOR NUMERO=EL_OCOR
   M.MRC=COR.ARTICULO+'/'+IIF(ALLAS,CO1.COLOR,CO2.COLOR)+"  "
   **  RECORRO EL DESPIECE PARA RESERVAR STOCK Y GRABAR RPV
   **  BATA 18-12-95
   SELE DES
   IF SEEK(M.MRC+STR(IIF(ALLAS,CO1.TALLE,CO2.TALLE)))
      ZAPATO=IIF(ALLAS,CO1.TALLE,CO2.TALLE)
      SCAN WHILE ARTICULO=M.MRC .AND. TALLE=ZAPATO
         STORE '' TO M.AVICODPRO, M.TELCODPRO
         DO CASE
         CASE !EMPTY(AVICODPRO)
            IF XSEEK(AVICODPRO, "AVIS", "AVICODPRO")
               M.AVICODPRO=AVIS.AVICODPRO
               M.CANTIDAD=IIF(ALLAS,CO1.CANTINI,CO2.CANTINI)*CANTIDAD
               IF XSEEK(STR(EL_OCOR)+M.AVICODPRO, "RPV", "NUMAVIO")
                  =LOCK() .OR. LOK()
                  REPL RPV.CANTIDAD WITH RPV.CANTIDAD+M.CANTIDAD
                  UNLO IN RPV
               ELSE
                  =AGRABAR('RPV')
               ENDIF
               =LOCK(STR(RECNO("AVIS")),"AVIS") .OR. LOK("AVIS",STR(RECNO("AVIS"))) 
               REPL AVIS.STOCKRES WITH AVIS.STOCKRES+M.CANTIDAD
               UNLO IN AVIS
            ENDIF
         CASE !EMPTY(TELCODPRO)
            *** VERIFICA EXISTENCIA DE CID ***
            IF !XSEEK(TELCODPRO+STR(RPV.NUMERO),"CIX","TELCOR")
               **** PASA SI NO EXISTE EL CID SOBRE EL CORTE
               IF XSEEK(TELCODPRO, "TELS", "TELCODPRO")
                  M.TELCODPRO=TELS.TELCODPRO
                  M.CANTIDAD=IIF(ALLAS,CO1.CANTINI,CO2.CANTINI)*CANTIDAD
                  IF XSEEK(STR(EL_OCOR)+M.TELCODPRO, "RPV", "NUMTELA")
                     =LOCK() .OR. LOK()
                     REPL RPV.CANTIDAD WITH RPV.CANTIDAD+M.CANTIDAD
                     UNLO IN RPV
                  ELSE
                     =AGRABAR('RPV')
                  ENDIF
                  =LOCK(STR(RECNO("TELS")),"TELS") .OR. LOK("TELS",STR(RECNO("TELS")))                   
                  REPL TELS.STOCKRES WITH TELS.STOCKRES+M.CANTIDAD
                  UNLO IN TELS
               ENDIF
            ENDIF
         ENDCASE
      ENDSCAN
      **  FIN BATA 18-12-95
   ENDIF
   SELE (EL_ALLAS)
ENDSCAN
=UNTALK()
=UNWORK()
RETURN