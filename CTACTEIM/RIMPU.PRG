************************************************
*-- Programa: RIMPU.PRG
*-- Fecha   : 01/25/93
*-- Version : G. REINER
*-- Notas   : RECIBE IMPUESTOS DE PROP. o INQ.
***********************************************
STORE HORA_ULP(PROGRAM()) TO ULPR
IF CHEQSEG()
=OPCCL()
   =MEN_LIN("[ESC] o [TAB] Sale y Graba - [ENTER] Marca/Desmarca")
	=movewin(2,9,20,70,'win','Impuestos de '+allt(INM.domicilio))
	PICU='@Z '+RIGHT('999,999,999,999.99',XACDIGI)
	ON KEY LABEL TAB KEYBOARD CHR(23)
	ON KEY LABEL ENTER DO RIMPUMAR
	SELE CCI
	M.INQUILINO=XSEEK(INM.CODINM,"ALQ","CODINM")
	M.CODIGO=IIF(M.INQUILINO,ALQ.CODCLI,INM.PROCOD)
	BROW FIELD ;
	C=IIF(EMPTY(CCI.PAGADA)," ","û"),;
	NUMERE:H='PARTIDA', ;
	FECHAVE:H='VENCE', ;
	MONTO:P=PICU:H='MONTO',;
	DETALLE:H='IMPUESTO':10,;
	B=LEFT(PERIO,2)+'-'+SUBS(PERIO,3,2)+'-'+RIGHT(PERIO,3):H="PERIODO";
	IN WIND WIN COLOR SCHE 8;
	FOR EMPTY(CCI.PAGADA) .AND. CCI.CODCLI=M.CODIGO .AND. !EMPTY(CCI.ENTREGADA) .AND. CCI.MONTO>0 ;
	FREE DETALLE
		ON KEY LABEL ENTER
		ON KEY LABEL TAB
		SELE CCL
		SET ORDER TO TAG CODCLI
		=RELEWIN('WIN')
		SELE CCI
		SCAN FOR REGNO=9999
        ELDET=ALLTRIM(LEFT(SINCOSAS(CCI.DETALLE),3)+CCI.PERIO)
*       WAIT "DETALLE:"+ELDET WIND
        SELE CCL
        SEEK CCI.CODCLI
        SCAN WHILE CCL.CODCLI=CCI.CODCLI
*       WAIT "ENCONTRE CLIENTE" WIND        
        IF CCL.DETALLE=ELDET
*          WAIT "ENCONTRE EL DETALLE" WIND
           REPL CCL.PAGADA WITH .T.
           REPL CCL.CUOTA WITH CCL.MONTO
           SCAT MEMV
           M.MONTO=0-M.MONTO
           M.COMPRRE="NC"
           =AGRABAR("CCL")
           EXIT
        ENDIF
        ENDSCAN
        SELE CCI		
		ENDSCAN
		REPL REGNO WITH 0 FOR REGNO=9999
	ELSE
		=IAUDI()
	ENDIF
RETURN MEN_LIN(BOTOM)

FUNCTION RIMPUMAR
	PRIV M.REGI
	M.REGI=RECN()
	SCAT MEMV
	REPLACE CCI.PAGADA WITH !M.PAGADA
	IF M.PAGADA
        REPL CCI.RECIBIDA WITH {}    	    
        REPL CCI.REGNO WITH 0
		DELE FOR CCI.CODCLI=M.CODIGO .AND. ;
		CCI.PERIO=M.PERIO .AND. ;
		CCI.MONTO<0
	ELSE
	    REPL CCI.RECIBIDA WITH DATE()
	    REPL CCI.REGNO WITH 9999
		M.MONTO=-M.MONTO
		M.COMPRRE='NC'
		=AGRABAR("CCI")
	ENDIF
	GO M.REGI
RETURN .T.
