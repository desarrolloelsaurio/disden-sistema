#DEFINE NUL    0                                 && NUL
#DEFINE CRLF CHR(13)+CHR(10)                     && CRLF
#DEFINE PAIP   "|"                               && PAIP
#DEFINE BOTOM  "  "+repl("°",78)                 && BOTOM
PROCEDURE LREMPEND
PARA MCUAL
EXTERNAL PROCEDURE LREMPEN0.PRG
=OPCOR()
=OPAVIS()
=OPTELS()
=OPTALS()
=OPPEN()
RESPUESTA='LREMPE1#7#15#Tipo de Listado de Pendientes#3#;
T\<odo lo Pendiente#;
\<Una Orden de Corte#;
Un \<Taller#'+;
IIF(MCUAL="T","Una T\<ela#","Un A\<v¡o#")+;
'Pendientes en \<Falta#;
U\<n Taller (una O.C.)'
=DEFPOP()
ON SELE POPU LREMPE1 DO LREMPE1
ACTI POPU LREMPE1
RELE POPU LREMPE1
ULPR=HORA_ULP(PROGRAM())
RETURN MEN_LIN(BOTOM)
 
PROCEDURE LREMPE1
CANT_MAX=6
DIME VARIABLE[6],TEXTO[6,3]
STORE .T. TO VARIABLE
STORE .T. TO M.OK
ULPR=HORA_ULP(PROGRAM())
LR_DIJO=ALLTRIM(PROMPT())
STORE .F. TO M.PASUMAR, M.FALTANTE
DO CASE
CASE LR_DIJO="Todo lo Pendiente"
   TT1=""
   FISC='.T.'
CASE LR_DIJO="Una Orden de Corte"
   IF ELICOT("A listar")
      ELNUM=ALLTRIM(STR(COR.NUMERO))
      TT1="Orden de Corte N§ "+elnum
      FISC='NUMERO='+elnum
      STORE .F. TO VARIABLE[1]
   ELSE
      =NOSELEC("ORDEN DE CORTE")
      STORE .F. TO M.OK
   ENDIF
CASE LR_DIJO="Un Taller (una O.C.)"
   IF ELICOT("A listar")
      ELNUM=ALLTRIM(STR(COR.NUMERO))
      TT1="Orden de Corte N§ "+elnum
      FISC='NUMERO='+elnum
      STORE .F. TO VARIABLE[1]
	   STORE NUL TO M.RESPUESTA
	   IF ELITALS("a Listar",-1,1)
    	  TT1=TT1+QW_TT("TALLER:"+ALLTRIM(PER.CLIENTE)+" ("+ALLTRIM(PER.CODCLI)+")")
	      FISC=QW_FISC(FISC,"TALLER='"+PER.CODCLI+"'")
    	  STORE .F. TO VARIABLE[2]
	   ELSE
	      =NOSELEC("TALLER")
    	  STORE .F. TO M.OK
	   ENDIF
   ELSE
      =NOSELEC("ORDEN DE CORTE")
      STORE .F. TO M.OK
   ENDIF
CASE LR_DIJO="Un Taller"
   STORE NUL TO M.RESPUESTA
   IF ELITALS("a Listar",-1,1)
      TT1="TALLER:"+ALLTRIM(PER.CLIENTE)+" ("+ALLTRIM(PER.CODCLI)+")"
      FISC="TALLER='"+PER.CODCLI+"'"
      STORE .F. TO VARIABLE[2]
   ELSE
      =NOSELEC("TALLER")
      STORE .F. TO M.OK
   ENDIF
CASE LR_DIJO="Una Tela"
   M.PASUMAR=.F.
   STORE NUL TO M.RESPUESTA
   IF ELITELS("a Listar",-1,1)
      TT1="TELA:"+ALLTRIM(TELS.TELA)+" ("+ALLTRIM(TELS.TELCODPRO)+")"
      FISC="TELCODPRO='"+TELS.TELCODPRO+"'"
      STORE .F. TO VARIABLE[3],VARIABLE[4]
   ELSE
      =NOSELEC("TELA")
      STORE .F. TO M.OK
   ENDIF
CASE LR_DIJO="Un Av¡o"
   M.PASUMAR=.F.
   STORE NUL TO M.RESPUESTA
   IF ELIAVIS("a Listar",-1,1)
      TT1="AVIO:"+ALLTRIM(AVIS.AVIO)+" ("+ALLTRIM(AVIS.AVICODPRO)+")"
      FISC="AVICODPRO='"+AVIS.AVICODPRO+"'"
      STORE .F. TO VARIABLE[3],VARIABLE[4]
   ELSE
      =NOSELEC("AVIO")
      STORE .F. TO M.OK
   ENDIF
CASE LR_DIJO="Pendientes en Falta"
   TT1='FALTANTES EN STOCK'
   M.FALTANTE=.T.
   M.PASUMAR=.T.
   FISC=".T."
   STORE .F. TO VARIABLE[1],VARIABLE[2]
ENDCASE
IF M.OK
   FISC=QW_FISC(FISC,'!EMPTY('+IIF(MCUAL="A","AVICODPRO","TELCODPRO")+')')
   FISC=QW_FISC(FISC,'CANTIDAD>0')
   TMP=GENTMP()
   =WORKING()
   =DOTALK()
 
   TEXTO[1,1]="NUMERO"
   TEXTO[2,1]="TALLER"
   TEXTO[3,1]="CODIGO"
   TEXTO[4,1]="DESCRIPCION"
   TEXTO[5,1]="CANTIDAD"
   TEXTO[6,1]="U.MEDIDA"
 
   TEXTO[1,2]=10
   TEXTO[1,3]=10
 
   TEXTO[2,2]=20
   TEXTO[2,3]=30
 
   TEXTO[3,2]=20
   TEXTO[3,3]=20
 
   TEXTO[4,2]=20
   TEXTO[4,3]=30
 
   TEXTO[5,2]=XACDIGI
   TEXTO[5,3]=XACDIGI
 
   TEXTO[6,2]=10
   TEXTO[6,3]=20
 
   SELE PEN
   =FLOCK() .OR. FLOK()
   SORT ON TELCODPRO, AVICODPRO TO (TMP) FOR &FISC FIELD ;
     NUMERO, TALLER, AVICODPRO, TELCODPRO, CANTIDAD, MEDIDA
   =UNLO_PRX("PEN",TMP)
   TMP1=GENTMP()
   IF M.PASUMAR
      IF MCUAL="A"
         TOTAL ON AVICODPRO TO (TMP1) FIELD CANTIDAD
      ELSE
         TOTAL ON TELCODPRO TO (TMP1) FIELD CANTIDAD
      ENDIF
   ELSE
      COPY TO (TMP1)
   ENDIF
   =PRXAREA(.T.)
   USE (TMP1) ALIAS TMP1 EXCL
   IF M.FALTANTE
      SELE TMP1
      SCAN
		IF MCUAL="A"
			=XSEEK(AVICODPRO,"AVIS","AVICODPRO")
			IF CANTIDAD < AVIS.STOCK
				DELE
			ENDIF
		ELSE
			=XSEEK(TELCODPRO,"TELS","TELCODPRO")
			IF CANTIDAD < TELS.STOCK
				DELE
			ENDIF
		ENDIF
      ENDSCAN
      PACK
   ENDIF
   ACLAPRN=HAZ_ACLA(.T.)
   ACLAPAN=HAZ_ACLA()
   STORE "" TO M.ACLA
   TT="MERCADERIA PENDIENTE DE ENTREGA A TALLERES"+;
     CRLF+;
     TT1
   =XPRN1(4,"TMP1","LREMPEN0()",FISC,"LREMPEN"+MCUAL)
   =OFF_TMP()
ENDIF
RETURN MEN_LIN(BOTOM)
