* ANULA REMITO
*-- VERSION NOVOGAR - REMITOS A CLIENTES

FUNCTION AREM
ULPR=HORA_ULP(PROGRAM())
IF CHEQSEG()
   scat memv
   IF mrem("ANULAR EL REMITO")
      =MEN_LIN("ESPERE POR FAVOR - ANULANDO EL REMITO")
      =WORKING()
      =DOTALK()
      SELE REM
      REGISTRO=STR(RECNO())
      =LOCK() .OR. LOK()
      STORE DATE() TO M.FACTURADO
      STORE "REMITO ANULADO" TO M.FACTURA
      =AGRABAR1("REM")
      UNLO IN REM
      SELE REX
      SET ORDER TO TAG REMITO
      SEEK REM.REMITO
      SCAN WHILE REX.REMITO=REM.REMITO
         =BAJASTOK(REX.ARTICULO,0-REX.CANTIDAD,'AR',;
           'RE',;
           REM.REMITO,;
           REM.CODCLI,;
           'ANULACION DE REMITO',.F.)
         SELE REX
      ENDSCAN
      =UNTALK()
      =UNWORK()
      =IAUD(REM.REMITO)
   ENDIF
ELSE
   =IAUDI()
ENDIF
RETURN
