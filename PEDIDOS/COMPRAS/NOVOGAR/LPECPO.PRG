********************************************************************************
*-- Programa: LPECPO.PRG
*-- Fecha   : 02-05-93 01:53pm
*-- Version : GOYO REINER
*-- Notas   : GENERA ARCHIVO PARA LISTADO DE NOTAS DE PEDIDO
* LISTADO DE NOTAS DE PEDIDO POR RANKING
* FILART=1 -> Rubro-Subrubro-Modelo
*       =2 -> Rubro-Subrubro
*       =3 -> Rubro
********************************************************************************
#DEFINE NUL    0                                 && NUL
#DEFINE BOTOM  "  "+repl("°",78)                 && BOTOM
#DEFINE PAIP   "|"                               && PAIP

PARAMETER ARCHIVO,L_ABASE
=MEN_LIN("ESPERE POR FAVOR")
=working()
=DOTALK()
L_ABASE=IIF(EMPTY(L_ABASE),"",L_ABASE)
IF L_ABASE="REC"
	SELE REC
	set order to tag REMITO
ELSE
	SELE PEC
	set order to tag PEDIDO
ENDIF
IF FILPRO=2
	set order to tag PROCOD in PRO
	IF L_ABASE="REC"
		set relation to PEC.PROCOD INTO PRO
	ELSE
		set relation to REC.PROCOD INTO PRO
	ENDIF
ENDIF
IF L_ABASE="REC"
	SELE RE1
	SET RELA TO NUMERO+PROCOD INTO REC ADDI
ELSE
	SELE PE1
	SET RELA TO PEDIDO+PROCOD INTO PEC ADDI
ENDIF
SET ORDER TO TAG ARTICULO IN MER
IF L_ABASE="REC"
	SET RELA TO RE1.ARTICULO INTO MER ADDI
ELSE
	SET RELA TO PE1.ARTICULO INTO MER ADDI
ENDIF
tmp=GENTMP()
IF ".T."=FISC
	inde on ARTICULO to (tmp) COMPACT
ELSE
	inde on ARTICULO to (tmp) COMPACT for eval(fisc)
ENDIF
CREATE TABLE (ARCHIVO) (ARTI C(16), MERCA C(30), MARCA C(20), CANTIDAD N(8), MONTO N(12,2))
USE
SELE 25
USE (ARCHIVO) ALIAS LIS EXCL
IF L_ABASE="REC"
	SELE RE1
ELSE
	SELE PE1
ENDIF
GO TOP
XERCA=LAMER(IIF(L_ABASE="REC",RE1.ARTICULO,PE1.ARTICULO))
M.ARTI=IIF(L_ABASE="REC",RE1.ARTICULO,PE1.ARTICULO)
STORE 0 TO M.MONTO,M.CANTIDAD
SCAN
	? RECNO()
	IF LAMER(IIF(L_ABASE="REC",RE1.ARTICULO,PE1.ARTICULO))#XERCA
		INSERT INTO LIS FROM MEMV
		XERCA=LAMER(IIF(L_ABASE="REC",RE1.ARTICULO,PE1.ARTICULO))
		M.ARTI=IIF(L_ABASE="REC",RE1.ARTICULO,PE1.ARTICULO)
		STORE NUL TO M.MONTO,M.CANTIDAD
	ENDIF
	IF L_ABASE="REC"
		M.CANTIDAD=M.CANTIDAD+RE1.CANTIDAD
		M.MONTO=M.MONTO+RE1.MONTO*RE1.CANTIDAD
	ELSE
		M.CANTIDAD=M.CANTIDAD+PE1.CANTIDAD
		M.MONTO=M.MONTO+PE1.MONTO*PE1.CANTIDAD
	ENDIF
ENDSCAN
INSERT INTO LIS FROM MEMV
SELE LIS
if ELTIPO=1
	inde on CANTIDAD tag ARTI of nada.tmp desc comp
else
	inde on monto tag ARTI of nada.tmp desc comp
endif
set order to tag ARTI
SCAN
	IF FILART=1
		=XSEEK(LIS.ARTI,'MER','ARTICULO')
		REPL LIS.MERCA WITH MER.MERCA
		=XSEEK(MER.MARCA,'MI1','MARCOD')
		REPL LIS.MARCA WITH MI1.TEXTO1
	ELSE
		IF FILART=2
			=XSEEK(STR(VAL(LEFT(LIS.ARTI,3)))+STR(VAL(SUBSTR(LIS.ARTI,5,3))),"RUB","TODOS")
			REPL LIS.MERCA WITH RUB.PALISTAR
			REPL LIS.ARTI WITH LEFT(LIS.ARTI,8)
		ELSE
			=XSEEK(STR(VAL(LEFT(LIS.ARTI,3))),'RUB','CODRUB')
			REPL LIS.MERCA WITH RUB.RUBRO
			REPL LIS.ARTI WITH LEFT(LIS.ARTI,3)
		ENDIF
	ENDIF
ENDSCAN
=untalk()
ACLA=PAIP
IF FILART=1
	ACLA=ACLA+PADC("ARTICULO",16)+PAIP+PADC("DENOMINACION",30)+PAIP+;
	PADC("MARCA",IIF(PORPAN,10,20))
ELSE
	IF FILART=2
		ACLA=ACLA+PADC("COD. RUBRO/SUBRUBRO",16)+PAIP+PADC("DENOMINACION",40)
	ELSE
		ACLA=ACLA+PADC("COD. RUBRO",16)+PAIP+PADC("DENOMINACION",40)
	ENDIF
ENDIF
ACLA=ACLA+PAIP+PADC("CANTIDAD",XACDIGI)+PAIP+PADC("MONTO",XACDIGI)+PAIP
M.LINEA=REPL("=",LEN(ACLA))
RETURN UNWORK()
