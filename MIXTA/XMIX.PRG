*************************************
*-- Programa: XMIX.PRG
*-- Fecha   : 08-03-92 08:18pm
*-- Version : G. REINER
*-- Notas   : RESTAURA BASE MIXTA
**************************************
PROCEDURE XMIX
#DEFINE BOTOM  "  "+repl("°",78)                 && BOTOM
=HORA_ULP()
ULPR=PROGRAM()
IF CHEQSEG()
   =OPMIX()
   SELE MIX
   =men_lin('Reindexando el Archivo')
   =FLOCK("MIX") .OR. FLOK("MIX")
   =DOTALK()
   =OPMIXX()
   SELE MIX
   INDE ON FILTRO+LEFT(TEXTO2,2) TAG TODOS
   INDE ON LEFT(TEXTO2,2)      TAG PRVCOD FOR FILTRO="P"
   INDE ON TEXTO1              TAG PRVTEX FOR FILTRO="P"
   INDE ON LEFT(TEXTO2,2)      TAG CAGCOD FOR FILTRO="›"
   INDE ON TEXTO1              TAG CAGTEX FOR FILTRO="›"
   INDE ON TEXTO1              TAG PAITEX FOR FILTRO="ã"
   INDE ON LEFT(TEXTO2,3)      TAG PAICOD FOR FILTRO="ã"
   INDE ON LEFT(TEXTO2,2)      TAG JANCOD FOR FILTRO="*"
   INDE ON LEFT(TEXTO2,2)      TAG MARCOD FOR FILTRO="*"
   INDE ON TEXTO1              TAG JANTEX FOR FILTRO="*"
   INDE ON TEXTO1              TAG MARTEX FOR FILTRO="*"
   INDE ON TEXTO1+TEXTO2       TAG BANTEX FOR FILTRO="B"
   INDE ON NU1                 TAG BANCOD FOR FILTRO="B"
   INDE ON NU1                 TAG CIUCOD FOR FILTRO="C"
   INDE ON TEXTO1              TAG CIUTEX FOR FILTRO="C"
   INDE ON TEXTO1              TAG DNITEX FOR FILTRO="D"
   INDE ON LEFT(TEXTO2,2)      TAG DNICOD FOR FILTRO="D"
   INDE ON TEXTO1              TAG PAGTEX FOR FILTRO="G"
   INDE ON LEFT(TEXTO2,2)      TAG PAGCOD FOR FILTRO="G"
   INDE ON TEXTO1              TAG TARTEX FOR FILTRO="J"
   INDE ON LEFT(TEXTO2,2)      TAG TARCOD FOR FILTRO="J"
   INDE ON LEFT(TEXTO2,2)      TAG LINCOD FOR FILTRO="L"
   INDE ON TEXTO1              TAG LINTEX FOR FILTRO="L"
   INDE ON LEFT(TEXTO2,11)     TAG GASCOD FOR FILTRO="T"
   INDE ON TEXTO1              TAG GASTEX FOR FILTRO="T"
   INDE ON TEXTO1              TAG GRUTEX FOR FILTRO="U"
   INDE ON LEFT(TEXTO2,2)      TAG GRUCOD FOR FILTRO="U"
   INDE ON LEFT(TEXTO2,2)      TAG OPKCOD FOR FILTRO="X"
   INDE ON TEXTO1              TAG OPKTEX FOR FILTRO="X"
   INDE ON TEXTO1              TAG ZONTEX FOR FILTRO="Z"
   INDE ON LEFT(TEXTO2,2)      TAG ZONCOD FOR FILTRO="Z"
   INDE ON USUARIO+TEXTO1      TAG FOXPER FOR FILTRO="?"
   INDE ON TEXTO1              TAG FOXGRL FOR FILTRO="ð"
   INDE ON TEXTO1+TEXTO2       TAG FOXMAQ FOR FILTRO="ñ"
   INDE ON LEFT(TEXTO2,2)      TAG IVACOD FOR FILTRO="2"
   INDE ON TEXTO1              TAG IVATEX FOR FILTRO="2"
   DO CASE
   CASE SSTM1="PILCHAS"
      INDE ON LEFT(TEXTO2,2)      TAG SUECOD FOR FILTRO="S"
      INDE ON TEXTO1              TAG SUETEX FOR FILTRO="S"
      INDE ON TEXTO1              TAG RUBTEX FOR FILTRO="R"
      INDE ON LEFT(TEXTO2,3)      TAG RUBCOD FOR FILTRO="R"
      INDE ON LEFT(TEXTO2,2)      TAG COLCOD FOR FILTRO="O"
      INDE ON TEXTO1              TAG COLTEX FOR FILTRO="O"
      INDE ON LEFT(TEXTO2,2)      TAG MATCOD FOR FILTRO="M"
      INDE ON TEXTO1              TAG MATTEX FOR FILTRO="M"
   CASE SSTM1="MERCADO"
      INDE ON LEFT(TEXTO2,2)  TAG ENVCOD FOR FILTRO="E"
      INDE ON TEXTO1          TAG ENVTEX FOR FILTRO="E"
      INDE ON TEXTO1          TAG CALTEX FOR FILTRO="K"
      INDE ON LEFT(TEXTO2,2)  TAG CALCOD FOR FILTRO="K"
      INDE ON TEXTO1          TAG VARTEX FOR FILTRO="V"
      INDE ON LEFT(TEXTO2,2)  TAG VARCOD FOR FILTRO="V"
   CASE SSTM1="ADMIN"
      INDE ON LEFT(TEXTO2,2)  TAG ACTCOD FOR FILTRO="A"
      INDE ON TEXTO1          TAG ACTTEX FOR FILTRO="A"
      INDE ON LEFT(TEXTO2,2)  TAG ESTCOD FOR FILTRO="E"
      INDE ON TEXTO1          TAG ESTTEX FOR FILTRO="E"
      INDE ON LEFT(TEXTO2,2)  TAG CLQCOD FOR FILTRO="6"
      INDE ON TEXTO1          TAG CLQTEX FOR FILTRO="6"
      INDE ON TEXTO1          TAG CMPTEX FOR FILTRO="7"
      INDE ON LEFT(TEXTO2,2)  TAG CMPCOD FOR FILTRO="7"
   CASE SSTM1="HOGAR"
      INDE ON LEFT(TEXTO2,2)      TAG COLCOD FOR FILTRO="O"
      INDE ON TEXTO1              TAG COLTEX FOR FILTRO="O"
      INDE ON NU1                 TAG LISCOD FOR FILTRO="9"
      INDE ON TEXTO1              TAG LISTEX FOR FILTRO="9"
	  INDE ON TEXTO1 TAG SUCTEX FOR FILTRO="S"
	  INDE ON LEFT(TEXTO2,4) TAG SUCCOD FOR FILTRO="S"
   CASE SSTM1="DIS-DEN"
      INDE ON LEFT(TEXTO2,2)      TAG CTDCOD FOR FILTRO="á"
      INDE ON TEXTO1  TAG CTDTEX FOR FILTRO="á"
      INDE ON LEFT(TEXTO2,2)   TAG APLCOD FOR FILTRO="A"
      INDE ON TEXTO1  TAG APLTEX FOR FILTRO="A"
      INDE ON TEXTO1 TAG TPTTEX FOR FILTRO="Q"
      INDE ON TEXTO1 TAG TPTCOD FOR FILTRO="Q"      
      INDE ON TEXTO1              TAG RUBTEX FOR FILTRO="R"
      INDE ON LEFT(TEXTO2,3)      TAG RUBCOD FOR FILTRO="R"      
   ENDCASE
   #IF "PROD" $ CURDIR()
      INDE ON TEXTO1           TAG ETATEX FOR FILTRO="E"
      INDE ON LEFT(TEXTO2,2)   TAG ETACOD FOR FILTRO="E"
      INDE ON TEXTO1           TAG TELTEX FOR FILTRO="F"
      INDE ON LEFT(TEXTO2,2)   TAG TELCOD FOR FILTRO="F"
      INDE ON TEXTO1           TAG TSTTEX FOR FILTRO="N"
      INDE ON LEFT(TEXTO2,2)   TAG TSTCOD FOR FILTRO="N"
   #ENDIF
   #IF "LABORA" $ CURDIR()
      INDE ON LEFT(TEXTO1,2)+;
        LEFT(TEXTO2,2)           TAG ARACOD FOR FILTRO="A"
      INDE ON  ;
        SUBSTR(TEXTO1,3)+;
        SUBSTR(TEXTO2,3)         TAG ARATEX FOR FILTRO="A"
      INDE ON LEFT(TEXTO2,2)   TAG DESCOD FOR FILTRO="S"
      INDE ON TEXTO1           TAG DESTEX FOR FILTRO="S"
      INDE ON TEXTO1           TAG ESPTEX FOR FILTRO="E"
      INDE ON LEFT(TEXTO2,2)   TAG ESPCOD FOR FILTRO="E"
      INDE ON TEXTO1           TAG TPRTEX FOR FILTRO="I"
      INDE ON LEFT(TEXTO2,2)   TAG TPRCOD FOR FILTRO="I"
      INDE ON TEXTO1           TAG REMTEX FOR FILTRO="M"
      INDE ON LEFT(TEXTO2,2)   TAG REMCOD FOR FILTRO="M"
      INDE ON LEFT(TEXTO2,2)   TAG RADCOD FOR FILTRO="R"
      INDE ON TEXTO1           TAG RADTEX FOR FILTRO="R"
      INDE ON LEFT(TEXTO2,2)   TAG TARCOD FOR FILTRO="T"
      INDE ON TEXTO1           TAG TARTEX FOR FILTRO="T"
      INDE ON LEFT(TEXTO2,2)   TAG UNICOD FOR FILTRO="1"
      INDE ON TEXTO1           TAG UNITEX FOR FILTRO="1"
      INDE ON LEFT(TEXTO2,2)   TAG TFACOD FOR FILTRO="3"
      INDE ON TEXTO1           TAG TFATEX FOR FILTRO="3"
      INDE ON LEFT(TEXTO2,3)   TAG TIPCOD FOR FILTRO="4"
      INDE ON TEXTO1           TAG TIPTEX FOR FILTRO="4"
      INDE ON LEFT(TEXTO2,2)   TAG MDDCOD FOR FILTRO="5"
      INDE ON TEXTO1           TAG MDDTEX FOR FILTRO="5"
   #ENDIF
   #IF "STOCK" $ CURDIR()  .AND. "PRODUC" $ CURDIR()
      INDE ON LEFT(TEXTO2,2)   TAG MDDCOD FOR FILTRO="5"
      INDE ON TEXTO1           TAG MDDTEX FOR FILTRO="5"
      INDE ON LEFT(TEXTO2,2)   TAG APLCOD FOR FILTRO="A"
      INDE ON TEXTO1           TAG APLTEX FOR FILTRO="A"
      INDE ON LEFT(TEXTO2,3)   TAG RUSCOD FOR FILTRO="6"
      INDE ON TEXTO1           TAG RUSTEX FOR FILTRO="6"
      INDE ON LEFT(TEXTO2,6)   TAG SRUCOD FOR FILTRO="7"
      INDE ON TEXTO1           TAG SRUTEX FOR FILTRO="7"
   #ENDIF
   #IF "EXPEN" $ CURDIR() .OR. "ALQU" $ CURDIR() .OR. "RAFU" $ CURDIR()
      INDE ON TEXTO1           TAG TIPTEX FOR FILTRO="I"
      INDE ON LEFT(TEXTO2,2)   TAG TIPCOD FOR FILTRO="I"
      INDE ON TEXTO1           TAG IMPTEX FOR FILTRO="M"
      INDE ON LEFT(TEXTO2,2)   TAG IMPCOD FOR FILTRO="M"
   #ENDIF
   #IF "SUELD" $ CURDIR()
      INDE ON TEXTO1           TAG THOTEX FOR FILTRO="H"
      INDE ON LEFT(TEXTO2,2)   TAG THOCOD FOR FILTRO="H"
      INDE ON TEXTO1           TAG SECTEX FOR FILTRO="S"
      INDE ON LEFT(TEXTO2,2)   TAG SECCOD FOR FILTRO="S"
   #ENDIF

   TX='CREA INDICE '
   =REOPMIX()
   =UNTALK()
   =IAUD(TX)
ELSE
   =IAUDI()
ENDIF
RETURN MEN_LIN(BOTOM)
