#DEFINE BOTOM  "  "+repl("°",78)                 && BOTOM
#DEFINE NUL    0                                 && NUL
#DEFINE PAIP   "|"                               && PAIP

=OPPRO()
=OPMER()
SET ORDER TO TAG ARTICULO
=OPCTD()
=OPCAT()
DO WHILE .T.
	STORE NUL TO M.RESPUESTA
	IF ELICTD("a Procesar",-1,1)
		LACAT=LEFT(MIX.TEXTO2,2)
		tt=alltrim(mix.texto1)
		DEFI WIND CATE FROM 5,7 TO 29,140 TITL "Cátedra "+TT ;
			FONT "ARIAL",10
		ON KEY LABEL F10 DO SALIR
		ON KEY LABEL INS DO NUEVOREG
		ON KEY LABEL DEL DO DELREG
		=CARTELX("[F10] Sale / [INS] Inserta / [DEL] Borra")
		SELE CAT
		SET ORDER TO
		COUNT FOR CATEDRA=LACAT TO CANTREG
		SET RELA TO ARTICULO INTO MER
		BROW FIEL ARTICULO:P="!!!!!!!!!!":R ,;
			MER.MERCA:R:H=PADC("DESCRIPCION",35):P=REPL("!",35):R ,;
			CANTIDAD:P="99999" ,;
			LISTA:P="!":V=(LISTA="+" .OR. LISTA="-"):E="EL VALOR DE LISTA DEBE SER + ó -" ;
			NOMENU NODELETE ;
			FOR CATEDRA=LACAT ;
				WIND CATE

		ELSE
			EXIT
		ENDIF
	ENDDO
	ON KEY LABEL F10
	ON KEY LABEL INS
	ON KEY LABEL DEL
	=RELEWIN("MENS")
RETURN MEN_LIN(BOTOM)


FUNCTION NUEVOREG
	ON KEY LABEL INS
	ON KEY LABEL DEL
	STORE NUL TO RESPUESTA
	IF ELIMER("a Insertar",-1,1)
		M.CANTIDAD=0
		M.ARTICULO=MER.ARTICULO
		M.CATEDRA=M.LACAT
		=AGRABAR("CAT")
	ENDIF
	ON KEY LABEL INS DO NUEVOREG
	ON KEY LABEL DEL DO DELREG
	SELE MER
	SET ORDER TO TAG ARTICULO
	GO TOP
	SELE CAT
	IF EMPTY(CANTREG)
		CANTREG=1
		=ELBROW()
	ENDIF
	SET RELA TO ARTICULO INTO MER
RETURN SGET("CATE")

FUNCTION DELREG
	ON KEY LABEL DEL
	ON KEY LABEL INS
	SELE CAT
	=LOCK() .OR. LOK()
	DELE
	UNLO IN CAT
	GO TOP
	ON KEY LABEL DEL DO DELREG
	ON KEY LABEL INS DO NUEVOREG
RETURN SGET("CATE")

FUNCTION ELBROW
	BROW FIEL ARTICULO:P="!!!!!!!!!!":R ,;
		MER.MERCA:R:H=PADC("DESCRIPCION",35):P=REPL("!",35):R ,;
		CANTIDAD:P="99999" ,;
		LISTA:P="!":V=(LISTA="+" .OR. LISTA="-"):E="EL VALOR DE LISTA DEBE SER + ó -" ;
		NOMENU NODELETE FOR ;
		CATEDRA=LACAT ;
		WIND CATE
RETURN .T.

FUNCTION SALIR
	=RELEWIN("MENS")
	KEYB CHR(23)
RETURN .T.
