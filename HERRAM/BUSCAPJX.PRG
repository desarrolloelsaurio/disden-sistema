PARAMETER QUEBUSCA
IF FILE('INFORME.TXT')
	ERASE INFORME.TXT
ENDIF
FRESULTADO=FCREATE('INFORME.TXT')
COSA=GETF('PJX')
CNT=2
USE (COSA) ALIAS PROYECTO
INIPATH=STRT(HOMEDIR,CHR(0))+"\"
SKIP
SCAN rest
	store NAME to elname 
	?elname
	CNT=CNT+1
	FUENTE=SYS(2014, INIPATH+ALLTRIM(elname))
	IF FILE(FUENTE)
		EXTENS=SUBS(FUENTE, RAT(".",FUENTE)+1, 3)
		DO CASE
		CASE EXTENS="PRG"
			FRESPALDO=FOPEN(FUENTE,0)
			DO WHILE !FEOF(FRESPALDO)
				A=FGETS(FRESPALDO)
				IF QUEBUSCA $ UPPER(A)
					A=ALLTRIM(FGETS(FRESPALDO))
					DO GRABA
					EXIT
				ENDIF
			ENDDO
			=FCLOSE(FRESPALDO)
		CASE RIGHT(EXTENS,1)="X"
			SELE 0
			USE (FUENTE)
			SCAN
				IF HAY_EN_MEMO()
					DO GRABA
					EXIT
				ENDIF
			ENDSCAN
			USE
		ENDCASE
	ENDIF
	SELE PROYECTO
ENDS
CLOSE ALL
FRESULTADO=FOPEN('INFORME.TXT')
DIME TEXTO[CNT]
STORE '' TO TEXTO
PUNTERO=1
DO WHILE !FEOF(FRESULTADO)
	TEXTO[PUNTERO]=FGETS(FRESULTADO)
	? TEXTO[PUNTERO]
	PUNTERO=PUNTERO+1
ENDDO
=ASORT(TEXTO)
IF FILE('INFORME.DOC')
	ERASE INFORME.DOC
ENDIF
? FCLOSE(FRESULTADO)
FRESULTADO=FCREATE('INFORME.DOC')
CLEA
FOR X=1 TO CNT
	IF !EMPTY(TEXTO[X])
		=FPUTS(FRESULTADO,TEXTO[X])
	ENDIF
ENDFOR
=FCLOSE(FRESULTADO)
RETURN

PROCEDURE GRABA
	=FPUTS(FRESULTADO,FUENTE)
RETURN

FUNCTION HAY_EN_MEMO
FOR mcount = 1 TO FCOUNT()
	NOMCAMPO=FIELD(mcount)
	IF TYPE(NOMCAMPO)=="M" .AND. ;
		!EMPTY(EVAL(NOMCAMPO)) .AND. ;
		QUEBUSCA $ UPPER(EVAL(NOMCAMPO))
			RETURN .T.
	ENDIF
NEXT
RETURN .F.
