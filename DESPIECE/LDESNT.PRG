#DEFINE CRLF CHR(13)+CHR(10)                     && CRLF
#DEFINE PAIP   "|"                               && PAIP
function LDESNT
	PARA PORPAN, TIPOLIS, ARTICU
	EXTERNAL PROCEDURE LDESN0
	=WORKING()
	=DOTALK()
	TT="Listado de Despiece "+ IIF(TIPOLIS="E", "Enumerado", "Completo") +;
		CRLF+;
		ALLTRIM(MER.MERCA)+" = "+ALLTRIM(MIX.TEXTO1)+" - ("+ALLTRIM(ARTICU)+")"
	ACLA=PAIP+;
		PADC("COD. AVIO.",20)+PAIP+;
		PADC("COD. TELA",20)+PAIP+;
		PADC("DESCRIPCION",IIF(PORPAN,18,40))+PAIP+;
		IIF(TIPOLIS="E", "", PADC("TL",4)+PAIP)+;
		PADC("CANT.",6)+PAIP+;
		PADC("UNIDAD",4)+PAIP
	SELE DES
	SET ORDER TO
	=FLOCK() .OR. FLOK()
	TMP=GENTMP()
	SORT ON AVICODPRO, TELCODPRO TO (TMP) FOR ARTICULO=ARTICU;
		FIELDS AVICODPRO, TELCODPRO, TALLE, CANTIDAD, AVIS.AVIO, AVIS.UNIDAD
	UNLO IN DES
	=PRXAREA(.T.)
	USE (TMP) ALIAS TMP EXCL
	SET ORDE TO AVICODPRO IN AVIS
	SET RELA TO AVICODPRO INTO AVIS
	SET ORDE TO TELCODPRO IN TELS
	SET RELA TO TELCODPRO INTO TELS ADDI
	REPL AVIO WITH AVIS.AVIO, UNIDAD WITH AVIS.UNIDAD FOR !EMPTY(AVICODPRO)
	REPL AVIO WITH TELS.TELA, UNIDAD WITH TELS.UNIDAD FOR !EMPTY(TELCODPRO)
	IF TIPOLIS="E"
		TMP2=GENTMP()
		TOTAL ON AVIO FIEL CANTIDAD TO (TMP2)
		=PRXAREA(.T.)
		USE (TMP2) ALIAS TMP2 EXCL
	ENDIF
	SET ORDER TO TAG ARTICULO IN DES
	=UNTALK()
	=UNWORK()
	=LGRL2(PORPAN, IIF(TIPOLIS="E", "TMP2", "TMP") ,"LDESN0()","","LDESNT")
	=OFF_TMP()
	=OFF_RELA()
RETURN .t.
