#DEFINE BOTOM  "  "+repl("°",78)                 && BOTOM
#DEFINE NUL    0                                 && NUL
PROCEDURE ACDESAVI
	PARA M.ARTICU
	=OPAVIS()
	SET ORDER TO AVICODPRO
	STORE "" TO M.N_AVI
	SELE DES
	SET ORDER TO TAG ARTICULO
	SET RELA TO AVICODPRO INTO AVIS
	PUSH KEY 
	=MOVEWIN(2,0,18,78,"XXACEDSAVI"," Despiece de "+alltrim(MER.MERCA)+' -'+ALLT(LEFT(MIX.TEXTO1,10))+'- ')
	=SETKEY()
	=MEN_LIN("INGRESE AVIO - [CTRL+A] DESCR. - [F2] POPUP - [F4] REPITE - [F10] SALE")
	SELE DES
	BROW FIELDS ;
		AVIS.AVIO:H="DESCRIPCION":R:35,;
		AVICODPRO:H="CODIGO":P="@!":;
		V=SEEK(AVICODPRO,"AVIS") .AND. CHCHAVI():;
		E='NO EXISTE EL AVIO',;
		TALLE:H="TL":2,;
		CANTIDAD:H="CANT.":P="99.999",;
		PSC:H='POS',;
		AA=SAYMIX(AVIS.UNIDAD,"MDDCOD"):H="MED.":4;
		KEY M.ARTICU FOR !EMPTY(AVICODPRO) IN XXACEDSAVI
	=RELEWIN("XXACEDSAVI")
	=MEN_LIN(BOTOM)
	POP KEY	
RETURN

PROCEDURE INGAV
	PUSH KEY CLEA
	IF !EMPTY(ELIAVIS("C¢digo del Av¡o",-1,1))
      	SELE DES	
		REPL AVICODPRO WITH AVIS.AVICODPRO
		M.N_AVI=AVIS.AVICODPRO
		KEYB "{UPARROW}"
		KEYB "{DNARROW}"		
	ENDIF
	SET ORDER TO TAG AVICODPRO IN AVIS
	SELE DES
	=SETKEY()
RETURN

FUNCTION SETKEY
		ON KEY LABEL F10 KEYBOARD "{Ctrl+W}"
		ON KEY LABEL CTRL+A WAIT ALLTRI(AVIS.AVIO) WIND NOWAIT
		ON KEY LABEL F2 DO INGAV
		ON KEY LABEL F4 DO REPITEDES
RETURN .T.

FUNCTION REPITEDES
	PUSH KEY CLEA
	IF !EMPTY(M.N_AVI)
      	SELE DES	
		REPL AVICODPRO WITH M.N_AVI
		KEYB "{UPARROW}"
		KEYB "{DNARROW}"		
		KEYB "{DNARROW}"		
	ENDIF
	SET ORDER TO TAG AVICODPRO IN AVIS
	SELE DES
	=SETKEY()
RETURN .T.

FUNCTION CHCHAVI
M.N_AVI=DES.AVICODPRO    
RETURN