#DEFINE BOTOM  "  "+repl("°",78)                 && BOTOM
#DEFINE PAIP   "|"                               && PAIP
#DEFINE NUL    0                                 && NUL
#DEFINE CRLF CHR(13)+CHR(10)                     && CRLF
PROCEDURE SVAL
	PARAMETER PORPAN,S_TIPO,S_ORDEN
	EXTERNAL PROCEDURE SVAL0.PRG
	=OPMIX()
	=WORKING()
	=DOTALK()
	DO CASE
	CASE S_TIPO="A"
		=OPAVIS()
		TT="Valorizaci¢n Stock Av¡os"
		T1="AVIOS"
		ELALIAS="AVIS"
	CASE S_TIPO="T"
		=OPTELS()
		TT="Valorizaci¢n Stock Telas"
		ELALIAS="TELS"
		T1="TELAS"
	ENDCASE
	=PRXAREA(.T.)
	DO CASE
	CASE S_ORDEN="M"
		TT=TT+CRLF+;
			"AGRUPADO POR MARCA"
		T2="MARCA"
	CASE S_ORDEN="R"
		TT=TT+CRLF+;
			"AGRUPADO POR RUBRO"
		T2="RUBRO"
	CASE S_ORDEN="A"
		TT=TT+CRLF+;
			"AGRUPADO POR APLICACION"
		T2="APLICACION"
	CASE S_ORDEN="P"
		=OPPRO()
		TT=TT+CRLF+;
			"AGRUPADO POR PROVEEDOR"
		T2="PROVEEDOR"
	ENDCASE
	TMP=GENTMP()
	CREATE CURSOR TEMPORAL (;
		CODIGO C(IIF(S_ORDEN="P",10,IIF(S_ORDEN="A" .OR. S_ORDEN="M",2,3))),;
		RUBRO C(IIF(S_ORDEN="P",30,20)),;
		MONTO N(14,2),;
		UNIDAD C(2))
	INDEX ON RUBRO  TAG RUBRO  OF (TMP)
	INDEX ON UNIDAD TAG UNIDAD OF (TMP) UNIQUE
	INDEX ON CODIGO TAG CODIGO OF (TMP)
	SELE (ELALIAS)
	SCAN
		IF STOCK>NUL
			IF !XSEEK(IIF(S_ORDEN="R",RUBRO,IIF(S_ORDEN="A",APLICACION,IIF(S_ORDEN="M",MARCA,PROCOD))),"TEMPORAL","CODIGO")
				SELE TEMPORAL
				APPE BLAN
				SELE (ELALIAS)
				REPL TEMPORAL.CODIGO WITH IIF(S_ORDEN="R",RUBRO,IIF(S_ORDEN="A",APLICACION,IIF( S_ORDEN="M",MARCA,PROCOD)))
				REPL TEMPORAL.RUBRO  WITH IIF(S_ORDEN="P",SAYPER(TEMPORAL.CODIGO,"PROCOD"),SAYMIX(TEMPORAL.CODIGO,IIF(S_ORDEN="R","RUSCOD",IIF( S_ORDEN="M","MARCOD","APLCOD"))))
			ENDIF
			SELE (ELALIAS)
			REPL TEMPORAL.MONTO  WITH TEMPORAL.MONTO+STOCK*MONTO
			REPL TEMPORAL.UNIDAD WITH UNIDAD
		ENDIF
		SELE (ELALIAS)
	ENDSCAN
    SELE TEMPORAL
    SET ORDER TO TAG UNIDAD
    COPY TO ARRAY XXUNI
	ACLA=PAIP+PADC(T2,IIF(S_ORDEN="P",30,20))+PAIP+PADC("STOCK VALORIZ",XACDIGI+2)+PAIP
    ELPI1=RIGHT("9,999,999,999,999.99",XACDIGI+2)	
    SET ORDER TO TAG RUBRO
    =UNTALK()
    =UNWORK()
	=LGRL2(PORPAN,"TEMPORAL","SVAL0()",T1+" X "+T2,"LSVAL"+LEFT(T2,1),.T.,ELPI1)
	USE IN TEMPORAL
RETURN MEN_LIN(BOTOM)
