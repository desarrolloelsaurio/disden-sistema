FUNCTION AJSTOCK
PARAMETER AJ_CANT,AJ_TIPO,AJ_COD
* AJ_CANT   -> CANTIDAD A CAMBIAR EN STOCK
*-------------------------------------------------------
* AJ_TIPO=1   -> AJUSTA STOCK EN AVIOS
* AJ_TIPO=11  ->
* AJ_TIPO=101 -> AJUSTA STOCK EN AVIOS Y RESTA STKENTPEN
* AJ_TIPO=201 -> AJUSTA STOCK EN AVIOS Y RESTA STKRESPEN
* AJ_TIPO=501 -> SUMA EN STKOCKRES EN AVIOS (NO TOCA STOCK)
* AJ_TIPO=601 -> SUMA EN STKRESPEN EN AVIOS (NO TOCA STOCK)
* AJ_TIPO=701 -> SUMA EN STKENTPEN EN AVIOS (NO TOCA STOCK)
* AJ_TIPO=2   -> AJUSTA STOCK EN TELAS
* AJ_TIPO=102 -> AJUSTA STOCK EN TELAS Y RESTA STKENTPEN
* AJ_TIPO=502 -> SUMA STOCK EN STKOCKRES EN TELAS
* AJ_TIPO=602 -> SUMA EN STKRESPEN EN TELAS
* AJ_TIPO=702 -> SUMA EN STKENTPEN EN TELAS (NO TOCA STOCK)
* AJ_TIPO=3   -> AJUSTA STOCK EN P.TERM
* AJ_TIPO=103 -> AJUSTA STOCK EN P.TERM Y RESTA STKENTPEN
* AJ_TIPO=503 -> SUMA STOCK EN STKOCKRES EN P.TERM
* AJ_TIPO=703 -> SUMA EN STKENTPEN EN P.TERM (NO TOCA STOCK)
* AJ_TIPO=4   -> AJUSTA STOCK EN O.PROD
* AJ_TIPO=104 -> AJUSTA STOCK EN O.PROD Y RESTA STKENTPEN
* AJ_TIPO=504 -> SUMA STOCK EN STKOCKRES EN O.PROD
* AJ_TIPO=704 -> SUMA EN STKENTPEN EN O.PROD. (NO TOCA STOCK)
*-------------------------------------------------------
* AJ_COD      -> CODIGO A BUSCAR EN CASO DE QUE NO SEA AVICODPRO O TEL...
#DEFINE NUL    0                                 && NUL
 
DO CASE
CASE MOD(AJ_TIPO,100)=1
   IF XSEEK(AVICODPRO,"AVIS","AVICODPRO")
      =LOCK("AVIS") .OR. LOK("AVIS")
      DO CASE
      CASE AJ_TIPO=11
         IF AJ_CANT>0
            IF AVIS.STOCK>AJ_CANT
               REPL AVIS.STOCK    WITH AVIS.STOCK-AJ_CANT
               REPL AVIS.STOCKRES WITH AVIS.STOCKRES+AJ_CANT
            ELSE
               REPL AVIS.STKRESPEN WITH AVIS.STKRESPEN+AJ_CANT-AVIS.STOCK
               REPL AVIS.STOCKRES  WITH AVIS.STOCKRES+AVIS.STOCK
               REPL AVIS.STOCK     WITH 0
            ENDIF
         ELSE
            AJ_CANT=ABS(AJ_CANT)
            IF AVIS.STKRESPEN>AJ_CANT
               REPL AVIS.STKRESPEN WITH AVIS.STKRESPEN - AJ_CANT
            ELSE
               AJ_CANT = AJ_CANT - AVIS.STKRESPEN
               REPL AVIS.STKRESPEN WITH 0
               REPL AVIS.STOCK     WITH AVIS.STOCK    + AJ_CANT
               REPL AVIS.STOCKRES  WITH AVIS.STOCKRES - AJ_CANT
            ENDIF
         ENDIF
      CASE AJ_TIPO=1
         REPL AVIS.STOCK WITH AVIS.STOCK+AJ_CANT
      CASE AJ_TIPO=101
         REPL AVIS.STOCK WITH AVIS.STOCK+AJ_CANT
         IF AVIS.STKENTPEN > AJ_CANT
            REPL AVIS.STKENTPEN WITH AVIS.STKENTPEN-AJ_CANT
         ELSE
            REPL AVIS.STKENTPEN WITH NUL
         ENDIF
      CASE AJ_TIPO=201
         REPL AVIS.STOCK WITH AVIS.STOCK+AJ_CANT
         REPL AVIS.STKRESPEN WITH AVIS.STKRESPEN+AJ_CANT
      CASE AJ_TIPO=501
         REPL AVIS.STOCKRES WITH AVIS.STOCKRES+AJ_CANT
      CASE AJ_TIPO=601
         REPL AVIS.STKRESPEN WITH AVIS.STKRESPEN+AJ_CANT
      CASE AJ_TIPO=701
         REPL AVIS.STKENTPEN WITH AVIS.STKENTPEN+AJ_CANT
      ENDCASE
   ELSE
      WAIT "IMPOSIBLE ENCONTRAR AVIO "+;
        ALLTRIM(AVICODPRO)+;
        ". TOME NOTA DEL CODIGO" WIND
   ENDIF
   UNLO IN AVIS
CASE MOD(AJ_TIPO,100)=2
   IF XSEEK(TELCODPRO,"TELS","TELCODPRO")
      =LOCK("TELS") .OR. LOK("TELS")
      DO CASE
      CASE AJ_TIPO=12
         IF AJ_CANT>0
            IF TELS.STOCK>AJ_CANT
               REPL TELS.STOCK    WITH TELS.STOCK-AJ_CANT
               REPL TELS.STOCKRES WITH TELS.STOCKRES+AJ_CANT
            ELSE
               REPL TELS.STKRESPEN WITH TELS.STKRESPEN+AJ_CANT-TELS.STOCK
               REPL TELS.STOCKRES  WITH TELS.STOCKRES+TELS.STOCK
               REPL TELS.STOCK     WITH 0
            ENDIF
         ELSE
            AJ_CANT=ABS(AJ_CANT)
            IF TELS.STKRESPEN>AJ_CANT
               REPL TELS.STKRESPEN WITH TELS.STKRESPEN - AJ_CANT
            ELSE
               AJ_CANT = AJ_CANT - TELS.STKRESPEN
               REPL TELS.STKRESPEN WITH 0
               REPL TELS.STOCK     WITH TELS.STOCK    + AJ_CANT
               REPL TELS.STOCKRES  WITH TELS.STOCKRES - AJ_CANT
            ENDIF
         ENDIF
      CASE AJ_TIPO=2         
         REPL TELS.STOCK WITH TELS.STOCK+AJ_CANT      
      CASE AJ_TIPO=502
         REPL TELS.STOCKRES WITH TELS.STOCKRES+AJ_CANT
      CASE AJ_TIPO=602
         REPL TELS.STKRESPEN WITH TELS.STKRESPEN+AJ_CANT
      CASE AJ_TIPO=702
         REPL TELS.STKENTPEN WITH TELS.STKENTPEN+AJ_CANT
      OTHERWISE
         REPL TELS.STOCK WITH TELS.STOCK+AJ_CANT
         IF AJ_TIPO=102
            IF TELS.STKENTPEN > AJ_CANT
               REPL TELS.STKENTPEN WITH TELS.STKENTPEN-AJ_CANT
            ELSE
               REPL TELS.STKENTPEN WITH NUL
            ENDIF
         ENDIF
      ENDCASE
   ELSE
      WAIT "IMPOSIBLE ENCONTRAR TELA "+;
        ALLTRIM(TELCODPRO)+;
        ". TOME NOTA DEL CODIGO" WIND
   ENDIF
      UNLO IN TELS
CASE MOD(AJ_TIPO,100)=3
   IF XSEEK(COMCODPRO,"COMS","COMCODPRO")
      =LOCK("COMS") .OR. LOK("COMS")
      DO CASE
      CASE AJ_TIPO=13
         IF AJ_CANT>0
            IF COMS.STOCK>AJ_CANT
               REPL COMS.STOCK    WITH COMS.STOCK-AJ_CANT
               REPL COMS.STOCKRES WITH COMS.STOCKRES+AJ_CANT
            ELSE
               REPL COMS.STKRESPEN WITH COMS.STKRESPEN+AJ_CANT-COMS.STOCK
               REPL COMS.STOCKRES  WITH COMS.STOCKRES+COMS.STOCK
               REPL COMS.STOCK     WITH 0
            ENDIF
         ELSE
            AJ_CANT=ABS(AJ_CANT)
            IF COMS.STKRESPEN>AJ_CANT
               REPL COMS.STKRESPEN WITH COMS.STKRESPEN - AJ_CANT
            ELSE
               AJ_CANT = AJ_CANT - COMS.STKRESPEN
               REPL COMS.STKRESPEN WITH 0
               REPL COMS.STOCK     WITH COMS.STOCK    + AJ_CANT
               REPL COMS.STOCKRES  WITH COMS.STOCKRES - AJ_CANT
            ENDIF
         ENDIF
      CASE AJ_TIPO=503
         REPL COMS.STOCKRES WITH COMS.STOCKRES+AJ_CANT
      CASE AJ_TIPO=703
         REPL COMS.STKENTPEN WITH COMS.STKENTPEN+AJ_CANT
      OTHERWISE
         REPL COMS.STOCK WITH COMS.STOCK+AJ_CANT
         IF AJ_TIPO=103
            IF COMS.STKENTPEN > AJ_CANT
               REPL COMS.STKENTPEN WITH COMS.STKENTPEN-AJ_CANT
            ELSE
               REPL COMS.STKENTPEN WITH NUL
            ENDIF
         ENDIF
      ENDCASE
   ELSE
      WAIT "IMPOSIBLE ENCONTRAR P. TERM. "+;
        ALLTRIM(COMCODPRO)+;
        ". TOME NOTA DEL CODIGO" WIND
   ENDIF
      UNLO IN COMS
CASE MOD(AJ_TIPO,100)=4
   IF XSEEK(OTRCODPRO,"OTRS","OTRCODPRO")
      =LOCK("OTRS") .OR. LOK("OTRO")
      DO CASE
      CASE AJ_TIPO=14
         IF AJ_CANT>0
            IF OTRS.STOCK>AJ_CANT
               REPL OTRS.STOCK    WITH OTRS.STOCK-AJ_CANT
               REPL OTRS.STOCKRES WITH OTRS.STOCKRES+AJ_CANT
            ELSE
               REPL OTRS.STKRESPEN WITH OTRS.STKRESPEN+AJ_CANT-OTRS.STOCK
               REPL OTRS.STOCKRES  WITH OTRS.STOCKRES+OTRS.STOCK
               REPL OTRS.STOCK     WITH 0
            ENDIF
         ELSE
            AJ_CANT=ABS(AJ_CANT)
            IF OTRS.STKRESPEN>AJ_CANT
               REPL OTRS.STKRESPEN WITH OTRS.STKRESPEN - AJ_CANT
            ELSE
               AJ_CANT = AJ_CANT - OTRS.STKRESPEN
               REPL OTRS.STKRESPEN WITH 0
               REPL OTRS.STOCK     WITH OTRS.STOCK    + AJ_CANT
               REPL OTRS.STOCKRES  WITH OTRS.STOCKRES - AJ_CANT
            ENDIF
         ENDIF
      CASE AJ_TIPO=504
         REPL OTRS.STOCKRES WITH OTRS.STOCKRES+AJ_CANT
      CASE AJ_TIPO=704
         REPL OTRS.STKENTPEN WITH OTRS.STKENTPEN+AJ_CANT
      OTHERWISE
         REPL OTRS.STOCK WITH OTRS.STOCK+AJ_CANT
         IF AJ_TIPO=104
            IF OTRS.STKENTPEN > AJ_CANT
               REPL OTRS.STKENTPEN WITH OTRS.STKENTPEN-AJ_CANT
            ELSE
               REPL OTRS.STKENTPEN WITH NUL
            ENDIF
         ENDIF
      ENDCASE
   ELSE
      WAIT "IMPOSIBLE ENCONTRAR P. TERM. "+;
        ALLTRIM(OTRCODPRO)+;
        ". TOME NOTA DEL CODIGO" WIND
   ENDIF
      UNLO IN OTRS
ENDCASE
RETURN
