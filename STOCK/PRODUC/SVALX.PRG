#DEFINE BOTOM  "  "+repl("°",78)                 && BOTOM
#DEFINE PAIP   "|"                               && PAIP
#DEFINE NUL    0                                 && NUL
#DEFINE CRLF CHR(13)+CHR(10)                     && CRLF
PROCEDURE SVALX
	PARAMETER PORPAN,S_TIPO,S_ORDEN,S_STOCK
	EXTERNAL PROCEDURE SVAL0.PRG
	=OPPRO()
	=OPMIX()
	=WORKING()
	=DOTALK()
	DO CASE
	CASE S_TIPO="A"
		=OPAVIS()
		TT="Valorizaci¢n Stock Av¡os"
		T1="AVIOS"
		SELE AVIS
	CASE S_TIPO="T"
		=OPTELS()
		TT="Valorizaci¢n Stock Telas"
		SELE TELS
		T1="TELAS"
	CASE S_TIPO="C"
		=OPCOMS()
		TT="Valorizaci¢n Stock Prod. Terminados"
		SELE COMS
		T1="PRODUCTOS TERMINADOS"
	CASE S_TIPO="O"
		=OPOTRS()
		TT="Valorizaci¢n Stock Otros Productos"
		SELE OTRS
		T1="OTROS PRODUCTOS"
	ENDCASE
	TMP2=GENTMP()
	DO CASE
	CASE S_ORDEN="M"
		TT=TT+CRLF+"AGRUPADO POR MARCA"
		T2="MARCA"
		IF S_STOCK#"N"
			TMP3=GENTMP()
			SORT ON MARCA,UNIDAD TO (TMP3) FOR STOCKRES+STOCK>NUL
		ENDIF
		SORT ON MARCA TO (TMP2) FOR STOCKRES+STOCK>NUL
		IF S_STOCK#"N"
			=PRXAREA(.T.)
			USE (TMP3) ALIAS TMP3
			TMP4=GENTMP()
			TOTAL ON MARCA+UNIDAD TO (TMP4) 
			=PRXAREA(.T.)
			USE (TMP4) ALIAS TMP4
			INDE ON MARCA+UNIDAD TAG UNIDAD
		ENDIF
		=PRXAREA(.T.)
		USE (TMP2) ALIAS TMP2
		DO CASE
			CASE S_STOCK="S"
				REPLACE MONTO WITH STOCK*MONTO ALL
			CASE S_STOCK="R"
				REPLACE MONTO WITH STOCKRES*MONTO ALL
			CASE S_STOCK="T"
				REPLACE MONTO WITH (STOCK+STOCKRES)*MONTO ALL
		ENDCASE
		TMP=GENTMP()
		TOTAL ON MARCA TO (TMP)
	CASE S_ORDEN="R"
		TT=TT+CRLF+"AGRUPADO POR RUBRO"
		T2="RUBRO"
		IF S_STOCK#"N"
			TMP3=GENTMP()
			SORT ON RUBRO,UNIDAD TO (TMP3) FOR STOCKRES+STOCK>NUL
		ENDIF
		SORT ON RUBRO TO (TMP2) FOR STOCKRES+STOCK>NUL
		IF S_STOCK#"N"
			=PRXAREA(.T.)
			USE (TMP3) ALIAS TMP3
			TMP4=GENTMP()
			TOTAL ON RUBRO+UNIDAD TO (TMP4) 
			=PRXAREA(.T.)
			USE (TMP4) ALIAS TMP4
			INDE ON RUBRO+UNIDAD TAG UNIDAD
		ENDIF
		=PRXAREA(.T.)
		USE (TMP2) ALIAS TMP2
		DO CASE
			CASE S_STOCK="S"
				REPLACE MONTO WITH STOCK*MONTO ALL
			CASE S_STOCK="R"
				REPLACE MONTO WITH STOCKRES*MONTO ALL
			CASE S_STOCK="T"
				REPLACE MONTO WITH (STOCK+STOCKRES)*MONTO ALL
		ENDCASE
		TMP=GENTMP()
		TOTAL ON RUBRO TO (TMP)
	CASE S_ORDEN="A"
		TT=TT+CRLF+"AGRUPADO POR APLICACION"
		T2="APLICACION"
		IF S_STOCK#"N"
			TMP3=GENTMP()
			SORT ON APLICACION,UNIDAD TO (TMP3) FOR STOCKRES+STOCK>NUL
		ENDIF
		SORT ON APLICACION TO (TMP2) FOR STOCKRES+STOCK>NUL
		IF S_STOCK#"N"
			=PRXAREA(.T.)
			USE (TMP3) ALIAS TMP3
			TMP4=GENTMP()
			TOTAL ON APLICACION+UNIDAD TO (TMP4) 
			=PRXAREA(.T.)
			USE (TMP4) ALIAS TMP4
			INDE ON APLICACION+UNIDAD TAG UNIDAD
		ENDIF
		=PRXAREA(.T.)
		USE (TMP2) ALIAS TMP2
		DO CASE
			CASE S_STOCK="S"
				REPLACE MONTO WITH STOCK*MONTO ALL
			CASE S_STOCK="R"
				REPLACE MONTO WITH STOCKRES*MONTO ALL
			CASE S_STOCK="T"
				REPLACE MONTO WITH (STOCK+STOCKRES)*MONTO ALL
		ENDCASE
		TMP=GENTMP()
		TOTAL ON APLICACION TO (TMP)
	CASE S_ORDEN="P"
		TT=TT+CRLF+"AGRUPADO POR PROVEEDOR"
		T2="PROVEEDOR"
		IF S_STOCK#"N"
			TMP3=GENTMP()
			SORT ON PROCOD,UNIDAD TO (TMP3) FOR STOCKRES+STOCK>NUL
		ENDIF
		SORT ON PROCOD TO (TMP2) FOR STOCKRES+STOCK>NUL
		IF S_STOCK#"N"
			=PRXAREA(.T.)
			USE (TMP3) ALIAS TMP3
			TMP4=GENTMP()
			TOTAL ON PROCOD+UNIDAD TO (TMP4) 
			=PRXAREA(.T.)
			USE (TMP4) ALIAS TMP4
			INDE ON PROCOD+UNIDAD TAG UNIDAD
		ENDIF
		=PRXAREA(.T.)
		USE (TMP2) ALIAS TMP2
		DO CASE
			CASE S_STOCK="S"
				REPLACE MONTO WITH STOCK*MONTO ALL
			CASE S_STOCK="R"
				REPLACE MONTO WITH STOCKRES*MONTO ALL
			CASE S_STOCK="T"
				REPLACE MONTO WITH (STOCK+STOCKRES)*MONTO ALL
		ENDCASE
		TMP=GENTMP()
		TOTAL ON PROCOD TO (TMP)
	ENDCASE
	DO CASE
		CASE S_STOCK="R"
			SELE TMP4
			REPL STOCK WITH STOCKRES ALL
			TT=TT+CRLF+"Stock Reservado"
		CASE S_STOCK="S"
			TT=TT+CRLF+"Stock Disponible (Sin Reserva)"
		CASE S_STOCK="T"
			SELE TMP4
			REPL STOCK WITH STOCK+STOCKRES ALL
			TT=TT+CRLF+"Stock Total"
	ENDCASE
	=PRXAREA(.T.)
	USE (TMP) ALIAS TMP
	CREATE CURSOR TEMPORAL (;
		CODIGO C(IIF(S_ORDEN="P",10,IIF(S_ORDEN="A" .OR. S_ORDEN="M",2,3))),;
		RUBRO C(IIF(S_ORDEN="P" .AND. !PORPAN,30,20)),;
		MONTO N(14,2), STOCKRES N(14,2))
	INDEX ON RUBRO  TAG RUBRO
	SELE TMP
	SCAN
		SELE TEMPORAL
		APPE BLAN
		SELE TMP
		REPL TEMPORAL.CODIGO WITH ;
		IIF(S_ORDEN="P",PROCOD,;
			IIF(S_ORDEN="R",RUBRO,;
				IIF( S_ORDEN="M",MARCA,;
					APLICACION)))
		REPL TEMPORAL.RUBRO  WITH ;
		IIF(S_ORDEN="P",SAYPER(PROCOD,"PROCOD"),;
			IIF(S_ORDEN="R",SAYMIX(RUBRO,"RUSCOD"),;
				IIF( S_ORDEN="M",SAYMIX(MARCA,"MARCOD"),;
					SAYMIX(APLICACION,"APLCOD"))))
		REPL TEMPORAL.MONTO  	WITH TMP.MONTO
	ENDSCAN
	IF S_STOCK#"N"
		SELE TMP3
		INDE ON UNIDAD TAG UNIDAD UNIQUE
		COPY TO ARRAY S_UNITXT FIELD UNIDAD
		SET ORDE TO
		GO TOP
	ENDIF
	SELE TEMPORAL
	ACLA=PAIP+PADC(T2,IIF(S_ORDEN="P" .AND. !PORPAN,30,20))+PAIP
	IF S_STOCK#"N"
		DIME ELPI1[ALEN(S_UNITXT)+1]
		FOR M.XXX=1 TO ALEN(S_UNITXT)
			ACLA=ACLA+PADC(ALLT(SAYMIX(S_UNITXT[M.XXX],"MDDCOD")),10)+PAIP
			ELPI1[M.XXX]="@Z 999999,999"
		NEXT
		ELPI1[ALEN(S_UNITXT)+1]=RIGHT("9,999,999,999,999.99",XACDIGI+2)
		ACLA=ACLA+PADC("TOTAL VALORIZ",XACDIGI+2)+PAIP
	ELSE
		DIME ELPI1[3]
		FOR M.XXX=1 TO 3
			ELPI1[M.XXX]=RIGHT("9,999,999,999,999.99",XACDIGI+2)
		NEXT
		ACLA=ACLA+PADC("S/RES.VALORIZ",XACDIGI+2)+PAIP+;
				PADC("RESERV.VALORIZ",XACDIGI+2)+PAIP+;
				PADC("TOTAL VALORIZ",XACDIGI+2)+PAIP
	ENDIF
	SET ORDER TO TAG RUBRO
	=UNTALK()
	=UNWORK()
	IF S_STOCK#"N"
		=LGRL2(PORPAN,"TEMPORAL","SVAL0()",T1+" X "+T2,"LSVAL"+LEFT(T2,1),ALEN(S_UNITXT)+1,@ELPI1)
	ELSE
		=LGRL2(PORPAN,"TEMPORAL","SVAL0()",T1+" X "+T2,"LSVAL"+LEFT(T2,1),3,@ELPI1)
	ENDIF
	USE IN TEMPORAL
	=OFF_TMP()
RETURN MEN_LIN(BOTOM)
