*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        05/13/94            QUERYREM.PRG               10:32:46 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 1994 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

PARAMETERS porpan

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                QUERYREM/MS-DOS Setup Code - SECTION 1          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
STORE "" TO TTREM,TTFEC,TTSUC,TTMER
STORE 1  TO FILREM,FILFEC,FILSUC,FILMER
STORE "" TO QUEREM,QUEFEC,QUESUC,QUEMER
store 1 to minobj
store 3 to maxobj
store .f. to fin,HUBORES
ULPR=HORA_ULP(PROGRAM())
IF CHEQSEG()
** Start of inserted file \SISTEMAS\DEFINES.PRG 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴start
#DEFINE FOLC  ".F."                              && FOLC
#DEFINE CRLF CHR(13)+CHR(10)                     && CRLF
#DEFINE FOLL  .F.                                && FOLL
#DEFINE TRUC  ".T."                              && TRUC
#DEFINE TRUL  .T.                                && TRUL
#DEFINE IMPRIMIENDO  PADC(' IMPRIMIENDO LOS DATOS REQUERIDOS - [TECLA] Interrumpe ',80,'') && IMPRIMIENDO
#DEFINE ELYES  "SI"                              && ELYES
#DEFINE ELNOU  "NO"                              && ELNOU
#DEFINE ONE    1                                 && ONE
#DEFINE TWO    2                                 && TWO
#DEFINE THREE  3                                 && THREE
#DEFINE FOUR   4                                 && FOUR
#DEFINE NUL    0                                 && NUL
#DEFINE BOTOM  "  "+repl("",78)                 && BOTOM
#DEFINE PAIP   "|"                               && PAIP
#DEFINE ABA    "Abriendo Base de "               && ABA
#DEFINE TEX_EFES " - [F2] Popup - [F3] B즧queda" && TEX_EFES
#DEFINE TEX_CALC "CALCULANDO - ESPERE POR FAVOR" && TEX_CALC
#DEFINE GRABANDO PADC(' Grabando los datos ingresados - Espere por Favor ',80,"")
#DEFINE NOVACIO "CAMPO DE INGRESO OBLIGATORIO - NO PUEDE ESTAR VACIO" && NOVACIO
#DEFINE NOFECHA "LAS FECHAS ESTAN ENTRE VALORES INACEPTABLES" && NOFECHA
#DEFINE ESCANUL " - [ESC] para Anular"           && ESCANUL
#DEFINE ESCAMEN " - [ESC] para Men"             && ESCAMEN
#DEFINE ESCAFIN " - [ESC] para Fin"              && ESCAFIN
#DEFINE NOACVAL "LOS VALORES INGRESADOS ESTAN ENTRE LIMITES INACEPTABLES"    && NOACVAL
#DEFINE CONTIX  " Continuaci줻"                  && CONTIX
#DEFINE RH      36 								 && RH
#DEFINE RP 		47 								 && RP
#DEFINE ENTERCON "PULSE [ENTER] PARA CONTINUAR"  && ENTERCON

** End of inserted file \SISTEMAS\DEFINES.PRG 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴end


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

IF NOT WEXIST("queryrem") ;
	OR UPPER(WTITLE("QUERYREM")) == "QUERYREM.PJX" ;
	OR UPPER(WTITLE("QUERYREM")) == "QUERYREM.SCX" ;
	OR UPPER(WTITLE("QUERYREM")) == "QUERYREM.MNX" ;
	OR UPPER(WTITLE("QUERYREM")) == "QUERYREM.PRG" ;
	OR UPPER(WTITLE("QUERYREM")) == "QUERYREM.FRX" ;
	OR UPPER(WTITLE("QUERYREM")) == "QUERYREM.QPR"
	DEFINE WINDOW queryrem ;
		FROM INT((SROW()-12)/2),INT((SCOL()-77)/2) ;
		TO INT((SROW()-12)/2)+11,INT((SCOL()-77)/2)+76 ;
		TITLE " L죑ites del Listado de Remitos " ;
		FOOTER ' '+janname+' ' ;
		NOFLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		DOUBLE ;
		COLOR SCHEME 1
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     QUERYREM/MS-DOS Screen Layout              
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
IF WVISIBLE("queryrem")
	ACTIVATE WINDOW queryrem SAME
ELSE
	ACTIVATE WINDOW queryrem NOSHOW
ENDIF
@ 1,2 GET m.filrem ;
	PICTURE "@*RVN \<Todos los Remitos;\<Un Remito;\<Opciones" ;
	SIZE 1,21,0 ;
	DEFAULT 1 ;
	WHEN betw(_curobj,minobj,maxobj) ;
	VALID _qpz0mlsb0()
@ 1,25 GET m.filfec ;
	PICTURE "@*RVN \<Todas las Fechas;\<Entre Fechas;\<Resumen por Fecha" ;
	SIZE 1,21,0 ;
	DEFAULT 1 ;
	WHEN M.FILREM=3 .AND. betw(_curobj,minobj,maxobj) ;
	VALID VAL_OBJ()
@ 1,48 GET m.filsuc ;
	PICTURE "@*RVN \<A Todas las Sucursales;\<A una Sucursal;\<Resumen por Sucursal" ;
	SIZE 1,26,0 ;
	DEFAULT 1 ;
	WHEN M.FILREM=3 .AND. betw(_curobj,minobj,maxobj) ;
	VALID VAL_OBJ()
@ 5,25 GET m.filMER ;
	PICTURE "@*RVN \<Sin Mercader죂;\<Con Mercader죂;\<Opciones" ;
	SIZE 1,18,0 ;
	DEFAULT 1 ;
	WHEN M.FILREM=3 .AND. betw(_curobj,minobj,maxobj) ;
	VALID VAL_OBJ(.T.)

IF NOT WVISIBLE("queryrem")
	ACTIVATE WINDOW queryrem
ENDIF

READ CYCLE

RELEASE WINDOW queryrem

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     QUERYREM/MS-DOS Cleanup Code               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
IF LAST()#27
   ACTI SCRE
   FISC="REM.TIPO='I'"
   IF FILREM=1
      TTQUE=CHR(13)+CHR(10)+"Todos los Remitos"
   ELSE
      STORE DATE() TO FECINI,FECFIN
      STORE FILFEC TO FECANT
      STORE IIF(FILFEC#1,2,1) TO FILFEC
      =qw_fec(4,27,'rem.fechaem')
      STORE FECANT TO FILFEC
      =qw_SUC(4,52,'REM.CODCLI')
      STORE NUL TO M.NUINI,NUFIN
      =qw_mer(9,27,"rex.articulo")
      ***** FISC
      FISC=qw_fisc(FISC,quefec)
      FISC=qw_FISC(FISC,queSUC)
      FISC=qw_FISC(FISC,quemer)
      FISC=IIF(EMPTY(FISC),'.T.',FISC)
      ***** TITULOS
      store "Resumen por " to ressu
      TTQUE=QW_TT(TTfec)+QW_TT(TTSUC)+QW_TT(TTmer)
   ENDIF
   **** AL FIN LISTADOS
   =WORKING()
   =DOTALK()
   TT="Listado de Remitos de Sucursal "+JANNAME+;
     ttque
   M.ACLA=paip+;
     padc("NUMERO",14)+;
     PAIP+;
     PADC("SUCURSAL",10)+;
     PAIP+;
     PADC("FECHA",8)+;
     PAIP+;
     PADC("VALORIZACION",XACDIGI)+;
     PAIP
   M.LINEA=REPL("=",LEN(ACLA))
   STORE NUL TO CASOS
   IF FILMER=1
      SELE REM
      SET ORDER TO TAG REMITO IN REX
      =FLOCK("REM") .OR. FLOK("REM")
      TMP=GENTMP()
   ELSE
      SELE MER
      SET ORDER TO TAG ARTICULO
      SELE REM
      SET ORDER TO TAG REMITO IN REX
      =FLOCK("REM") .OR. FLOK("REM")
      SELE REX
      SET ORDER TO TAG REMITO
      SET RELA TO REMITO INTO REM
      SET RELA TO ARTICULO INTO MER ADDI
      =FLOCK("REX") .OR. FLOK("REX")
      TMP=GENTMP()
      SELE REX
   ENDIF
   SORT ON REM.FECHAEM ,REM.REMITO ;
     TO (TMP) ;
     FIELD REM.REMITO ,;
     REM.CODCLI ,;
     REM.FECHAEM ,;
     REM.VALORIZ ,;
     REM.CONDPAGO ,;
     REM.FACTURADO,;
     REM.TIPO ;
     FOR &FISC
     SELE REM
     USE
   USE (TMP) ALIAS REM EXCL
   IF FILMER=1
      INDEX ON DTOC(REM.FECHAEM)+REM.REMITO TAG NADA UNIQ
      SET ORDER TO TAG NADA
      GO TOP
   ENDIF
   =UNTALK()
   =UNWORK()
   =RELEWIN("QUERYREM")
   IF FILMER=1
      IF PORPAN
         DO LREMPZ
      ELSE
         DO LREMIZ
      ENDIF
   ELSE
      IF PORPAN
         DO MREMZ
      ELSE
      ENDIF
   ENDIF
   =KTRUCH()
   =REOPREM()
ELSE
   RELE WIND QUERYREM
ENDIF
ELSE
=IAUDI()
ENDIF
RETURN LAST()#27


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QPZ0MLSB0           m.filrem VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         QUERYREM,     Record Number:    2  
*        Variable:            m.filrem                           
*        Called By:           VALID Clause                       
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qpz0mlsb0     &&  m.filrem VALID
#REGION 1
IF READKEY()=15 .OR. READKEY()=271
   if _curobj=2
      SELE REM
      SCAT MEMV BLAN
      STORE "" TO M.ELMESS
      @ 4,2 GET M.REMITO
      READ WHEN RDLEVEL()=2
      M.REMITO=Q_FAC(M.REMITO)
      @ 4,2 SAY M.REMITO
      IF XSEEK(M.REMITO,"REM","REMITO")
         STORE .F. TO DEVENTA
         ELREMITO=REM.REMITO
         SELE REX
         SET ORDER TO TAG REMITO
         SEEK REM.REMITO
         if porpan
            do mrem
         else
            do lremi_NO
         endif
      ENDIF
      _curobj=1
      M.FILREM=1
      @ 4,2 SAY SPACE(15)
      =sget("queryrem")
   else
      MINOBJ=CEIL(_CUROBJ/3)*3+1
      MAXOBJ=MINOBJ+2
      _CUROBJ=MINOBJ
   endif
ENDIF
RETURN .T.
