#DEFINE BOTOM  "  "+repl("°",78)                 && BOTOM
#DEFINE NUL    0                                 && NUL
PROCEDURE CHANGAVI
ULPR=HORA_ULP(PROGRAM())
	=ADIR(ORDENES, PATH+"\XC??????.DBF")
	PUSH KEY CLEAR
	=MOVEWIN(10,0,21,79,"XXACTAVIS"," Orden de Corte N§ "+alltrim(str(NROOCOR))+' ')
	ON KEY LABEL DEL    DO DELEAVI
	ON KEY LABEL INS    DO REPLAVI
	ON KEY LABEL Ctrl+A WAIT ALLTRI(DESCRIPCIO) WIND NOWAIT
	=MEN_LIN("[DEL] BORRA LINEA - [INS] POPUP DE AVIOS (STOCK) - [CTRL+A] DESCRIPCION DE AVIO (PROD)")
	REPL AVIANT WITH AVICODPRO ALL
	BROW FIEL AVICOD:H='ART.S/PRODUCCION':10,;
		AVICODPRO:H='ART.S/COMPRAS':V=REPLALLAVI():E="No se Modific¢":20, ;
		ZA=LOOKUP(AVIS.AVIO, OCO.AVICODPRO, AVIS.AVICODPRO, "AVICODPRO"):H='DESCRIP. COMPRAS':15, ;
		CANTIDAD:H='CANTIDAD':P='9999999.9999':12, ;
		TALLER:H='TALLER':10 , ;
		MEDIDA:H='UNIDAD':5 ;
		FREEZE AVICODPRO IN WIND XXACTAVIS NOMENU 
	=RELEWIN("XXACTAVIS")
	=MEN_LIN(BOTOM)
	POP KEY
RETURN

PROCEDURE REPLAVI
	PUSH KEY CLEA
	IF !EMPTY(ELIAVIS("C¢digo del av¡o",-1,1))
		SELE OCO
		REPL AVICODPRO WITH AVIS.AVICODPRO
		=REPLALLAVI()
	ENDIF
	POP KEY
	=MEN_LIN(BOTOM)
RETURN

FUNCTION REPLALLAVI
	M.SALE=.F.
	IF AVICODPRO#AVIANT
		IF XSEEK(AVICODPRO, "AVIS", "AVICODPRO")
			WAIT ALLTRIM(DESCRIPCIO)+" --> "+ALLTRIM(AVIS.AVIO) WIND NOWAIT
			IF CONFIRMA("C¢digo "+ALLTR(AVICOD)+" --> "+ALLTR(AVIS.AVICODPRO), .T., 20, 30)
************ BATA MODIFICACION PARA QUE NO LO HAGA EN TODOS 19-12-95
************ M.PATODOS=IIF(PREGUNTA("Modifica en TODAS las O.C.", .T., 18, 40)=="SI",.T.,.F.)
				M.PATODOS=.F.
				M.SALE=.T.
				M.AVICOD = AVICOD
				REPL AVICODPRO WITH AVIS.AVICODPRO
				REPL AVIANT    WITH AVICODPRO
				IF PATODOS
					m.recant=recno()
					=PRXAREA(.T.)
					NEWAREA=SELECT()
					FOR XI=1 TO ALEN(ORDENES,1)
						IF DBF("OCO")=(PATH+'\'+ORDENES[XI,1])
							SELE OCO
						ELSE
							SELE (NEWAREA)
							USE (PATH+'\'+ORDENES[XI,1]) 
						ENDIF
						REPL AVICODPRO WITH AVIS.AVICODPRO FOR;
							M.AVICOD = AVICOD .AND. EMPTY(AVICODPRO)
					NEXT
					USE IN (NEWAREA)
					SELE OCO
					go m.recant
				ENDIF
			ENDIF
		ELSE
			=WNCL("Av¡o Inexistente",10)
		ENDIF
		SELE OCO
	ENDIF
	IF !M.SALE
		REPL AVICODPRO WITH AVIANT
		SHOW GETS
	ELSE
		DO SACARESER WITH AVIANT
		DO PONERESER WITH AVICODPRO
	ENDIF
RETURN .T.

PROCEDURE DELEAVI
	DO  SACARESER WITH AVICODPRO
	DELE
RETURN

PROCEDURE SACARESER
PARA CODAVI
	**  BATA 19-12-95  BUSCO LA RESERVA PARA 'DESRESERVAR'
	IF XSEEK(STR(NROOCOR)+CODAVI, "RPV", "NUMAVIO")
		REPL AVIS.STOCKRES WITH AVIS.STOCKRES-RPV.CANTIDAD
		ANTT=SELE()
		SELE RPV
		DELE
		SELE (ANTT)
	ENDIF
RETURN

PROCEDURE PONERESER
PARA CODAVI
	**  BATA 19-12-95  PONE LA RESERVA PARA 'RESERVAR'
	STORE NROOCOR TO M.NUMERO
	STORE CANTIDAD TO M.CANTIDAD
	STORE CODAVI TO M.AVICODPRO
	STORE '' TO TELCODPRO
	=AGRABAR('RPV')
	REPL AVIS.STOCKRES WITH AVIS.STOCKRES+M.CANTIDAD
RETURN