PROCEDURE ICOR_DO
	* EL PROGRAMA DERIVA OPERACIONES SOBRE LA BASE DE CORCADERIAS
	* TRABAJA A PARTIR DE CORRED Y ICOR_DO.SPR
	#DEFINE CRLF CHR(13)+CHR(10)                  && CRLF
	#DEFINE BOTOM  "  "+repl("",78)              && BOTOM
	#DEFINE NUL    0                              && NUL
	#DEFINE PAIP   "|"                            && PAIP
	#DEFINE ENTERCON "PULSE [ENTER] PARA CONTINUAR" && ENTERCON
	FUNCTION ICOR_DO
		DO CASE
		CASE COD_HACER=1                           && CONTROL DE FACTURAS
			=MOVEWIN(10,0,20,79,'WIN',;
				DOSSPAC('Facturas de Talleres - O.C. '+ALLTRIM(STR(COR.NUMERO))+"/"+COR.ARTICULO))
			SELE FAX
			SET RELA TO PRC INTO PRC
			SET RELA TO TALLER INTO PER ADDI
			SET RELA TO REMITO INTO FCO ADDI
			SET ORDER TO TAG NUMTRU
			ON KEY LABEL INS DO IFATAL.SPR
			ON KEY LABEL F2  DO IFATAL.SPR WITH .T.
			BROW FIEL ;
				CL=LEFT(PER.CLIENTE,20):H=PADC("TALLER",20):R,;
				PR=LEFT(PRC.PROCFAB,10):H=PADC("PROCESO",10):R,;
				SSC:H="CANT.":P="99999":R,;
				FCO.FACTURA:H=PADC("FACTURA",15):R,;
				FCO.MONTO:H=PADC("MONTO",9):P="9,999.9999":R,;
				FCO.ELMES:H="MES":P="999":R,;
				FCO.ELANIO:H="A쩙 ":P="9999":R ;
				KEY COR.NUMERO ;
				WIND WIN
			=RELEWIN("WIN")
			=OFF_RELA()
			ON KEY LABEL INS
			ON KEY LABEL F12
		CASE COD_HACER=2                           && BAJA ORDEN DE CORTE
			IF !EMPTY(m.NUMERO) .AND. !EMPTY(m.articulo)
				IF XSEEK(M.NUMERO, "CO1", "NUMERO")
					WAIT WIND NOWA "YA POSEE MERCADER좥 CARGADA"+CRLF+;
						"     NO SE PUEDE ANULAR"
				ELSE
					SELE COR
					=FLOCK() .OR. LOK()
					SET ORDER TO TAG NUMERO
					IF SEEK(M.NUMERO)
						REPL NUMERO WITH 9999999999
						DELE
					ENDIF
					UNLO IN COR
					=IAUD(ALLTRIM(STR(M.NUMERO))+"-"+M.ARTICULO+"-"+DTOC(M.FECHAINI))
					=ANULRES(M.NUMERO)
				ENDIF
			ENDIF
		CASE COD_HACER=3                           && ANULA RESERVA O.C.
			=IIF(COR.RESERVA,ANULRES(COR.NUMERO),CARTEL("NO EXISTE RESERVA",;
				"SOBRE LA ORDEN DE CORTE N "+ALLTRIM(STR(COR.NUMERO)),;
				"ES IMPOSIBLE ANULAR LA RESERVA",;
				ENTERCON))
		CASE COD_HACER=4                           && CARGA RESERVA EN O.C.
			IF EMPTY(COR.FECHAFAB)
				IF COR.RESERVA
					=CARTEL("YA EXISTE RESERVA",;
						"SOBRE LA ORDEN DE CORTE N "+ALLTRIM(STR(COR.NUMERO)),;
						"ES IMPOSIBLE CARGAR RESERVA SIN ANULAR LA EXISTENTE",;
						ENTERCON)
				ELSE
					STORE .F. TO M.SINRESERVA
					=OPCUR()
					=OPTELS()
					=OPAVIS()
					SELE COR
					DO ICO1X.SPR
					=ALTARES(COR.NUMERO)
					SELE COR
					=LOCK() .OR. LOK()
					REPL COR.RESERVA WITH .T.
					UNLO IN COR
				ENDIF
			ELSE
				=CARTEL("LA ORDEN DE CORTE N "+ALLTRIM(STR(COR.NUMERO)),;
					"HA SIDO INICIADA EL DIA "+DTOC(COR.FECHAINI),;
					"ES IMPOSIBLE CARGAR RESERVA DE UNA ORDEN EN ESAS CONDICIONES",;
					ENTERCON)
			ENDIF
		CASE COD_HACER=5                           && LISTADO DE RESERVAS DE UNA O.C.
			=WORKING()
			=DOTALK()
			TMP=GENTMP()
			SELE RPV
			=FLOCK() .OR. FLOK()
			SORT ON AVICODPRO,TELCODPRO TO (TMP) FOR NUMERO=COR.NUMERO .AND. !DELE()
			=UNLO_PRX("RPV",TMP)
			=UNTALK()
			=UNWORK()
			CASO="Orden de Corte N "+alltrim(str(cor.numero))
			TT="Listado de Reservas"+;
				CRLF+;
				CASO
			ACLA=PAIP+;
				PADC("ARTICULO",20)+;
				PAIP+;
				PADC("DESCRIPCION",40)+;
				PAIP+;
				PADC("RESERVA",XACDIGI)+;
				PAIP
			=XPRN1(4,"TMP","LRPV0()",UPPER(CASO),"LRPVO",.T.)
			=OFF_TMP()
		CASE COD_HACER=6                           && CIERRA ORDEN DE CORTE
			=fin_fab()
		CASE COD_HACER=7                           && MUESTRA ESTADO DE O.C. POR PANTALLA
			* 旼 PROGRAMA 컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커
			*   APLICACION: MUESTRA ESTADO DE UNA ORDEN DE CORTE                        
			* 읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸
			SET ORDER TO TAG NUMOT IN REM
			SET ORDER TO TAG TALCOD IN PER
			SELE REM
			IF SEEK(COR.NUMERO)
				ON KEY LABEL TAB DREK=IIF(LEFT(REMITO,1)="M",MREMIF(REMITO),MREM())
				=MEN_LIN("[TAB] Visualiza Datos de Env죓 y Recepci줻 - [ESC] Fin")
				M.ELREG=RECNO()
				COUNT WHILE REM.NUMOT=M.NUMERO TO M.CAREM
				SET ORDER TO TAG TALCOD IN PER
				SET RELA TO REM.TALLER INTO PER ADDI
				DEFI WIND WIN1 FROM 0,0 ;
					TO M.CAREM+3,70 ;
					DOUB ;
					SHAD ;
					TITL " Remitos Generados " ;
					COLO SCHE 3 ;
					FOOT " "+JANNAME+" "
				=CENTWIN("WIN1")
				GO M.ELREG
				BROW FIELD ;
					REMITO:H=PADC("REMITO",15):R ,;
					FECHAOP:H=" FECHA  ":R ,;
					TALLER:H="  CODIGO  ":R ,;
					A=LEFT(PER.CLIENTE,30):H=PADC("TALLER",30):R ;
					FREE REMITO ;
					IN WIN1 NORE;
					KEY M.NUMERO
				=RELEWIN("WIN1")
				SET RELA OFF INTO PER
				ON KEY LABEL TAB
			ELSE
				=CARTEL("NO SE HAN ENCONTRADO",;
					"REMITOS DE LA ORDEN DE "+ALLTRIM(KORTE),;
					"N "+ALLTRIM(STR(M.NUMERO)),;
					"IMPOSIBLE VISUALIZAR")
			ENDIF
		CASE COD_HACER=8                           && MUESTRA ESTADO DE O.C. POR IMPRESORA
			=WORKING()
			=DOTALK()
			TMP=GENTMP()
			SELE fax
			SET ORDER TO
			=FLOCK("FAX") .OR. FLOK("FAX")
			SORT ON REMITO TO (TMP) FOR ;
				FAX.NUMERO=COR.NUMERO .AND. ;
				TIPO="@"
			UNLO IN FAX
			=PRXAREA(.T.)
			USE (TMP) ALIAS TMP EXCL
			TT="ORDEN DE CORTE N "+ALLTRIM(STR(COR.NUMERO))
			=UNWORK()
			=UNTALK()
			DO LCOR1
			SELE TMP
			=OFF_TMP()
		CASE COD_HACER=9                           && MUESTRA ESTADO DE O.C. c/talles POR pantalla
			=men_lin("Buscando Orden de "+korte+" - Espere por Favor")
			SELE CO1
			SET ORDER TO TAG NUMERO
			=FLOCK("CO1") .or. flok("CO1")
			fisc=COR.NUMERO
			IF SEEK(FISC)
				=movewin(0,32,23,77,'win1','LISTA ORDEN DE '+UPPER(KORTE)+' N '+alltrim(STR(FISC)))
				SET DELE OFF
				SET ORDER TO TAG SUECOD IN MIX
				SET RELA TO COLOR INTO MIX
				=MEN_LIN("Ctrl - H para Operaciones")
				BROW FIEL COLOR:H="COLOR":R,;
					MIX.TEXTO1:H="DENOMINACION":R,;
					TALLE:P="99.99":B=XATALMIN,XATALMAX:R,;
					CANTINI:P="9999":H="CANT.";
					TITL 'ORDEN DE '+UPPER(KORTE)+'/ARTICULO:'+ALLTRIM(MER.MERCA)+'-'+COR.ARTICULO ;
					wind win1 ;
					KEY FISC
				=relewin("WIN1")
				=REOPCOR()
				SET DELE ON
			ENDIF
		CASE COD_HACER=10                          && CORRIGE FECHA DE FINALIZACION
			=Cco1F()
		CASE COD_HACER=11                          && CORRIGE TIPO DE ESTRUCTURA
			=Cco1F(.T.)
		ENDCASE
		RETURN .T.
