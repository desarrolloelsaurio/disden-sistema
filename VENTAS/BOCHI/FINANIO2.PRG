ON ERROR DO ELERROR WITH ERROR( )
SET TALK ON
CLEAR
SELE 0
USE C:\FINDE\CCCLI  ALIAS NCCCLI  EXCL
ZAP
SELE 0
USE C:\FINDE\CCCLIH ALIAS NCCCLIH EXCL
ZAP
APPEND FROM \\bochi\zip\VENTASA\CCCLIH
APPEND FROM \\bochi\zip\VENTASA\CCCLI FOR COMPRRE<>"SA" AND COMPRRE<>"SD"
REPLACE COMISION WITH 0 FOR COMISION > 100000
REPLACE COMISIP  WITH 0 FOR COMISIP  > 100000
SCATTER MEMVAR BLANK

SET EXCLUSIVE OFF
SET SAFETY OFF
SET DELETE ON
SET TALK OFF
USE F:\SISTEMAS\VENTAS\VENTASA\PERSONAS ALIAS PER  IN 0
USE F:\SISTEMAS\VENTAS\VENTASA\CCCLIH   ALIAS CCLH IN 0
USE F:\SISTEMAS\VENTAS\VENTASA\CCCLI    ALIAS CCL  IN 0 
tmp=gentmp()
SELE per
SET ORDE TO CODCLI
SCAN FOR CODCLI<>"C000000001"
	SCATTER MEMVAR
	elcli=per.codcli
	SELE NCCCLIH
	SORT ON fechaop TO (tmp) FOR codcli=m.codcli
	SELE 0
	USE (tmp) ALIAS TMP
	
	M.Q = 1
	REPL ALL gy_debe WITH 0,gy_haber WITH 0
	REPL gy_debe WITH monto ;
		FOR comprre="FA" .OR. ;
		comprre="ND" .OR. ;
		comprre="SD"
	REPL gy_haber WITH ABS(monto) FOR EMPTY(gy_debe)
	CALC SUM(gy_debe), SUM(gy_haber) TO tgy_debe, tgy_haber
	STORE tgy_debe-tgy_haber TO M.MONTO

	M.Q = 2
	REPL ALL gy_debe WITH 0,gy_haber WITH 0
	REPL gy_debe WITH COMISION ;
		FOR comprre="FA" .OR. ;
		comprre="ND" .OR. ;
		comprre="SD"
	REPL gy_haber WITH ABS(COMISION) FOR EMPTY(gy_debe)
	CALC SUM(gy_debe), SUM(gy_haber) TO tgy_debe, tgy_haber
	STORE tgy_debe-tgy_haber TO M.COMISION

	M.Q = 3
	REPL ALL gy_debe WITH 0,gy_haber WITH 0
	REPL gy_debe WITH COMISIP ;
		FOR comprre="FA" .OR. ;
		comprre="ND" .OR. ;
		comprre="SD"
	REPL gy_haber WITH ABS(COMISIP) FOR EMPTY(gy_debe)
	CALC SUM(gy_debe), SUM(gy_haber) TO tgy_debe, tgy_haber
	STORE tgy_debe-tgy_haber TO M.COMISIP

	IF ABS(M.MONTO)>0.10
		? M.CODCLI
		??" ----> "
		??M.MONTO
		STORE IIF(M.MONTO>0, "SD", "SA") TO M.COMPR
		STORE CTOD("31/12/2005") TO FECHAOP, FECHAVE, FECHA
		STORE "Saldo al 31/12/2005" TO DETALLE
		STORE ABS(M.MONTO) TO M.CUOTA, M.MONTO
		INSERT INTO NCCCLI FROM MEMV
		sele per
	ENDIF
	USE IN TMP
ENDSCAN
RETURN

PROCEDURE ELERROR
PARA ELNU
IF ELNU=39
	IF M.Q=1
		REPLACE MONTO WITH 0 FOR MONTO>1000000
	ENDIF
	IF M.Q=2
		REPLACE COMISION WITH 0 FOR COMISION >1000000
	ENDIF
	IF M.Q=3
		REPLACE COMISIP WITH 0 FOR COMISIP >1000000
	ENDIF
	RETRY
ENDIF
RETURN
