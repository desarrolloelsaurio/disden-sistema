*       *********************************************************
*       *
*       * 25/07/95            FACTURAS.PRG              14:01:18
*       *
*       *********************************************************
*       *
*       * Author's Name GOYO REINER
*       *
*       * Copyright (c) 1995 Company Name
*       * Description:
*       * This program was automatically generated by GENMENU.
*       *********************************************************
CLEAR
=SETEOS()
=GETPATH2()
RELE SSTM,JANNAME,USADOR,COEFSEG,XACANCHO,XACHOJA,SSTM1,LARGO,LARGOIM,SUCU
RELE IVA09,IVA18,IVA118,IVA109,PC9,PC18,PC27,IVA127
rele xacdigi,ULPR
PUBL SSTM,JANNAME,USADOR,COEFSEG,XACANCHO,XACHOJA,SSTM1,LARGO,LARGOIM,SUCU,FAC_CTD
RELE IVA09,IVA18,IVA118,IVA109,PC9,PC18,PC27,IVA127
publ xacdigi,ULPR
=OPMIX()
=OPAUD()
=OPSEG()
=OPDOC()
=var_prv()
=VAR_CLI()
=var_dni()
=var_iva()
=var_cag()
=VAR_CTD()
=VAR_PAG()
=VAR_MER()
=VAR_PRO()
=VAR_DOLA()

IF GETENV("EQUIPO")="MICASA"
   rest from d:\sistemas\ventas\BOCHI\posic ADDI
ELSE
   rest from posic ADDI
ENDIF
=GETPATH2()
*** DEFINICION DE VARIABLES
SSTM="VENTAS"
SSTM1="DIS-DEN"
JANNAME="DIS-DEN Odontología"
USADOR=GETENV("USERNAME")
LARGOIM=80
COEFSEG=1
XACANCHO=GETNU1(PADR(USADOR,10)+PADR("XACANCHO",20),"FOXPER")
XACHOJA=GETNU1(PADR(USADOR,10)+PADR("XACHOJA",20),"FOXPER")
SUCU="0001-"
IVA09=10.5/100
IVA109=1+IVA09
PC9="10.5 %"
IVA18=21/100
IVA118=1+IVA18
PC18="21 %"
PC27="31.5 %"
IVA127=1.315
STORE .T. TO CAGPOP,CIUPOP,CTDPOP,IVACOD,PRVPOP,PROPOP,DNIPOP,ZONPOP
STORE .T. TO CLIPOP, CTDPOP

*       *********************************************************
*       *                      Menu Definition
*       *********************************************************

**************
**	SUSP
***************
publ camino, camino2
camino="f:\sistemas\ventas\ventasa"
camino2="\\Bochi\zip\ventaDL"

DEFI MENU MAIN
DEFI PAD _r270u1y3g OF MAIN PROMPT "\<Varios" COLOR SCHEME 3 
DEFI PAD _r270u1y40 OF MAIN PROMPT "\<Operaciones" COLOR SCHEME 3 
DEFI PAD _PEDIDOS   OF MAIN PROMPT "P\<edidos" COLOR SCHEME 3 
DEFI PAD _r270u1y5e OF MAIN PROMPT "\<Clientes" COLOR SCHEME 3 
DEFI PAD _r270u1y67 OF MAIN PROMPT "\<Precios" COLOR SCHEME 3 
DEFI PAD _r270u1y6p OF MAIN PROMPT "V\<ariables" COLOR SCHEME 3 
DEFI PAD _r270u1y73 OF MAIN PROMPT "\<Salida" COLOR SCHEME 3 

ON PAD _r270u1y3g OF MAIN ACTI POPUP varios
ON PAD _r270u1y40 OF MAIN ACTI POPUP operacione
ON PAD _pedidos OF MAIN ACTI POPUP pedidos
ON PAD _r270u1y5e OF MAIN ACTI POPUP legajo
ON PAD _r270u1y67 OF MAIN ACTI POPUP precios
ON PAD _r270u1y6p OF MAIN ACTI POPUP variables
ON SELE PAD _r270u1y73 OF MAIN CANCEL

DEFI POPUP varios MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF varios PROMPT "\<Condiciones de Venta"
DEFI BAR 2 OF varios PROMPT "C\<ontrol de Impresoras"
ON SELE BAR 1 OF varios do pag
ON SELE BAR 2 OF varios DO OPCIMP

DEFI POPUP operacione MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF operacione PROMPT "\<Factura"
DEFI BAR 2 OF operacione PROMPT "Factura de \<Bien de Uso"
DEFI BAR 3 OF operacione PROMPT "Factura \<Exenta"
DEFI BAR 4 OF operacione PROMPT "Nota de \<Crédito"
DEFI BAR 5 OF operacione PROMPT "Nota de \<Débito"
DEFI BAR 6 OF operacione PROMPT "\<Ajustes"
DEFI BAR 7 OF operacione PROMPT "\<Cátedras"
DEFI BAR 8 OF operacione PROMPT "\-" SKIP FOR .T.
DEFI BAR 9 OF operacione PROMPT "Listados por \<Pantalla"
DEFI BAR 10 OF operacione PROMPT "Listados por \<Impresora"
DEFI BAR 11 OF operacione PROMPT "\-" SKIP FOR .T.
DEFI BAR 12 OF operacione PROMPT "\<Históricos por Pantalla" 
DEFI BAR 13 OF operacione PROMPT "Hi\<stóricos por Impresora" skip for gete("ADELANTE")="SI"
DEFI BAR 14 OF operacione PROMPT "Libro de Iva x Pantalla" skip for gete("ADELANTE")="SI"
DEFI BAR 15 OF operacione PROMPT "\-" SKIP FOR .T.
DEFI BAR 16 OF operacione PROMPT "Reinde\<xa" skip for gete("ADELANTE")="SI"
DEFI BAR 17 OF operacione PROMPT "\-" SKIP FOR .T.
DEFI BAR 18 OF operacione PROMPT "Comisiones" skip for gete("ADELANTE")="SI"
DEFI BAR 19 OF operacione PROMPT "Anulacion de Presupuestos" BEFORE 15 SKIP FOR USADOR<>"BOCHI" .AND. USADOR<>"GERMAN" 
DEFI BAR 20 OF operacione PROMPT "Notas de Crédito" BEFORE 19

DEFI POPU lacomi MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF lacomi PROMPT "Recalcula factura"
DEFI BAR 2 OF lacomi PROMPT "Modifica factura"
DEFI BAR 3 OF lacomi PROMPT "Recalcula Recibo"
**DEFI BAR 4 OF lacomi PROMPT "Modifica Recibo"
DEFI BAR 4 OF lacomi PROMPT "\-" SKIP FOR .T.
DEFI BAR 5 OF lacomi PROMPT "Busca Errores"
DEFI BAR 6 OF lacomi PROMPT "\-" SKIP FOR .T.
DEFI BAR 7 OF lacomi PROMPT "Rearma Historia"
DEFI BAR 8 OF lacomi PROMPT "Rearma Recibos"
ON SELE BAR 1 OF lacomi DO CALCOMIF.spr
ON SELE BAR 2 OF lacomi DO MODCOMIF 
ON SELE BAR 3 OF lacomi DO CALCOMIR.spr
ON SELE BAR 4 OF lacomi DO MODCOMIR 
ON SELE BAR 5 OF lacomi DO BUSCAMAL
ON SELE BAR 7 OF lacomi DO COMIHIST
ON SELE BAR 8 OF lacomi DO COMIRECI

DEFI POPU losreci MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF losreci PROMPT "Emite Recibo"  skip for .T.
DEFI BAR 2 OF losreci PROMPT "Borra Ajustes"
*ON SELE BAR 1 OF losreci DO RECIBO.SPR
ON SELE BAR 2 OF losreci DO borrarec

*ON SELE BAR 1 OF operacione DO FAC.SPR
*ON BAR 2 OF operacione ACTI POPU LASFACTU
*ON SELE BAR 3 OF operacione DO FAC.SPR WITH .T.,.T.
ON BAR 4 OF operacione ACTI POPU _r990u1yfy
*ON SELE BAR 5 OF operacione DO IDEB.SPR
ON BAR 6 OF operacione ACTI POPUP losreci
*ON SELE BAR 7 OF operacione do catedras
ON BAR 9 OF operacione ACTI POPUP listadospo
ON BAR 10 OF operacione ACTI POPUP _qyj0ydoci
ON SELE BAR 12 OF OPERACIONE DO REIMFAC WITH .T.,"FA",.T.
ON SELE BAR 13 OF OPERACIONE DO REIMFAC WITH .F.,"FA",.T.
***ON SELE BAR 14 OF operacione DO _r270u1yso with 5
ON SELE BAR 14 OF operacione DO _r270u1yso with 5
ON SELE BAR 16 OF operacione DO xfac
ON BAR 18 OF operacione ACTI POPUP lacomi
ON SELE BAR 19 OF operacione DO anulfac

DEFI POPU LASFACTU MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF LASFACTU PROMPT "Común   (al 21%)"
DEFI BAR 2 OF LASFACTU PROMPT "Especial (al 10.5%)"
ON SELE BAR 1 OF LASFACTU DO FAC.SPR WITH .T.
ON SELE BAR 2 OF LASFACTU DO FAC.SPR WITH .T.,.F.,.T.

DEFI POPUP _r990u1yfy MARGIN RELATIVE SHADOW COLOR SCHEME 4
**DEFI BAR 1 OF _r990u1yfy PROMPT "\<Devolución"
DEFI BAR 2 OF _r990u1yfy PROMPT "\<Importe"
**ON SELE BAR 1 OF _r990u1yfy DO DEV.SPR
ON SELE BAR 2 OF _r990u1yfy DO _r270u1yfy

DEFI POPUP pedidos MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF pedidos PROMPT "\<Ingresa Pedido"
DEFI BAR 2 OF pedidos PROMPT "\-" SKIP FOR .T.
DEFI BAR 3 OF pedidos PROMPT "Listados por \<Pantalla"
DEFI BAR 4 OF pedidos PROMPT "Listados por \<Impresora"
DEFI BAR 5 OF pedidos PROMPT "\-" SKIP FOR .T.
DEFI BAR 6 OF pedidos PROMPT "Reinde\<xa Base"

ON SELE POPUP PEDIDOS DO PEDIDO

DEFI POPUP listadospo MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF listadospo PROMPT "Visualiza \<Presupuesto"
DEFI BAR 2 OF listadospo PROMPT "Visualiza Nota de \<Crédito"
DEFI BAR 3 OF listadospo PROMPT "Total Facturado"  skip for gete("ADELANTE")="SI"
DEFI BAR 4 OF listadospo PROMPT "\-" SKIP FOR .T.
DEFI BAR 5 OF listadospo PROMPT "Caja diaria"  
DEFI BAR 6 OF listadospo PROMPT "\-" SKIP FOR .T.
DEFI BAR 7 OF listadospo PROMPT "Ver Comisiones" skip for gete("ADELANTE")="SI"
DEFI BAR 8 OF listadospo PROMPT "Notas de Crédito entre Fechas"

ON SELE BAR 1 OF listadospo DO REIMFAC WITH .T.,"FA"
ON SELE BAR 2 OF listadospo DO REIMFAC WITH .T.,"NC"
ON BAR 3 OF listadospo ACTI POPUP totalfactu
ON sele BAR 5 OF listadospo DO CAJADIA WITH .F.
ON sele BAR 7 OF listadospo DO CALCOMIS
ON sele BAR 8 OF listadospo DO LISTNCFE

DEFI POPUP totalfactu MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF totalfactu PROMPT "\<Completo"  skip for gete("ADELANTE")="SI"
DEFI BAR 2 OF totalfactu PROMPT "Por \<Zona"  skip for gete("ADELANTE")="SI"
DEFI BAR 3 OF totalfactu PROMPT "Por \<Agrupación"  skip for gete("ADELANTE")="SI"
ON SELE BAR 1 OF totalfactu do lfacpan with 1
ON SELE BAR 2 OF totalfactu do lfacpan with 2
ON SELE BAR 3 OF totalfactu do lfacpan with 3

DEFI POPUP _qyj0ydoci MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF _qyj0ydoci PROMPT "\<Reimprime Factura"
DEFI BAR 2 OF _qyj0ydoci PROMPT "Reimprime Nota de \<Crédito"
DEFI BAR 3 OF _qyj0ydoci PROMPT "Reimprime Nota de \<Débito"
DEFI BAR 4 OF _qyj0ydoci PROMPT "R\<eimprime Recibo"
DEFI BAR 5 OF _qyj0ydoci PROMPT "\-" SKIP FOR .T.
DEFI BAR 6 OF _qyj0ydoci PROMPT "F\<acturas entre Fechas"  skip for gete("ADELANTE")="SI"
DEFI BAR 7 OF _qyj0ydoci PROMPT "Rec\<ibos entre Fechas" skip for gete("ADELANTE")="SI"
DEFI BAR 8 OF _qyj0ydoci PROMPT "\<Libro de Iva" skip for gete("ADELANTE")="SI"
DEFI BAR 9 OF _qyj0ydoci PROMPT "F\<acturas Mayores a 10000" skip for gete("ADELANTE")="SI"
DEFI BAR 10OF _qyj0ydoci PROMPT "Operaciones Trimestrales Mayores a 15000" skip for gete("ADELANTE")="SI"
DEFI BAR 11 OF _qyj0ydoci PROMPT "Operaciones Mensuales Mayores a 10000" skip for gete("ADELANTE")="SI"
DEFI BAR 12 OF _qyj0ydoci PROMPT "\-" SKIP FOR .T.
DEFI BAR 13 OF _qyj0ydoci PROMPT "Caja diaria" skip for gete("ADELANTE")="SI"
DEFI BAR 14 OF _qyj0ydoci PROMPT "\-" SKIP FOR .T.
DEFI BAR 15 OF _qyj0ydoci PROMPT "Cátedras"
DEFI BAR 16 OF _qyj0ydoci PROMPT "Notas de Créditos" skip for gete("ADELANTE")="SI"

ON SELE BAR 1 OF _qyj0ydoci DO REIMFAC WITH .F.,"FA"
ON SELE BAR 2 OF _qyj0ydoci DO REIMFAC WITH .F.,"NC"
ON SELE BAR 3 OF _qyj0ydoci DO REIMFAC WITH .F.,"ND"
ON SELE BAR 4 OF _qyj0ydoci DO _r270u1yr7
ON BAR 6 OF _qyj0ydoci ACTI POPUP facturasen
ON SELE BAR 7 OF _qyj0ydoci do cajadia with .T.,.T.
ON SELE BAR 8 OF _qyj0ydoci DO _r270u1yso with 1
ON SELE BAR 9 OF _qyj0ydoci DO _f10000
ON SELE BAR 10 OF _qyj0ydoci DO _f15000
ON SELE BAR 11 OF _qyj0ydoci DO _f11000
ON SELE BAR 13 OF _qyj0ydoci DO CAJADIA WITH .T.
ON SELE BAR 15 OF _qyj0ydoci DO  catedimp
ON SELE BAR 16 OF _qyj0ydoci DO LISTNCFE with .T.

DEFI POPUP tilibiva MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF tilibiva PROMPT "Facturas A-\<1"
DEFI BAR 2 OF tilibiva PROMPT "Facturas A-\<2"
DEFI BAR 3 OF tilibiva PROMPT "Facturas \<B-1"
DEFI BAR 4 OF tilibiva PROMPT "Facturas \<B-2"

ON SELE BAR 1 OF tilibiva DO _r270u1yso with 1
ON SELE BAR 2 OF tilibiva DO _r270u1yso with 2
ON SELE BAR 3 OF tilibiva DO _r270u1yso with 3
ON SELE BAR 4 OF tilibiva DO _r270u1yso with 4

DEFI POPUP facturasen MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF facturasen PROMPT "\<Todas las Facturas"  skip for gete("ADELANTE")="SI"
DEFI BAR 2 OF facturasen PROMPT "Facturas \<A"  skip for gete("ADELANTE")="SI"
DEFI BAR 3 OF facturasen PROMPT "Facturas \<B"  skip for gete("ADELANTE")="SI"
DEFI BAR 4 OF facturasen PROMPT "\-" SKIP FOR .T.
DEFI BAR 5 OF facturasen PROMPT "Por \<Zona"  skip for gete("ADELANTE")="SI"
DEFI BAR 6 OF facturasen PROMPT "Por A\<grupación" skip for gete("ADELANTE")="SI"

ON SELE BAR 1 OF facturasen DO _r270u1zfp
ON SELE BAR 2 OF facturasen DO _r270u1zgu
ON SELE BAR 3 OF facturasen DO _r270u1zhx
ON SELE BAR 5 OF facturasen DO faporzon
ON SELE BAR 6 OF facturasen DO faporagr

DEFI POPUP legajo MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF legajo PROMPT "\<Datos Administrativos"
DEFI BAR 2 OF legajo PROMPT "\<Legajo del Cliente"
DEFI BAR 3 OF legajo PROMPT "Resumen de Cuenta por \<Pantalla"
DEFI BAR 4 OF legajo PROMPT "Resumen de Cuenta por \<Impresora"
DEFI BAR 5 OF legajo PROMPT "\<Agrupación"
DEFI BAR 6 OF legajo PROMPT "\<Reimputa Pagos" skip for gete("ADELANTE")="SI"
DEFI BAR 7 OF legajo PROMPT "\-"  SKIP FOR .t.
DEFI BAR 8 OF legajo PROMPT "Ran\<king por Pantalla" skip for gete("ADELANTE")="SI"
DEFI BAR 9 OF legajo PROMPT "Rank\<ing por Impresora" skip for gete("ADELANTE")="SI"
DEFI BAR 10 OF LEGAJO PROM "Borra Movimientos Saldo \<0" BEFORE 7 skip for gete("ADELANTE")="SI"
DEFI BAR  11 OF legajo PROMPT "\-"  SKIP FOR .t.
DEFI BAR  12 OF legajo PROM "Histórico por Pantalla" 
DEFI BAR  13 OF legajo PROM "Histórico por Impresora" skip for gete("ADELANTE")="SI"


ON SELE BAR 1 OF legajo do cli
ON SELE BAR 2 OF legajo do cli
ON BAR 3 OF legajo ACTI POPUP _r270tz53f
ON BAR 4 OF legajo ACTI POPUP resumendec
ON SELE BAR 5 OF legajo do cli
ON BAR 6 OF legajo ACTI POPUP reimputapa
ON BAR 8 OF legajo ACTI POPUP rankingpor
ON BAR 9 OF legajo ACTI POPUP _r180hr6e9
ON SELE BAR 10 OF LEGAJO DO CCLH0
ON SELE BAR 12 OF legajo do cli
ON SELE BAR 13 OF legajo do cli

DEFI POPUP _r270tz53f MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF _r270tz53f PROMPT "\<Un Cliente"
DEFI BAR 2 OF _r270tz53f PROMPT "Más de \<30 días" 
DEFI BAR 3 OF _r270tz53f PROMPT "Más de 30 días por \<Agrup." 
DEFI BAR 4 OF _r270tz53f PROMPT "Más de \<60 días" skip for gete("ADELANTE")="SI"
DEFI BAR 5 OF _r270tz53f PROMPT "Más de 60 días por \<Agrup." skip for gete("ADELANTE")="SI"
DEFI BAR 6 OF _r270tz53f PROMPT " \<No compra desde una Fecha" skip for gete("ADELANTE")="SI"
DEFI BAR 7 OF _r270tz53f PROMPT "\<Resumido" 
ON SELE BAR 1 OF _r270tz53f DO CLI
ON SELE BAR 2 OF _r270tz53f DO _r270u1zrh with .F.,30
ON SELE BAR 3 OF _r270tz53f DO _r270u1zrh with .T.,30
ON SELE BAR 4 OF _r270tz53f DO _r270u1zrh with .F.,60
ON SELE BAR 5 OF _r270tz53f DO _r270u1zrh with .T.,60
ON SELE BAR 6 OF _r270tz53f DO infieles.spr with .T.
ON SELE BAR 7 OF _r270tz53f DO RDCNORMAL WITH .F., .T.

DEFI POPUP resumendec MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF resumendec PROMPT "\<Resumido" 
DEFI BAR 2 OF resumendec PROMPT "R\<esumido por Zona" 
DEFI BAR 3 OF resumendec PROMPT "Resumido por L\<ocalidad" 
DEFI BAR 4 OF resumendec PROMPT "Resu\<mido por Agrupacion" 
DEFI BAR 5 OF resumendec PROMPT "\-" SKIP FOR .T.
DEFI BAR 6 OF resumendec PROMPT "\<Completo" 
DEFI BAR 7 OF resumendec PROMPT "Completo por \<Agrup." 
DEFI BAR 8 OF resumendec PROMPT "Completo por \<Zona" 
DEFI BAR 9 OF resumendec PROMPT "Completo por \<Localidad" 
DEFI BAR 10 OF resumendec PROMPT "Resumen de Cta \<un Cliente"
DEFI BAR 11 OF resumendec PROMPT "Más de \<30 días de Retraso"
DEFI BAR 12 OF resumendec PROMPT "Más de 30 días de Retraso por \<Agrup." 
DEFI BAR 13 OF resumendec PROMPT "Más de \<60 días de Retraso" skip for gete("ADELANTE")="SI"
DEFI BAR 14 OF resumendec PROMPT "Más de 60 días de Retraso por \<Agrup." skip for gete("ADELANTE")="SI"
DEFI BAR 15 OF resumendec PROMPT "\<Análisis de un Cliente" skip for gete("ADELANTE")="SI"
DEFI BAR 16 OF resumendec PROMPT "\<Listado para comisiones" skip for gete("ADELANTE")="SI"
DEFI BAR 17 OF resumendec PROMPT "\<Listado para comisiones Leone Rosario" skip for gete("ADELANTE")="SI"
DEFI BAR 18 OF resumendec PROMPT "\-" SKIP FOR .T.
DEFI BAR 19 OF resumendec PROMPT " \<No compra desde una Fecha" skip for gete("ADELANTE")="SI"
ON SELE BAR 1 OF resumendec DO RDCNORMAL WITH .F., .F.
ON SELE BAR 2 OF resumendec DO RDCZONA WITH .F.
ON SELE BAR 3 OF resumendec DO RDCPORLO WITH .F.
ON SELE BAR 4 OF resumendec DO RDCAGRUP WITH .F.
ON SELE BAR 6 OF resumendec DO RDCNORMAL WITH .T., .F.
ON SELE BAR 7 OF resumendec DO RDCAGRUP WITH .T.
ON SELE BAR 8 OF resumendec DO RDCZONA WITH .T.   
ON SELE BAR 9 OF resumendec DO RDCPORLO WITH .T.
ON SELE BAR 10 OF resumendec DO CLI
ON SELE BAR 11 OF resumendec DO _r270u201w with .F.,30
ON SELE BAR 12 OF resumendec DO _r270u201w with .T.,30
ON SELE BAR 13 OF resumendec DO _r270u201w with .F.,60
ON SELE BAR 14 OF resumendec DO _r270u201w with .T.,60
ON SELE BAR 15 OF resumendec DO LANACCLI
ON SELE BAR 16 OF resumendec DO LCOMICO
ON SELE BAR 17 OF resumendec DO LCOMPCO
ON SELE BAR 19 OF resumendec DO infieles.spr with .F.

DEFI POPUP reimputapa MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF reimputapa PROMPT "\<Todos los Clientes"  skip for gete("ADELANTE")="SI"
DEFI BAR 2 OF reimputapa PROMPT "\<Un Cliente" skip for gete("ADELANTE")="SI"
ON SELE BAR 1 OF reimputapa DO _r270u2050
ON SELE BAR 2 OF reimputapa DO _r270u2062

DEFI POPUP rankingpor MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF rankingpor PROMPT "\<Facturas" skip for gete("ADELANTE")="SI"
DEFI BAR 2 OF rankingpor PROMPT "Notas de \<Débito" skip for gete("ADELANTE")="SI"
DEFI BAR 3 OF rankingpor PROMPT "Notas de Crédito" skip for gete("ADELANTE")="SI"
ON BAR 1 OF rankingpor ACTI POPUP facturas skip for gete("ADELANTE")="SI"

DEFI POPUP facturas MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF facturas PROMPT "\<Completo" skip for gete("ADELANTE")="SI"
DEFI BAR 2 OF facturas PROMPT "Por \<Agrupación" skip for gete("ADELANTE")="SI"
DEFI BAR 3 OF facturas PROMPT "Por \<Zona" skip for gete("ADELANTE")="SI"
ON SELE BAR 1 OF facturas DO LRANKC WITH .t.,"F",1
ON SELE BAR 2 OF facturas DO LRANKC WITH .t.,"F",2
ON SELE BAR 3 OF facturas DO LRANKC WITH .t.,"F",3

DEFI POPUP _r180hr6e9 MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF _r180hr6e9 PROMPT "\<Completo" skip for gete("ADELANTE")="SI"
DEFI BAR 2 OF _r180hr6e9 PROMPT "Por \<Agrupación" skip for gete("ADELANTE")="SI"
DEFI BAR 3 OF _r180hr6e9 PROMPT "Por \<Zona" skip for gete("ADELANTE")="SI"
ON SELE BAR 1 OF _r180hr6e9 DO LRANKC WITH .f.,"F",2
ON SELE BAR 2 OF _r180hr6e9 DO LRANKC WITH .f.,"F",2
ON SELE BAR 3 OF _r180hr6e9 DO LRANKC WITH .f.,"F",3

DEFI POPUP precios MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF precios PROMPT "Por Rubro"
DEFI BAR 2 OF precios PROMPT "Por Proveedor"
DEFI BAR 3 OF precios PROMPT "Por Teclado"
DEFI BAR 4 OF precios PROMPT "Completo"
*DEFI BAR 5 OF precios PROMPT "\-" SKIP FOR  .T.
*DEFI BAR 6 OF precios PROMPT "Presupuesto por Pantalla"
*DEFI BAR 7 OF precios PROMPT "Presupuesto por Impresora"
ON SELE BAR 1 OF precios DO _r270u20ha
ON SELE BAR 2 OF precios DO _r270u20if
ON SELE BAR 3 OF precios DO _r270u20jh
ON SELE BAR 4 OF precios DO _r270u20kk
*ON SELE BAR 6 OF precios DO PRESUP WITH "P"
*ON SELE BAR 7 OF precios DO PRESUP WITH "I"

DEFI POPUP variables MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFI BAR 1 OF variables PROMPT "\<Popups a Utilizar"
DEFI BAR 2 OF variables PROMPT "Modifica \<Porcentajes" skip for gete("ADELANTE")="SI"
DEFI BAR 3 OF variables PROMPT "Cantidad de Dígitos"
DEFI BAR 4 OF variables PROMPT "Actualiza Nº de Factura"
DEFI BAR 5 OF variables PROMPT "Ingresa Valor de U$S"
DEFI BAR 6 OF variables PROMPT "Reindexa todas las Bases" skip for gete("ADELANTE")="SI"
ON SELE BAR 1 OF variables do acpopu.spr
ON SELE BAR 2 OF variables DO ACPORC.SPR
ON SELE BAR 3 OF variables do acdigi
ON SELE BAR 4 OF variables do xanum.spr
ON SELE BAR 5 OF variables DO ACDOLAR.SPR
ON SELE BAR 6 OF variables do reinall

*       *********************************************************
*       *                 Cleanup Code & Procedures
*       *********************************************************

DO WHILE .T.
   UNLO ALL
   ACTI MENU MAIN
   IF LAST()=27 .AND. ;
      (GETENV("USERNAME")="GOYO" or GETENV("USERNAME")="BATA")
      IF INKEY(0)=27
         EXIT
      ENDIF
   ENDIF
ENDDO
SET SYSM TO DEFA
RETURN

*       *********************************************************
*       * _R270U1YFY  ON SELE BAR 3 OF POPUP operacione
*       * From Menu:  FACTURAS.MPR,            Record:   11
*       * Called By:  ON SELE BAR 3 OF POPUP operacione
*       * Prompt:     Nota de Crédito
*       * Snippet:    1
*       *********************************************************
*
PROCEDURE _r270u1yfy
DO ICRE.SPR
=RELEWIN("IDEB")


*       *********************************************************
*       * _R270U1YR7  ON SELE BAR 4 OF POPUP _qyj0ydoci
*       * From Menu:  FACTURAS.MPR,            Record:   44
*       * Called By:  ON SELE BAR 4 OF POPUP _qyj0ydoci
*       * Prompt:     Reimprime Recibo
*       * Snippet:    3
*       *********************************************************
*
PROCEDURE _r270u1yr7
ULPR=HORA_ULP("REIMRC")

**=opcli()
**=opccl()
**=OPCCLH()
**=opmix()
**sele doc
**go 3
**finrec=doc.numero
**store nul to respuesta
**elrec=infic("Recibo a Reimprimir",finrec)
**if last()#27 .and.  !empty(elrec)
**	sele ccl
**	set order to tag numerore
**	elrec=" 0001-"+zero(elrec,8)
**	if !seek(elrec)
**	     SELE CCLH
**		set order to tag numerore
**		if !seek(elrec)
**	WAIT "RECIBO "+ELREC+" NO ENCONTRADO" WIND
**	RETURN
**	     endif
**  endif

IF ELIREC()
	TMP=GENTMP()
	COPY TO (TMP) next 1
	STORE 0 TO TGY_DEBE,TGY_HABER,TGY_SALDO
	TGY_SALDO=SAYSALDO(CODCLI)
	SELE CCL
	use
	USE (TMP) ALIAS ccl
	REPO FORM LRECI ;
	   NOCONSOLE TO PRIN PROMPT
	=off_tmp()
ELSE
	WAIT "RECIBO "+ELREC+" NO ENCONTRADO" WIND
	RETURN
ENDIF
RETU
*
PROCEDURE borrarec
**IF USADOR="BOCHI" 
**=oprcb()
**=opcli()
**=opccl()
**=opmix()
**sele doc
**go 3
**=lock() .or. lok()
**finrec=doc.numero
**store nul to respuesta
**elrec=infic("Recibo a Anular",finrec)
**if last()#27 .and. !empty(elrec)
**	sele ccl
**	set order to tag numerore
**	elrec=" 0001-"+zero(elrec,8)
**	if seek(elrec)
	if elirec()
		m.fechaop=fechaop
		m.codcli   =codcli
		STORE 0 TO TGY_DEBE,TGY_HABER,TGY_SALDO
*		TGY_SALDO=SAYSALDO(CCL.CODCLI)
		SELE CCL
		ELREC=CCL.compr
*		SET ORDER TO
*		REPO FORM LRECI ;
*			FOR CCL.compr=ELREC prev
*		wait "1 -"+ELREC+"*" wind
		if !empty(ELREC)
			if confirma("Borrar el ajuste",.t.,20,10)
				dele for  CCL.compr=ELREC
*				sele rcb
*				locate for fechaop=m.fechaop .and. codcli=m.codcli
*				dele
   			endif
   		endif
	else
		WAIT " NO ENCONTRADO" WIND
	endif
**endif
**endif

*       *********************************************************
*       * _R270U1YSO  ON SELE BAR 7 OF POPUP _qyj0ydoci
*       * From Menu:  FACTURAS.MPR,            Record:   52
*       * Called By:  ON SELE BAR 7 OF POPUP _qyj0ydoci
*       * Prompt:     Libro de Iva
*       * Snippet:    4
*       *********************************************************
*
PROCEDURE _r270u1yso
parameter quelisiva
if !pideclav(1)
	return
endif
=OPCLI()
=OPFAC()
sele fac
SET ORDE TO
go bott
m.cualfe=fechaem
m.cualfe=gomonth(m.cualfe, -1)
m.mesanio= str(month (m.cualfe),2)+str(year(m.cualfe),4)
SET ORDE TO TAG FACTURA 
***m.mesanio=mesanio("Período del Libro de IVA",.t.,.t.)
***if last()#27 .and. confirma("Libro de Iva",.t.,20,10)
   ulpr="liva"
   =relewin("win")
   m.elmes=val(left(mesanio,2))
   m.elanio=val(right(mesanio,4))

***   do case
***   	case quelisiva=1
***   		lasok="A0001"
***   	case quelisiva=2
***   		lasok="A0002"   
***   	case quelisiva=3
***   		lasok="B0001"   
***   	case quelisiva=4
***   		lasok="B0002"   
***   	case quelisiva=5
***   		LASOK=""
***   		=CLOSDBF("FAC")
***   		=CLOSDBF("FAX")
***   		=OPFAH()   
***   endcase
   	 IF quelisiva=5
   		=CLOSDBF("FAC")
   		=CLOSDBF("FAX")
   		=OPFAH()
   	ENDIF
   TT="Libro de IVA VENTAS"
   tt1="Del mes de "+qmes(elmes)+" de "+;
   alltrim(str(elanio))
   =dotalk()
   SELE FAC
***   SET ORDER TO 
   tmp=gentmp()
***   IF QUELISIVA=5
 	   SELECT * FROM fac fac ;
 	      WHERE month(fac.fechaem)=m.elmes .and. ;   
                         year(fac.fechaem)=m.elanio ;
	      INTO TABLE (tmp) ;
	      ORDER BY fac.fechaem, fac.factura
use
***	   sort on factura to (tmp) for ;
***		month(fac.fechaem)=m.elmes .and. ;   
***	   	year(fac.fechaem)=m.elanio 
***	   QUELISIVA=3
***   ELSE
***  	sort on factura to (tmp) for ;
***   		month(fac.fechaem)=m.elmes .and. ;   
***   		year(fac.fechaem)=m.elanio .and. ;
***   		LEFT(FACTURA,5)=LASOK .and. ;
***   		fac.montobru#fac.montonet  
***   ENDIF
   =unlo_prx("fac",tmp,"tmp")
   =untalk()
***   repo form lfac2
   repo form lfac3 ;
   noconsole ;   
   to prin PROMPT   
   =off_tmp()
***else
***   =relewin("win")
***endif

*       *********************************************************
*       *
*       * _R270U1ZFP  ON SELE BAR 1 OF POPUP facturasen
*       *
*       * Procedure Origin:
*       *
*       * From Menu:  FACTURAS.MPR,            Record:   49
*       * Called By:  ON SELE BAR 1 OF POPUP facturasen
*       * Prompt:     Todas las Facturas
*       * Snippet:    17
*       *
*       *********************************************************
*
PROCEDURE _r270u1zfp
if !pideclav(1)
	return
endif
=OPCLI()
=OPFAC()
store {} to m.fecini,m.fecfin
if entre_fe("a Listar")
TT="Listado de Facturas Emitidas"
tt1="Entre el "+dtoc(m.fecini)+" y el "+dtoc(m.fecfin)
repo form lfac1 ;
for fac.fechaem>=m.fecini .and. ;
fac.fechaem<=m.fecfin ;
noconsole ;
to prin PROMPT
endif


*       *********************************************************
*       *
*       * _R270U1ZGU  ON SELE BAR 2 OF POPUP facturasen
*       *
*       * Procedure Origin:
*       *
*       * From Menu:  FACTURAS.MPR,            Record:   50
*       * Called By:  ON SELE BAR 2 OF POPUP facturasen
*       * Prompt:     Facturas A
*       * Snippet:    18
*       *
*       *********************************************************
*
PROCEDURE _r270u1zgu
if !pideclav(1)
	return
endif
=OPCLI()
=OPFAC()
store {} to m.fecini,m.fecfin
if entre_fe("a Listar")
TT="Listado de Facturas 'A' Emitidas"
tt1="Entre el "+dtoc(m.fecini)+" y el "+dtoc(m.fecfin)
repo form lfac1 ;
for left(fac.factura,1)="A" .and. fac.fechaem>=m.fecini .and. ;
fac.fechaem<=m.fecfin ;
noconsole ;
to prin PROMPT
endif


*       *********************************************************
*       *
*       * _R270U1ZHX  ON SELE BAR 3 OF POPUP facturasen
*       *
*       * Procedure Origin:
*       *
*       * From Menu:  FACTURAS.MPR,            Record:   51
*       * Called By:  ON SELE BAR 3 OF POPUP facturasen
*       * Prompt:     Facturas B
*       * Snippet:    19
*       *
*       *********************************************************
*
PROCEDURE _r270u1zhx
if !pideclav(1)
	return
endif
=OPCLI()
=OPFAC()
store {} to m.fecini,m.fecfin
if entre_fe("a Listar")
TT="Listado de Facturas 'B' Emitidas"
tt1="Entre el "+dtoc(m.fecini)+" y el "+dtoc(m.fecfin)
repo form lfac1 ;
for left(fac.factura,1)="B" .and. fac.fechaem>=m.fecini .and. ;
fac.fechaem<=m.fecfin ;
noconsole ;
to prin PROMPT
endif

*       *********************************************************
*       *
*       * _R270U1ZRH  ON SELE BAR 2 OF POPUP _r270tz53f
*       *
*       * Procedure Origin:
*       *
*       * From Menu:  FACTURAS.MPR,            Record:   60
*       * Called By:  ON SELE BAR 2 OF POPUP _r270tz53f
*       * Prompt:     Más de 30 días
*       * Snippet:    21
*       *
*       *********************************************************
*
PROCEDURE _r270u1zrh
para concag, M.DIAS
if M.DIAS>30
	if !pideclav(1)
		return
	endif
endif
ULPR="LCCL30"
STORE .T. TO RESUMEN
=opcli()
SET ORDER TO TAG CODCLI
*********************************************             =FLOCK() .OR. FLOK()
fisc=".T."
if concag
=OPCAG()
STORE NUL TO M.RESPUESTA
STORE 2 TO M.FILCAG
STORE "" TO FISC,TT,TTCAG,QUECAG
=QW_CAG(.F.,.F.,"PER.CAG")
IF QUECAG#".F."
      FISC=QUECAG
      TT=TTCAG
ELSE
      STORE .F. TO M.OK
      =NOSELEC("AGRUPACION")
ENDIF
endif
************************************************
=opccl()
SET RELA TO CODCLI INTO PER
TMP=GENTMP()
=WORKING()
=DOTALK()
***********=FLOCK() .OR. FLOK()
SORT ON PER.CLIENTE,FECHAOP TO (TMP) FOR !EOF('PER') .AND. ;
	!DELE() .AND. ;
	DATE()-CCL.FECHAOP>m.dias .AND. ;
	ESDEBE(CCL.COMPRRE) .AND. ;
	!CCL.PAGADA .AND. ;
	CCL.CUOTA<CCL.MONTO .AND. &FISC
UNLO ALL
SELE CCL
USE
USE (TMP) ALIAS CCL
=UNWORK()
=UNTALK()
STORE NUL TO RESPUESTA
repo form LCCL30 prev
=OFF_TMP()

PROCEDURE RDCNORMAL
PARA RESUMEN, PORPANTA
ULPR="LCCLUT"
=OPCLI()
SET ORDER TO TAG CODCLI
=OPCCL()
SET RELA TO CODCLI INTO PER
TMP=GENTMP()
=WORKING()
SORT ON PER.CLIENTE,FECHAOP TO (TMP)  FOR !DELE()
SELE CCL
USE
USE (TMP) ALIAS CCL
=UNWORK()
IF RESUMEN
	IF PORPANTA
     repo form LCCLt noconsole PREV
    ELSE 
     repo form LCCLt noconsole to prin PROMPT
	ENDIF
ELSE
	IF PORPANTA
     repo form LCCLt summ noconsole PREV
    ELSE 
     repo form LCCLt summ noconsole to prin PROMPT
	ENDIF
ENDIF

=OFF_TMP()


PROCEDURE  RDCZONA
PARA RESUMEN
ULPR="LCCLUTZ"
DO OPZON
IF ELIZON("a Listar",-1,1)
lazon=left(mix.texto2,2)
=OPCLI()
SET ORDER TO TAG CODCLI
=OPCCL()
SET RELA TO CODCLI INTO PER
TMP=GENTMP()
=WORKING()
SORT ON PER.CLIENTE,FECHAOP TO (TMP) ;
	for !DELE() .AND. per.texto1=lazon
tt="Zona:"+alltrim(mix.texto1)
SELE CCL
USE
USE (TMP) ALIAS CCL
=UNWORK()
STORE NUL TO RESPUESTA
IF RESUMEN
	repo form LCCLt noconsole to prin PROMPT
ELSE
	repo form LCCLt summ noconsole to prin PROMPT
ENDIF
=OFF_TMP()
endif

prOCEDURE RDCPORLO
PARA RESUMEN
=OPCIU()
IF !EMPTY(ELICIU("a Listar",-1,1))
   	store subs(mix.texto2,7,6) to elcod
   	store alltrim(mix.texto1) to laloca
	=OPCAG()
	=opcli()
	=opccl()
	ULPR="LCCLUTA"
	STORE NUL TO M.RESPUESTA
   	STORE 2 TO M.FILCAG
   	STORE "" TO FISC,TT,TTCAG,QUECAG
   	=QW_CAG(.F.,.F.,"PER.CAG")
      SELE PER
      SET ORDER TO TAG CLIENTES
   	IF QUECAG#".F."
		FISC="PER.LOCALIDAD='"+ELCOD+"'  .AND. "+QUECAG
      	TT=TTCAG+chr(13)+"Por Localidad: "+laloca
   	ELSE
      	STORE .F. TO M.OK
		FISC="PER.LOCALIDAD="+ELCOD
      	TT="Por Localidad: "+laloca
      	=NOSELEC("AGRUPACION")
   	ENDIF
   	sele ccl
   	SET ORDER TO TAG CODCLI IN PER
   	SET RELA TO CODCLI INTO PER
	TMP=GENTMP()
	=WORKING()
	SORT ON PER.CLIENTE,FECHAOP TO (TMP) ;
               for !DELE() .AND. &fisc
	SELE CCL
	USE
	USE (TMP) ALIAS CCL
	=UNWORK()
	STORE NUL TO RESPUESTA
	IF RESUMEN
		repo form LCCLt noconsole to prin PROMPT
	ELSE
		repo form LCCLt summ noconsole to prin PROMPT
	ENDIF
	=OFF_TMP()
ENDIF
return

prOCEDURE RDCAGRUP
PARA RESUMEN
=OPCAG()
=opcli()
=opccl()
ULPR="LCCLUTA" 
store .T. to resumen
STORE NUL TO M.RESPUESTA
STORE 2 TO M.FILCAG
STORE "" TO FISC,TT,TTCAG,QUECAG
=QW_CAG(.F.,.F.,"PER.CAG")
IF QUECAG#".F."
      SELE PER
      SET ORDER TO TAG CLIENTES
      FISC=QUECAG
      TT=TTCAG
ELSE
      STORE .F. TO M.OK
      =NOSELEC("AGRUPACION")
ENDIF
store {} to m.fecini,m.fecfin
=entre_fe("a Listar")
TT=TTCAG+chr(13)+" Entre el "+dtoc(m.fecini)+" y el "+dtoc(m.fecfin)
TMP0=GENTMP()
TMP1=GENTMP()
TMP2=GENTMP()
TMP3=GENTMP()
=WORKING()
=DOTALK()
sele ccl
set orde to
SET ORDER TO TAG CODCLI IN PER
SET RELA TO CODCLI INTO PER
SORT ON codcli TO (TMP0) for !DELE() .AND. &fisc
set rela to
SELE 0
USE (TMP0) ALIAS TMP0
copy to (TMP1) for betw(fechaop, m.fecini, m.fecfin)
SELE 0
USE (TMP1) ALIAS TMP1
inde on codcli tag codcli
SELE TMP0
repl gy_debe  with 0, gy_haber with 0 all
repl gy_debe  with monto for esdebe(comprre)
repl gy_haber with monto for !esdebe(comprre)
TOTAL  ON  CODCLI  TO (TMP2) ;
	FIELD gy_debe, gy_haber ;
	for fechaop < m.fecini
sele 0
use (TMP2) alias tmp2
repl fechaop with m.fecini - 1, ;
	fechave with m.fecini - 1, ;
	detalle   with 'SALDO ANTERIOR',;
	monto    with abs(gy_DEBE - GY_haber), ;
	comprre with iif(gy_DEBE > GY_haber, 'SD', 'SA') all
SELE TMP1
append from (tmp2)
SET ORDER TO TAG CODCLI IN PER
dele for !seek(codcli, 'PER')
SET RELA TO CODCLI INTO PER
sort on PER.CLIENTE,FECHAOP to (tmp3)
sele ccl
use
use (TMP3) alias CCL
=UNTALK()
=UNWORK()
STORE NUL TO RESPUESTA
IF RESUMEN
	repo form LCCLt   noconsole   to prin PROMPT
ELSE
	repo form LCCLt   summ noconsole   to prin PROMPT
 ENDIF
 =OFF_TMP()
return

prOCEDURE LCOMICO
if !pideclav(1)
	return
endif
=OPCAG()
=opcli()
=opccl()
ULPR="LCCLUTC" 
store .T. to resumen
STORE NUL TO M.RESPUESTA
STORE 2 TO M.FILCAG
STORE "" TO FISC,TT,TTCAG,QUECAG
=QW_CAG(.F.,.F.,"PER.CAG")
IF QUECAG#".F."
      SELE PER
      SET ORDER TO TAG CLIENTES
      FISC=QUECAG
      TT=TTCAG
ELSE
      STORE .F. TO M.OK
      =NOSELEC("AGRUPACION")
ENDIF
store {} to m.fecini,m.fecfin
=entre_fe("a Listar")
TT=TTCAG+chr(13)+" Entre el "+dtoc(m.fecini)+" y el "+dtoc(m.fecfin)
FISC=FISC+' .AND.betw(fechaop, m.fecini, m.fecfin)'
TMP00=GENTMP()
TMP01=GENTMP()
=WORKING()
=DOTALK()
TMP=GENTMP()
sele ccl
set orde to
SET ORDER TO TAG CODCLI IN PER
SET RELA TO CODCLI INTO PER
COPY TO (TMP01) for !DELE() .AND. &fisc
set rela to
SELE 0
USE (TMP01) ALIAS tmp
********
=opcclh()
set orde to
SET RELA TO CODCLI INTO PER
COPY TO (TMP00) for !DELE() .AND. &fisc
sele tmp
APPEND FROM (tmp00) 
SET RELA TO CODCLI INTO PER
replace marka with .F. all
replace marka with .T. for EMPTY(AT("MA",PER.CAG))
SORT ON PER.CLIENTE,FECHAOP TO (TMP)
set rela to
********
sele ccl
USE
USE (TMP) ALIAS CCL
repl gy_debe  with COMISION for esdebe(comprre)
repl gy_haber with COMISION for !esdebe(comprre)
=UNTALK()
=UNWORK()
STORE NUL TO RESPUESTA
repo form LCCOMI ;
  noconsole ;
  to prin PROMPT
 =OFF_TMP()
return


prOCEDURE LCOMPCO
if !pideclav(1)
	return
endif
=OPCAG()
=opcli()
=opccl()
ULPR="LCCLUTC" 
store .T. to resumen
STORE NUL TO M.RESPUESTA
STORE 2 TO M.FILCAG
******STORE "" TO FISC,TT,TTCAG,QUECAG
******=QW_CAG(.F.,.F.,"PER.CAG")
******IF QUECAG#".F."
      SELE PER
      SET ORDER TO TAG CLIENTES
***      FISC=QUECAG
***      TT=TTCAG
***ELSE
***      STORE .F. TO M.OK
***      =NOSELEC("AGRUPACION")
***ENDIF
store {} to m.fecini,m.fecfin
=entre_fe("a Listar")
***TT=TTCAG+chr(13)+" Entre el "+dtoc(m.fecini)+" y el "+dtoc(m.fecfin)
***FISC=FISC+' .AND.betw(fechaop, m.fecini, m.fecfin) .AND. comisip<>0'
TT=" Entre el "+dtoc(m.fecini)+" y el "+dtoc(m.fecfin)
FISC='betw(fechaop, m.fecini, m.fecfin) .AND. comisip<>0'
TMP00=GENTMP()
TMP01=GENTMP()
=WORKING()
=DOTALK()
TMP=GENTMP()
sele ccl
set orde to
SET ORDER TO TAG CODCLI IN PER
SET RELA TO CODCLI INTO PER
COPY TO (TMP01) for !DELE() .AND. &fisc
set rela to
SELE 0
USE (TMP01) ALIAS tmp
********
=opcclh()
set orde to
SET RELA TO CODCLI INTO PER
COPY TO (TMP00) for !DELE() .AND. &fisc
sele tmp
APPEND FROM (tmp00) 
SET RELA TO CODCLI INTO PER
SORT ON PER.CLIENTE,FECHAOP TO (TMP)
set rela to
********
sele ccl
USE
USE (TMP) ALIAS CCL
repl gy_debe  with COMISIP for esdebe(comprre)
repl gy_haber with COMISIP for !esdebe(comprre)
=UNTALK()
=UNWORK()
STORE NUL TO RESPUESTA
repo form LCCOMP ;
  noconsole ;
  to prin PROMPT
 =OFF_TMP()
return


******************************************
**** EN DESARROLLO
******************************************
prOCEDURE LIQUVEND
para por_panta
=opdoc()
m.porcgral = getnu1("COMISION",.F.,3)/100
=OPCOM()
=OPCAG()
=opcli()
=opfac()
=OPMER()
ULPR="LIQVEN"
STORE NUL TO M.RESPUESTA
STORE 2 TO M.FILCAG
STORE "" TO FISC,TT,TTCAG,QUECAG
=QW_CAG(.F.,.F.,"PER.CAG")
IF QUECAG#".F."
      SELE PER
      SET ORDER TO TAG CLIENTES
      FISC=QUECAG
      TT=TTCAG
ELSE
      STORE .F. TO M.OK
      =NOSELEC("AGRUPACION")
ENDIF
store {} to m.fecini,m.fecfin
=entre_fe("a Listar")
TT=TTCAG+chr(13)+" Entre el "+dtoc(m.fecini)+" y el "+dtoc(m.fecfin)
TMP=GENTMP()
=WORKING()
=DOTALK()
SELE FAC
SET ORDER TO TAG CODCLI IN PER
SET RELA TO CODCLI INTO PER
SELE FAX
SET ORDE TO TAG FACTURA IN FAC
SET RELA TO FACTURA INTO FAC
SORT ON ARTICULO TO (TMP) ;
	FIELD ARTICULO, CANTIDAD, GRAVADO, FAC.MONTO, FAC.MONTONET, FAC.DESCUENTO, PER.CONDIVA ;
	for !DELE() .AND. betw(FAC.fechaem, m.fecini, m.fecfin) .AND. &fisc
=OFF_RELA()
SELE 0
USE (TMP) ALIAS TMP
REPL GRAVADO WITH GRAVADO*CANTIDAD* ;
      (1-IIF(LEFT(CONDIVA,1)="R", ;
           DESCUENTO/MONTO, ;
           DESCUENTO/(MONTONET+DESCUENTO))) ALL
TMP2=GENTMP()
TOTAL ON ARTICULO FIEL CANTIDAD, GRAVADO TO (TMP2)
SELE 0
USE (TMP2) ALIAS TMP2
SET ORDER TO TAG ARTICULO IN MER
SET RELA TO ARTICULO INTO MER
SET ORDE TO TAG ARTICULO IN COM
SET RELA TO ARTICULO INTO COM ADDI
=UNTALK()
=UNWORK()
STORE NUL TO RESPUESTA
if por_panta
    repo form LCVET  noconsole  PREV
else
    repo form LCVET  noconsole  to prin PROMPT
endif
 =OFF_TMP()
return

*       *********************************************************
*       *
*       * _R270U201W  ON SELE BAR 7 OF POPUP resumendec
*       *
*       * Procedure Origin:
*       *
*       * From Menu:  FACTURAS.MPR,            Record:   70
*       * Called By:  ON SELE BAR 7 OF POPUP resumendec
*       * Prompt:     Más de 30 días de Retraso
*       * Snippet:    27
*       *
*       *********************************************************
*
PROCEDURE _r270u201w
para concag,M.DIAS
if M.DIAS>30
	if !pideclav(1)
		return
	endif
endif
ULPR="LCCL30"
STORE .T. TO RESUMEN
=OPCLI()
SET ORDER TO TAG CODCLI
*********************************************             =FLOCK() .OR. FLOK()
fisc=".T."
if concag
=OPCAG()
STORE NUL TO M.RESPUESTA
STORE 2 TO M.FILCAG
STORE "" TO FISC,TT,TTCAG,QUECAG
=QW_CAG(.F.,.F.,"PER.CAG")
IF QUECAG#".F."
      FISC=QUECAG
      TT=TTCAG
ELSE
      STORE .F. TO M.OK
      =NOSELEC("AGRUPACION")
ENDIF
endif
************************************************
=OPCCL()
***********=FLOCK() .OR. FLOK()
SET RELA TO CODCLI INTO PER
TMP=GENTMP()
=WORKING()
=DOTALK()
SORT ON PER.CLIENTE,FECHAOP TO (TMP) FOR !DELE() .AND. ;
DATE()-CCL.FECHAOP>m.dias .AND. ;
ESDEBE(CCL.COMPRRE) .AND. ;
!CCL.PAGADA .AND. ;
CCL.CUOTA<CCL.MONTO .AND. &FISC
UNLO ALL
SELE CCL
USE
USE (TMP) ALIAS CCL
=UNTALK()
=UNWORK()
STORE NUL TO RESPUESTA
repo form LCCL30 ;
noconsole ;
to prin PROMPT
=OFF_TMP()


*       *********************************************************
*       *
*       * _R270U2050  ON SELE BAR 1 OF POPUP reimputapa
*       *
*       * Procedure Origin:
*       *
*       * From Menu:  FACTURAS.MPR,            Record:   75
*       * Called By:  ON SELE BAR 1 OF POPUP reimputapa
*       * Prompt:     Todos los Clientes
*       * Snippet:    28
*       *
*       *********************************************************
*
PROCEDURE _r270u2050
if !pideclav(1)
	return
endif
IF CONFIRMA("Reimputar Pagos de Clientes",.t.,10,0)
=OPCLI()
=OPCCL()
SET ORDER TO TAG CODCLI
SELE PER
SCAN
WAIT "CLIENTE:"+ALLTRIM(PER.CLIENTE) WIND NOWA
SELE CCL
IF SEEK(PER.CODCLI)
do imputaut
else
WAIT "CLIENTE:"+ALLTRIM(PER.CLIENTE)+" SIN MOVIMIENTO EN Cta. Cte." WIND NOWA
ENDIF
SELE PER
ENDSCAN
=WCL()
ENDIF


*       *********************************************************
*       *
*       * _R270U2062  ON SELE BAR 2 OF POPUP reimputapa
*       *
*       * Procedure Origin:
*       *
*       * From Menu:  FACTURAS.MPR,            Record:   76
*       * Called By:  ON SELE BAR 2 OF POPUP reimputapa
*       * Prompt:     Un Cliente
*       * Snippet:    29
*       *
*       *********************************************************
*
PROCEDURE _r270u2062
if !pideclav(1)
	return
endif
=OPCLI()
IF ELICLI("a Reimputar",-1,1)
   IF CONFIRMA("Reimputar Pagos de "+ALLTRIM(PER.CLIENTE),.t.,10,0)
      =OPCCL()
      SET ORDER TO TAG CODCLI
      SELE PER
      WAIT "CLIENTE:"+ALLTRIM(PER.CLIENTE) WIND NOWA
      SELE CCL
      IF SEEK(PER.CODCLI)
         do imputaut
      else
         WAIT "CLIENTE:"+ALLTRIM(PER.CLIENTE)+" SIN MOVIMIENTO EN Cta. Cte." WIND NOWA
      ENDIF
      =WCL()
   endif
else
   =noselec("CLIENTE")
ENDIF


*       *********************************************************
*       *
*       * _R270U20HA  ON SELE BAR 1 OF POPUP precios
*       *
*       * Procedure Origin:
*       *
*       * From Menu:  FACTURAS.MPR,            Record:   97
*       * Called By:  ON SELE BAR 1 OF POPUP precios
*       * Prompt:     Por Rubro
*       * Snippet:    30
*       *
*       *********************************************************
*
PROCEDURE _r270u20ha
=OPMER()
=OPRUB()
store nul to respuesta
if !empty(elirub("a Consultar",-1,1))
   sele mer
   fisc="mer.rubro='"+left(mix.texto2,3)+"'"
   tt=" Por Rubro: "+alltrim(mix.texto1)+" "
   do consmer
endif


*       *********************************************************
*       * _R270U20IF  ON SELE BAR 2 OF POPUP precios
*       * From Menu:  FACTURAS.MPR,            Record:   98
*       * Called By:  ON SELE BAR 2 OF POPUP precios
*       * Prompt:     Por Proveedor
*       * Snippet:    31
*       *********************************************************
*
PROCEDURE _r270u20if
=OPMER()
=OPPRO()
store nul to respuesta
if !empty(eliPRO("a Consultar",-1,1))
   sele mer
   fisc="mer.proveedor='"+per.codcli+"'"
   tt=" Por Proveedor: "+alltrim(per.cliente)+" "
   do consmer
endif

*       *********************************************************
*       * _R270U20JH  ON SELE BAR 3 OF POPUP precios
*       * From Menu:  FACTURAS.MPR,            Record:   99
*       * Called By:  ON SELE BAR 3 OF POPUP precios
*       * Prompt:     Por Teclado
*       * Snippet:    32
*       *********************************************************
*
PROCEDURE _r270u20jh
=OPMER()
store "" to ELTEX
IF intex("Descripción a Listar",20)
   sele mer
   fisc="'"+alltrim(ELTEX)+"' $ mer.merca"
   tt=" Por Texto: "+alltrim(ELTEX)+" "
   do consmer
endif

*       *********************************************************
*       * _R270U20KK  ON SELE BAR 4 OF POPUP precios
*       * Procedure Origin:
*       * From Menu:  FACTURAS.MPR,            Record:  100
*       * Called By:  ON SELE BAR 4 OF POPUP precios
*       * Prompt:     Completo
*       * Snippet:    33
*       *********************************************************
*
PROCEDURE _r270u20kk
=OPMER()
store nul to respuesta
if !empty(eliMER("a Consultar",-1,1))
   sele mer
   fisc=".T."
   tt=" Completo "
   do consmer
endif

*       *********************************************************
*       * FAPORZON - FACTURAS POR ZONA DE CLIENTES
*       * From Menu:  FACTURAS.MPR,            Record:   49
*       * Called By:  ON SELE BAR 1 OF POPUP facturasen
*       * Prompt:     Todas las Facturas
*       * Snippet:    17
*       *********************************************************
PROCEDURE FAPORZON
if !pideclav(1)
	return
endif
=OPZON()
=opcli()
=opfac()
store {} to m.fecini,m.fecfin
if entre_fe("a Listar")
   store nul to m.respuesta
   if elizon("a Listar",-1,1)
      SELE PER
      SET ORDER TO TAG CODCLI
      SELE FAC
      SET RELA TO CODCLI INTO PER
      TT="Listado de Facturas Emitidas - Zona:"+alltrim(mix.texto1)
      tt1="Entre el "+dtoc(m.fecini)+" y el "+dtoc(m.fecfin)
      LAZON=LEFT(MIX.TEXTO2,2)
      repo form lfac1 ;
      for BETW(fac.fechaem,m.fecini,m.fecfin) .AND. LEFT(PER.TEXTO1,2)=LAZON ;
      noconsole ;      
      to prin PROMPT
      =OFF_RELA()
   ELSE
      =noselec("ZONA")
   endif
ELSE
   =NOSELEC("LIMITES DE FECHA")
endif
return

*       *********************************************************
*       * FAPORZON - LISTADO NOTA DE CREDITO
*       * From Menu:  FACTURAS.MPR,            Record:   49
*       * Called By:  ON SELE BAR 1 OF POPUP facturasen
*       * Prompt:     Todas las Facturas
*       * Snippet:    17
*       *********************************************************
PROCEDURE LISTNCFE
parameter porimpre
if !pideclav(1)
	return
endif
=opcli()
=opfac()
store {} to m.fecini,m.fecfin
if entre_fe("a Listar")
      SELE PER
      SET ORDER TO TAG CODCLI
      SELE FAC
      SET RELA TO CODCLI INTO PER
      TT="Listado de Notas de Crédito Emitidas"
      tt1="Entre el "+dtoc(m.fecini)+" y el "+dtoc(m.fecfin)
      if porimpre
	      repo form lfac1 ;
      	for BETW(fac.fechaem,m.fecini,m.fecfin)  .AND. fac.tipo="NC" ;
	      noconsole ;      
      	to printer prompt
      else
      	repo form lfac1 ;
	      for BETW(fac.fechaem,m.fecini,m.fecfin)  .AND. fac.tipo="NC" ;
      	preview
      endif
      =OFF_RELA()
ELSE
   =NOSELEC("LIMITES DE FECHA")
endif


*       *********************************************************
*       * FAPORAGR - LISTADO DE FACTURAS POR AGRUPACION DE CLIENTES
*       * From Menu:  FACTURAS.MPR,            Record:   49
*       * Called By:  ON SELE BAR 1 OF POPUP facturasen
*       * Prompt:     Todas las Facturas
*       * Snippet:    17
*       *********************************************************
*
PROCEDURE FAPORAGR
if !pideclav(1)
	return
endif
=OPCAG()
=opcli()
=opfac()
store {} to m.fecini,m.fecfin
if entre_fe("a Listar")
   store nul to m.respuesta
   STORE NUL TO M.RESPUESTA
   STORE 2 TO M.FILCAG
   STORE "" TO FISC,TT,TTCAG,QUECAG
   =QW_CAG(.F.,.F.,"PER.CAG")
   IF QUECAG#".F."
      SELE PER
      SET ORDER TO TAG CLIENTES
      FISC="BETW(fac.fechaem,{"+DTOC(m.fecini)+"},{"+DTOC(m.fecfin)+"})"
      FISC=QW_FISC(FISC,QUECAG)
      SELE PER
      SET ORDER TO TAG CODCLI
      SELE FAC
      SET RELA TO CODCLI INTO PER
      TT="Listado de Facturas Emitidas - AGRUPAGCION:"+alltrim(TTCAG)
      tt1="Entre el "+dtoc(m.fecini)+" y el "+dtoc(m.fecfin)
      repo form lfac1 ;
      for &FISC ;
      noconsole ;
      to prin PROMPT
      =OFF_RELA()
   ELSE
      =noselec("AGRUPACION")
   endif
ELSE
   =NOSELEC("LIMITES DE FECHA")
endif

procedure reinall
=indexall(path)
=indexall(pathcpr,.t.)
return .t.

procedure cajadia
para porimp, solorec
if porimp
	if !pideclav(1)
		return
	endif
endif
m.codcli="C000000001"
=opper()
=OPCCLH()
=OPCCL()
ulpr='CAJADIA'
store date() to m.fecini,m.fecfin
if entre_fe("a Listar")
	TT=IIF(solorec,"Recibos","Facturas Emitidas")
	tt1="Entre el "+dtoc(m.fecini)+" y el "+dtoc(m.fecfin)
	=dotalk()
	=opccl()
	SELE CCL
	SET ORDER TO 
	tmp=gentmp()
	tmp2=gentmp()
	if solorec
		sort on numerore to (tmp) for ;
   			betwe(fechaop,m.fecini, m.fecfin) .and. ;   
   			comprre="RE"
   		sele cclh
   		set orde to
		sort on numerore to (tmp2) for ;
   			betwe(fechaop,m.fecini, m.fecfin) .and. ;   
   			comprre="RE"	
   	else
		sort on numerore to (tmp) for ;
   			betwe(fechaop,m.fecini, m.fecfin) .and. ;   
   			(codcli="C000000001" .or. comprre="RE")
   		sele cclh
   		set orde to
		sort on numerore to (tmp2) for ;
   			betwe(fechaop,m.fecini, m.fecfin) .and. ;   
   			(codcli="C000000001" .or. comprre="RE")
   	endif
   	sele cclh
   	use
   	sele ccl
   	use
	use (tmp) alias ccl
   	append from (tmp2)
	=untalk()
   IF !empty(recc())
	if porimp
	      repo form LCAJ    NOCONSOLE TO PRIN PROMPT
	else
 	    	repo form LCAJ prev
      endif
   ELSE
      WAIT "NO HAY MOVIMIENTOS" WIND
   ENDIF
	=off_tmp()
endif
return

PROCEDURE BUSCAMAL
=OPCCL()
SET TALK ON
SELE FECHAOP,COMPR,MONTO  FROM CCL  INTO CURSOR TMP WHERE "*"$transf(comision,"999999999.99") or "*"$transf(comisip,"999999999.99")
SET TALK OFF
define wind un from 15,0 to 25,80
acti wind un
brow 
rele wind un
USE
RETURN

PROCEDURE catedimp
=OPMER()
=OPCTD()
=OPCAT()
STORE NUL TO RESPUESTA
if elictd("a Listar",-1,1)
	tt="Cátedra:"+alltrim(mix.texto1)
	elcod=left(mix.texto2,2)
	M.PORLISMAY=GETNU1("PORLISMAY","FOXGRL")
	M.PORLISMIN=GETNU1("PORLISMIN","FOXGRL")
	M.FLETE=GETNU1("FLETE","FOXGRL")
	SELE MER
	SET ORDER TO TAG ARTICULO
	SELE CAT
	SET RELA TO ARTICULO INTO MER
	TMP=GENTMP()
	=FLOCK("CAT") .OR. FLOK("CAT")
	=FLOCK("MER") .OR. FLOK("MER")
	SELE CAT
	SORT ON MER.MERCA ;
	FIELD ARTICULO,CANTIDAD,LISTA ;
		for catedra=elcod ;
		TO (TMP)
	UNLO ALL
	=PRXAREA(.T.)
	USE (TMP) ALIAS TMP
	SET RELA TO ARTICULO INTO MER
	IF TYPE("ENASCII")#"U" .AND. ENASCII
		   REPO FORM LCAT1-F NOCON TO PRIN PROM
	ELSE
		   repo form lcat1 nocon to prin prompt
	ENDIF
endif
=OFF_TMP()
=OFF_RELA()
