PARAMETER LRANK,ELTIPO,porpan
STORE .T. TO M.OK
DO CASE
CASE M.LRANK=1
	TT="Todas las Facturas"
	STORE ".T." TO M.FISC
CASE M.LRANK=2
	TT="Facturas 'A'"
	FISC="LEFT(FAX.FACTURA,1)='A'"
CASE M.LRANK=3
	TT="Facturas 'B'"
	FISC="LEFT(FAX.FACTURA,1)='B'"
CASE M.LRANK=4
	=OPZON()
	=OPCLI()
	STORE NUL TO M.RESPUESTA
	IF ELIZON("a Listar",-1,1)
		TT="Clientes de Zona:"+alltrim(mix.texto1)
		FISC="LEFT(per.texto1,2)='"+left(mix.texto2,2)+"'"
	ELSE
		=NOSELEC("ZONA")
		STORE .F. TO M.OK
	ENDIF
CASE M.LRANK=5
	=OPCAG()
	=OPCLI()
	STORE NUL TO M.RESPUESTA
	STORE 2 TO M.FILCAG
	STORE "" TO FISC,TT,TTCAG,QUECAG
	=QW_CAG(.F.,.F.,"PER.CAG")
	TT="Por Agrupación "+TTCAG
	IF !EMPTY(QUECAG) .AND. ;
			QUECAG#".F."
		FISC=QUECAG
	ELSE
		=NOSELEC("AGRUPACION")
		STORE .F. TO M.OK
	ENDIF
CASE M.LRANK=6
	=OPPRO()
	STORE NUL TO M.RESPUESTA
	IF ELIPRO("a Listar",-1,1)
		TT="Artículos de:"+alltrim(per.CLIENTE)
		FISC="mer.PROVEEDOR='"+per.codcli+"'"
	ELSE
		=NOSELEC("PROVEEDOR")
		STORE .F. TO M.OK
	ENDIF
CASE M.LRANK=7
	=OPCLI()
	STORE NUL TO M.RESPUESTA
	IF ELICLI("a Listar",-1,1)
		TT="Artículos de:"+alltrim(per.CLIENTE)
		FISC="FAC.CODCLI='"+per.codcli+"'"
	ELSE
		=NOSELEC("CLIENTE")
		STORE .F. TO M.OK
	ENDIF
ENDCASE
IF M.OK
	STORE {} TO M.FECINI,M.FECFIN
	IF ENTRE_FE("a Listar")
		FISC=FISC+" .AND. BETW(FAC.FECHAEM,{"+;
			DTOC(M.FECINI)+;
			"},{"+;
			DTOC(M.FECFIN)+"})"
		tt1="Entre el "+dtoc(m.fecini)+" y el "+dtoc(m.fecfin)
		=OPMER()
		=OPFAC()
		=WORKING()
		=DOTALK()
		SELE FAC
		SET ORDER TO TAG FACTURA
		IF M.LRANK>3
			SELE PER
			SET ORDER TO TAG CODCLI
			SELE FAC
			SET RELA TO CODCLI INTO PER
		ENDIF
		SELE FAC
		SET ORDER TO TAG FACTURA
		SELE FAX
		SET ORDER TO
		SET RELA TO FACTURA INTO FAC ADDI
		IF M.LRANK=6
			SET ORDER TO TAG ARTICULO IN MER
			SET RELA TO ARTICULO INTO MER ADDI
		ENDIF
		TMP=GENTMP()
		TMP1=GENTMP()
		=FLOCK() .OR. FLOK()
		SORT ON ARTICULO TO (TMP) FOR &FISC
		UNLO IN FAX
		=PRXAREA(.T.)
		USE (TMP) ALIAS TMP EXCL
		IF ELTIPO>2
			REPL ALL GRAVADO WITH GRAVADO*CANTIDAD
		ENDIF
		TOTAL ON ARTICULO TO (TMP1) FIELD CANTIDAD,GRAVADO
		=PRXAREA(.T.)
		DO CASE
		CASE M.ELTIPO=5
			USE (TMP1) ALIAS TEMPOX EXCL
			*** INDEXO POR CANTIDAD Y COPIO LAS PRIMERAS 100
			SELE TEMPOX
			INDEX ON CANTIDAD TAG ARTICULO DESC
			SET ORDER TO TAG ARTICULO
			GO TOP
			TMP2=GENTMP()
			COPY TO (TMP2) NEXT 100
			*** INDEXO POR MONTO Y COPIO LAS PRIMERAS 100
			SELE TEMPOX
			INDEX ON GRAVADO TAG ARTICULO DESC
			SET ORDER TO TAG ARTICULO
			GO TOP
			TMP3=GENTMP()
			COPY TO (TMP3) NEXT 100
			=PRXAREA(.T.)
			USE (TMP2) ALIAS TMP2
			INDEX ON ARTICULO TAG ARTICULO
			=PRXAREA(.T.)
			USE (TMP3) ALIAS TMP3
			SET RELA TO ARTICULO INTO TMP2
			TMP4=GENTMP()
			COPY TO (TMP4) FOR FOUND("TMP2")
			=PRXAREA(.T.)
			USE (TMP4) ALIAS TEMPORAL
			INDEX ON GRAVADO TAG ARTICULO DESC
		CASE M.ELTIPO=1 .or. M.eltipo=2
			USE (TMP1) ALIAS TEMPORAL EXCL
			INDEX ON CANTIDAD TAG ARTICULO DESC
		case m.eltipo=6
			** MONTOOR: EL PRECIO UNITARIO DE VENTA PROMEDIO
			** IVA    : EL PRECIO DE COSTO
			** NOINS  : EL PORCENTAJE DE GANANCIA
			USE (TMP1) ALIAS TEMPORAL EXCL
			repl all montoor with gravado/cantidad
			index on articulo tag articulo
			set order to tag articulo in mer
			set rela to articulo into mer
			repl all iva with mer.dolar
			DELE FOR EMPTY(IVA)
			PACK
			REPL ALL NOINS WITH 100*MONTOOR/IVA-100
			index on NOINS tag articulo
		OTHERWISE
			USE (TMP1) ALIAS TEMPORAL EXCL
			INDEX ON GRAVADO TAG ARTICULO DESC
		ENDCASE
		SELE MER
		SET ORDER TO TAG ARTICULO
		SELE TEMPORAL
		SET ORDER TO TAG ARTICULO
		STORE 1 TO ELPOS
		SCAN
			REPL USUARIO WITH STR(ELPOS)
			ELPOS=ELPOS+1
		ENDSCAN
		SET RELA TO ARTICULO INTO MER
		=UNTALK()
		=UNWORK()
		if porpan
			DO CASE
			CASE M.ELTIPO=6
				REPO FORM RANKING2 PREV
			CASE M.ELTIPO=2 .OR. M.ELTIPO>3
				REPO FORM RANKING1 PREV FOR VAL(USUARIO)<101
				OTHER
				REPO FORM RANKING1 PREV
			ENDCASE
		else
			DO CASE
			CASE M.ELTIPO=6
				REPO FORM RANKING2 TO PRIN PROM NOCONSOLE
			CASE M.ELTIPO=2 .OR. M.ELTIPO>3
				REPO FORM RANKING1 TO PRIN PROM NOCONSOLE FOR VAL(USUARIO)<101
				OTHER
				REPO FORM RANKING1 TO PRIN PROM NOCONSOLE
			ENDCASE
		endif
		=OFF_TMP()
		=OFF_RELA()
	ELSE
		=NOSELEC("FECHA")
	ENDIF
ENDIF
RETURN
