*** FUNCTION IMPU_NRE
*** NRE_MONTO: MONTO A IMPUTAR
*** NRE_MODO : FORMA DE IMPUTACION 1. COINCIDE N§ DOCUM Y PENDIENTE
***                              2. NO COINCIDE N§ DOCUM Y PENDIENTE
***                              3. NO COINCIDE N§ DOCUM NI PENDIENTE 
FUNCTION IMPU_NRE
PARAMETER IMPU_CODCLI,IMPU_MON,IMPU_DOC
IMPU_DOC=ALLTRIM(IMPU_DOC)
IMPU_MON=IMPU_NR1(IMPU_MON,1)
RETURN IMPU_NR1(IMPU_MON,3)

*** FUNCTION IMPU_NR1
*** NRE_MONTO: MONTO A IMPUTAR
*** NRE_MODO : FORMA DE IMPUTACION 1. COINCIDE N§ DOCUM Y PENDIENTE
***                              2. NO COINCIDE N§ DOCUM Y PENDIENTE
***                              3. NO COINCIDE N§ DOCUM NI PENDIENTE 
FUNCTION IMPU_NR1
PARAMETER NR1_MONTO,NR1_MODO
SELE CCL
SET ORDER TO TAG CODCLI
SEEK IMPU_CODCLI
SCAN WHILE CCL.CODCLI=IMPU_CODCLI
   IF ESDEBE(CCL.COMPRRE)
      IF (NR1_MODO=1 .AND. ALLTRIM(CCL.NUMERORE)=IMPU_DOC) .OR. NR1_MODO#1
         IF !PAGADA
            NR1_DIF=CCL.MONTO-CCL.CUOTA
            REGISTRO=STR(RECNO("CCL"))
            =LOCK("CCL") .OR. LOK("CCL")            
            IF (NR1_DIF>=NR1_MONTO .AND. NR1_MODO<3) .OR. NR1_MODO>2
               REPL CCL.CUOTA WITH CCL.CUOTA+NR1_MONTO
               STORE 0 TO NR1_MONTO
               UNLO IN CCL
               EXIT
            ELSE
               SEGARPA=NR1_DIF
               REPL CCL.CUOTA WITH CCL.MONTO
               REPL CCL.PAGADA WITH .T.
               STORE NR1_MONTO-M.SEGARPA TO NR1_MONTO
               UNLO IN CCL
            ENDIF
         ENDIF
      ENDIF
   ENDIF
ENDSCAN
RETURN NR1_MONTO