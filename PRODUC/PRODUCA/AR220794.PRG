CLOSE DATA
SET TALK ON
SET TALK WIND
SELE 0
USE ORFABDAT ALIAS FAB ORDER TAG REMTRU
SELE 0
USE ORDCOR ALIAS COR ORDER TAG NUMERO
SELE 0
USE HOJARUT ALIAS DES ORDER TAG ARTICULO
SELE FAB
SET ORDER TO TAG NUMERO
GO TOP
ELNUM=FAB.NUMERO
STORE 0 TO LAPOS
SCAN 
IF ELNUM#FAB.NUMERO
   ELNUM=FAB.NUMERO
ENDIF   
IF TIPO="@"
   LAPOS=IIF(EMPTY(POSIC),LAPOS+10,POSIC)
   IF EMPTY(POSIC) .OR. EMPTY(PRC)
      ? ELNUM
      ?? "|"
      ?? REMITO
      =XSEEK(NUMERO,"COR","NUMERO")
      ?? "|"
      ?? COR.ARTICULO
      ?? "|"
      IF XSEEK(COR.ARTICULO+"/00  "+STR(LAPOS),"DES","HOJARUT")
         REPL FAB.POSIC WITH DES.POSICION
         REPL FAB.PRC WITH DES.PRC
         ?? DES.POSICION
         ?? "|"
         ?? DES.PRC
         ?? "|"         
      ENDIF
   ENDIF
ENDIF
ENDSCAN
RETURN 
 
FUNCTION XSEEK
PARAMETER QUEBUSCA,APODO,HORDEN,X_NEAR
PRIVATE QUEBUSCA,APODO,HORDEN,SALIDA,APODOANT,HORDENANT
IF PARAMETER()<2
   M.SALIDA=.F.
ELSE
   STORE ALIAS() TO M.APODOANT
   SELE (M.APODO)
   IF PARAMETER()=3
      M.ORDENANT=ORDER()
      SET ORDER TO TAG (M.HORDEN)
   ENDIF
   IF X_NEAR
      SET NEAR ON
   ENDIF
   M.SALIDA=SEEK(M.QUEBUSCA)
   IF X_NEAR
      SET NEAR OFF
   ENDIF
   IF PARAMETER()=3
      SET ORDER TO TAG (M.ORDENANT)
   ENDIF
   IF !EMPTY(M.APODOANT)
      SELE (M.APODOANT)
   ENDIF
ENDIF
RETURN M.SALIDA
