FUNCTION PEROK
	DO CASE
	CASE M.OPCION=3
		=CARPER("PER") .AND. IIF(WEXIST("XPER"),SGET("XPER"),.T.)
		RETURN 1
	CASE M.OPCION=1
		IF LAST()#27
			IF CHKPER()
				M.FILTRO=CONTENIDO[5]
				IF TYPE("G_GRABA")="C"
					=EVAL(G_GRABA)
				ELSE
					IF M.INGRESO
						=AGRABAR("PER") .AND. IAUD('Ing '+ALLTRIM(M.CODCLI)+'-'+M.CLIENTE)
					ELSE
						IF M.CAMBIO
							SELE PER
							GO FF
							=AGRABAR1("PER") .AND. IAUD('Cor '+ALLTRIM(M.CODCLI)+'-'+M.CLIENTE)
						ENDIF
					ENDIF
				ENDIF
				=CARPER("PER")
			ELSE
				=FALTADAT(TIPO_PER)
			ENDIF
		ENDIF
		_CUROBJ=M.PRIOBJ
	CASE M.OPCION=2
		=CARPER("PER") .AND. IIF(WEXIST("XPER"),SGET("XPER"),.T.)
		_CUROBJ=M.PRIOBJ
	ENDCASE
RETURN 0
