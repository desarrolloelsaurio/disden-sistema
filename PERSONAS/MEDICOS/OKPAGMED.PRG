#DEFINE CRLF CHR(13)+CHR(10)                     && CRLF
* CONFIRMA PAGO DE MEDICOS
PROCEDURE OKPAGMED
ULPR=HORA_ULP(PROGRAM())
IF CHEQSEG()
=OPPRA()
=OPMUT()
=OPLIQ()
=OPMED()
STORE NUL TO M.RESPUESTA
DO WHILE ELIMED("a Listar",-1,1)
   ELMED=PER.CODCLI
   ON KEY LABEL TAB KEYB CHR(23)
   ON KEY LABEL CTRL+P DO CHNGPAGA
   =MOVECENT(0,1,15,78,"WIN"," Pr cticas de "+alltrim(per.cliente)+" ")
			SELE LIX
					ELMED=PER.CODCLI
					SET ORDER TO TAG NUMERO IN LIQ
					SELE LIX
					SET RELA TO TPR+STR(NUMERO) INTO LIQ
					=POPCARTE(CRLF+;
					"[TAB] SALE"+CRLF+;
					"[CTRL+P] CONFIRMA PAGO"+CRLF)
					BROW FIEL PRACTICA,PRXCOD,;
					LIQ.FECHAIN:H=" FECHA  ":R,;
					ELPAC=SAYPER(LIQ.PACIENTE,"PACCOD"):H=PADC("PACIENTE",20):P="!!!!!!!!!!!!!!!!!!!!":R,;
					TOTAL=LIX.T_GAS+LIX.T_GAL:H="TOTAL":P="99,999.99":R ,;
					XPAGA=IIF(LIX.PAGA,"NO","SI"):H="PAG¢" FOR ;
					LIQ.MEDICO=ELMED .AND. ;
					PASADA .AND. PAGA .AND. !PAGADA ;
					FREE PRACTICA ;
					WIND WIN ;
					NOCLEAR
ENDDO
   ON KEY LABEL TAB 
=RELEWIN("WIN")
=RELEWIN("POPCARTE")
ELSE
=IAUDI()
ENDIF
RETURN MEN_LIN(BOTOM)

FUNCTION CHNGPAGA
IF PAGA  && VA A PASAR A !PAGA Y A CONFIRMAR EL PAGO
   REPL LIX.PAGA WITH .F.
   REPL LIX.L_MES WITH MONTH(DATE())
   REPL LIX.L_ANIO WITH YEAR(DATE())
   REPL LIX.PAGADA WITH .T. 
ELSE
   REPL LIX.PAGA WITH .T.
   REPL LIX.L_MES WITH 0
   REPL LIX.L_ANIO WITH 0
   REPL LIX.PAGADA WITH .F. 
ENDIF
RETURN
