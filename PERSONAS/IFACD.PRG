*       *********************************************************
*       *                                                         
*       * 06/12/2006             IFACD.PRG               09:18:21 
*       *                                                         
*       *********************************************************
*       *                                                         
*       * Author's Name                                           
*       *                                                         
*       * Copyright (c) 2006 Company Name                         
*       * Address                                                 
*       * City,     Zip                                           
*       *                                                         
*       * Description:                                            
*       * This program was automatically generated by GENSCRN.    
*       *                                                         
*       *********************************************************

PARAMETERS espropio,eslistado,i_alias,tiwin,xper,cod_hacer

*       *********************************************************
*       *                                                         
*       *          PERRED/Windows Setup Code - SECTION 1          
*       *                                                         
*       *********************************************************
*

#REGION 1

EXTERNAL PROCEDURE AJCODPER
=HORA_ULP(PROGRAM())
***
IF CHEQSEG()
   RELE MIX_VARI,MIX_T1,MIX_R1,MIX_C1,MIX_COD,MIX_IND,MIX_R2,MIX_C2,MIX_ALIAS,MIX_CAMPO,MIX_LARGO
   PUBL MIX_VARI,MIX_T1,MIX_R1,MIX_C1,MIX_COD,MIX_IND,MIX_R2,MIX_C2,MIX_ALIAS,MIX_CAMPO,MIX_LARGO
   TIPO_PER=TEXTO[1]
   SELE PER
   SET ORDER TO TAG (CONTENIDO[4])
   SCAT MEMV BLAN MEMO
   SCAT TO RESPALDO BLAN MEMO
   STORE SPACE(20) TO M.CIUTEX,M.PRIOBJ,M.TRANSA,M.FF,M.REGISTRO,IVATEX
   STORE .T. TO INGRESO
   STORE .F. TO CAMBIO
   STORE "PER" TO WIND_TOP,M.G_ALIAS,M.G_VENT
   STORE TEXTO[3]+" "+IIF(M.ESPROPIO,"","- Legajo ") to M.G_FALTA
   STORE "" TO M.G_AUDI

   STORE " "+TEXTO[3]+" "+IIF(M.ESPROPIO .AND. !ESLISTADO,"","- Legajo ") to M.G_FALTA
   STORE "" TO M.G_AUDI
   STORE "CARPER('PER')" TO M.G_CARGA
   M.TIWIN=IIF(EMPTY(TIWIN)," Gesti¢n de "+TEXTO[3]," "+ALLTRIM(TIWIN)+" ")
   DO CASE
   CASE EMPTY(I_ALIAS)
      M.G_CARGA=M.G_CARGA+IIF(M.ESPROPIO .AND. !ESLISTADO,"",".AND. SGET('XPER')")
      STORE .F. TO INGRESO
   CASE I_ALIAS="LIQ"
      M.G_CARGA=M.G_CARGA+" .AND. CARLIQ('XPER')"
   CASE I_ALIAS="PRS"
      M.G_FALTA=" Presupuesto de Servicios "
      M.G_CARGA=M.G_CARGA+" .AND. CARGRL('PRS','INGPRS1')"
   ENDCASE
ULPRANT=ULPR
** Start of inserted file \SISTEMAS\DEFINES.PRG ********************************start
#DEFINE BOTOM  "  "+repl("°",78)                 && BOTOM
#DEFINE ABA    "Abriendo Base de "               && ABA
#DEFINE NUL    0                                 && NUL
#DEFINE PICUMAX "9,999,999,999,999.99"           && PICUMAX
#DEFINE PICUMA1 "9,999,999,999,999"              && PICUMA1
#DEFINE PAIP   "|"                               && PAIP
#DEFINE FOLC  ".F."                              && FOLC
#DEFINE CRLF CHR(13)+CHR(10)                     && CRLF
#DEFINE FOLL  .F.                                && FOLL
#DEFINE TRUC  ".T."                              && TRUC
#DEFINE TRUL  .T.                                && TRUL
#DEFINE IMPRIMIENDO  PADC(' IMPRIMIENDO LOS DATOS REQUERIDOS - [TECLA] Interrumpe ',80,'°') && IMPRIMIENDO
#DEFINE ELYES  "SI"                              && ELYES
#DEFINE ELNOU  "NO"                              && ELNOU
#DEFINE ONE    1                                 && ONE
#DEFINE TWO    2                                 && TWO
#DEFINE THREE  3                                 && THREE
#DEFINE FOUR   4                                 && FOUR
#DEFINE TEX_EFES " - [F2] Popup - [F3] B£squeda" && TEX_EFES
#DEFINE TEX_CALC "CALCULANDO - ESPERE POR FAVOR" && TEX_CALC
#DEFINE GRABANDO PADC(' Grabando los datos ingresados - Espere por Favor ',80,"°")
#DEFINE NOVACIO "CAMPO DE INGRESO OBLIGATORIO - NO PUEDE ESTAR VACIO" && NOVACIO
#DEFINE NOFECHA "LAS FECHAS ESTAN ENTRE VALORES INACEPTABLES" && NOFECHA
#DEFINE ESPAOPC " - Barra Espac. para cambiar de Opci¢n" && ESPAOPC
#DEFINE ESCANUL " - [ESC] para Anular"           && ESCANUL
#DEFINE ESCAMEN " - [ESC] para Men£"             && ESCAMEN
#DEFINE ESCAFIN " - [ESC] para Fin"              && ESCAFIN
#DEFINE NOACVAL "LOS VALORES INGRESADOS ESTAN ENTRE LIMITES INACEPTABLES"    && NOACVAL
#DEFINE CONTIX  " Continuaci¢n"                  && CONTIX
#DEFINE RH      36 								 && RH
#DEFINE RP 		47 								 && RP
#DEFINE ENTERCON "PULSE [ENTER] PARA CONTINUAR"  && ENTERCON
#DEFINE ORQ      "Orden de Requerimiento"        && ORQ
#DEFINE ORQS     "Ordenes de Requerimiento"      && ORQS
#DEFINE NOSEL "NO SE HA SELECCIONADO"            && NOSEL
#DEFINE PIC30 "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"	 && PIC30
#DEFINE T_REINGRE "Reingrese el DATO"	 		 && T_REINGRE

** End of inserted file \SISTEMAS\DEFINES.PRG ************************************end



#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

m.rborder = SET("READBORDER")
SET READBORDER ON

*       *********************************************************
*       *                                                         
*       *               Windows Window definitions                
*       *                                                         
*       *********************************************************
*

IF NOT WEXIST("per") ;
	OR UPPER(WTITLE("PER")) == "PER.PJX" ;
	OR UPPER(WTITLE("PER")) == "PER.SCX" ;
	OR UPPER(WTITLE("PER")) == "PER.MNX" ;
	OR UPPER(WTITLE("PER")) == "PER.PRG" ;
	OR UPPER(WTITLE("PER")) == "PER.FRX" ;
	OR UPPER(WTITLE("PER")) == "PER.QPR"
	DEFINE WINDOW per ;
		AT 4.000, 19.000 ;
		SIZE 5.154,65.500 ;
		TITLE TIWIN ;
		FONT "MS Sans Serif", 8 ;
		STYLE "B" ;
		NOFLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		DOUBLE
ENDIF

IF NOT WEXIST("win2") ;
	OR UPPER(WTITLE("WIN2")) == "WIN2.PJX" ;
	OR UPPER(WTITLE("WIN2")) == "WIN2.SCX" ;
	OR UPPER(WTITLE("WIN2")) == "WIN2.MNX" ;
	OR UPPER(WTITLE("WIN2")) == "WIN2.PRG" ;
	OR UPPER(WTITLE("WIN2")) == "WIN2.FRX" ;
	OR UPPER(WTITLE("WIN2")) == "WIN2.QPR"
	DEFINE WINDOW win2 ;
		AT 12.000, 19.000 ;
		SIZE 21.077,71.167 ;
		TITLE ' Ingreso de '+tit_sin+' de Proveedores ' ;
		FONT "MS Sans Serif", 8 ;
		STYLE "B" ;
		NOFLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		DOUBLE ;
		FILL FILE LOCFILE("\BMP\ARGYLE.BMP","BMP|ICO|PCT|ICN", ;
			"Where is argyle?")
ENDIF


*       *********************************************************
*       *                                                         
*       *          IFACD/Windows Setup Code - SECTION 2           
*       *                                                         
*       *********************************************************
*

#REGION 2
ULPR=HORA_ULP(PROGRAM())
IF CHEQSEG()
=oppag()
=opgas()
=OPCCP()
=OPFAR()
SELE FAR
SCAT MEMV BLAN


*       *********************************************************
*       *                                                         
*       *              PERRED/Windows Screen Layout               
*       *                                                         
*       *********************************************************
*

#REGION 1
IF WVISIBLE("per")
	ACTIVATE WINDOW per SAME
ELSE
	ACTIVATE WINDOW per NOSHOW
ENDIF
@ 2.077,1.167 SAY texto[10] ;
	SIZE 1.000,22.600 ;
	FONT "Arial", 8 ;
	STYLE "B"
@ 3.154,1.167 SAY texto[6] ;
	SIZE 1.000,22.600 ;
	FONT "Arial", 8 ;
	STYLE "B"
@ 1.077,1.000 SAY "C¢digo" ;
	FONT "Arial", 8 ;
	STYLE "B"
@ 1.077,22.667 GET m.codcli ;
	SIZE 1.000,13.200 ;
	DEFAULT " " ;
	FONT "ARIAL", 8 ;
	PICTURE REPL('!',CONTENIDO[2]+LEN(CONTENIDO[5])) ;
	WHEN _1ym0jxzeh() ;
	VALID _1ym0jxzep() ;
	MESSAGE "Ingrese C¢digo de "+tipo_per+" - [ESC] para Men£"+TEX_EFES+" - [F4] Ult" ;
	ERROR "NO SE PUEDE TRABAJAR SOBRE UN REGISTRO BORRADO"
@ 2.077,22.667 GET m.CLIENTE ;
	SIZE 1.000,34.200 ;
	DEFAULT " " ;
	FONT "ARIAL", 8 ;
	PICTURE "@!" ;
	WHEN _1ym0jxzet() ;
	VALID _1ym0jxzey() ;
	MESSAGE "Ingrese Nombre o Raz¢n Social de "+tipo_per+TEX_EFES ;
	ERROR "NO SE PUEDE TRABAJAR SOBRE UN REGISTRO BORRADO"
@ 3.154,22.667 GET m.detalle ;
	SIZE 1.000,43.200 ;
	DEFAULT {  /  /  } ;
	FONT "ARIAL", 8 ;
	PICTURE "@X" ;
	WHEN last()#27 .and. ESPROPIO .AND. !empty(m.CLIENTE) .and. !NOCOD(M.CODCLI) .AND. off_f2() ;
	VALID CHKCAMBI(M.DETALLE,"PER") ;
	MESSAGE TEXTO[5]+" del "+texto[1]




*       *********************************************************
*       *                                                         
*       *               IFACD/Windows Screen Layout               
*       *                                                         
*       *********************************************************
*

#REGION 2
IF WVISIBLE("win2")
	ACTIVATE WINDOW win2 SAME
ELSE
	ACTIVATE WINDOW win2 NOSHOW
ENDIF
@ 9.538,24.500 SAY ":" ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	COLOR RGB(255,255,255,,,,)
@ 9.538,1.000 SAY "Neto Gravado" ;
	FONT "Arial", 10 ;
	STYLE "BIT" ;
	COLOR RGB(255,255,255,,,,)
@ 11.923,24.500 SAY ":" ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	COLOR RGB(255,255,255,,,,)
@ 13.154,24.500 SAY ":" ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	COLOR RGB(255,255,255,,,,)
@ 14.308,24.500 SAY ":" ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	COLOR RGB(255,255,255,,,,)
@ 15.538,24.500 SAY ":" ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	COLOR RGB(255,255,255,,,,)
@ 1.077,24.167 SAY ":" ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	COLOR RGB(255,255,255,,,,)
@ 1.077,44.500 SAY "Fecha" ;
	FONT "Arial", 10 ;
	STYLE "BIT" ;
	COLOR RGB(255,255,255,,,,)
@ 1.077,52.333 SAY ":" ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	COLOR RGB(255,255,255,,,,)
@ 2.231,1.000 SAY "Condición de Pago        :" ;
	FONT "Arial", 10 ;
	STYLE "BIT" ;
	COLOR RGB(255,255,255,,,,)
@ 7.077,1.000 SAY "Monto" ;
	FONT "Arial", 10 ;
	STYLE "BIT" ;
	COLOR RGB(255,255,255,,,,)
@ 7.077,24.500 SAY ":" ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	COLOR RGB(255,255,255,,,,)
@ 8.308,1.000 SAY "Descuento" ;
	FONT "Arial", 10 ;
	STYLE "BIT" ;
	COLOR RGB(255,255,255,,,,)
@ 8.308,24.500 SAY ":" ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	COLOR RGB(255,255,255,,,,)
@ 10.692,24.500 SAY ":" ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	COLOR RGB(255,255,255,,,,)
@ 14.308,1.000 SAY "Exento" ;
	FONT "Arial", 10 ;
	STYLE "BIT" ;
	COLOR RGB(255,255,255,,,,)
@ 15.538,1.000 SAY "Recargo Financiero" ;
	FONT "Arial", 10 ;
	STYLE "BIT" ;
	COLOR RGB(255,255,255,,,,)
@ 16.769,1.000 SAY "Percepción" ;
	FONT "Arial", 10 ;
	STYLE "BIT" ;
	COLOR RGB(255,255,255,,,,)
@ 16.769,24.500 SAY ":" ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	COLOR RGB(255,255,255,,,,)
@ 17.923,24.500 SAY ":" ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	COLOR RGB(255,255,255,,,,)
@ 3.462,1.000 SAY "Imputación" ;
	FONT "Arial", 10 ;
	STYLE "BIT" ;
	COLOR RGB(255,255,255,,,,)
@ 3.462,24.167 SAY ":" ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	COLOR RGB(255,255,255,,,,)
@ 4.692,1.000 SAY "Moneda" ;
	FONT "Arial", 10 ;
	STYLE "BIT" ;
	COLOR RGB(255,255,255,,,,)
@ 4.692,24.500 SAY ":" ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	COLOR RGB(255,255,255,,,,)
@ 1.077,1.167 SAY 'Nº de '+tit_sin ;
	SIZE 1.000,18.333 ;
	FONT "Arial", 10 ;
	STYLE "BIT" ;
	COLOR RGB(255,255,255,,,,)
@ 1.077,26.667 GET m.factura ;
	SIZE 1.000,16.833 ;
	DEFAULT " " ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "A!!!!!!!!!!!!!" ;
	WHEN _1ym0jxzf0() ;
	VALID _1ym0jxzf1() ;
	MESSAGE "N§ DE "+UPPER(TIT_SIN) ;
	ERROR "DOCUMENTO EXISTENTE - POR FAVOR REVISE EL NUMERO" ;
	COLOR ,RGB(255,255,255,,,,)
@ 1.077,54.500 GET m.fechaem ;
	SIZE 1.000,11.333 ;
	DEFAULT {  /  /  } ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	WHEN LAST()#27 .and. HAYFACTURA ;
	COLOR ,RGB(255,255,255,,,,)
@ 2.231,26.667 GET M.condpago ;
	SIZE 1.000,3.500 ;
	DEFAULT " " ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "!!" ;
	WHEN _1ym0jxzfl() ;
	VALID LAST()=27 .OR. (XSEEK(M.CONDPAGO,'MIX','PAGCOD') .AND. SGET("WIN2")) ;
	MESSAGE "Ingrese Condici¢n de Pago"+TEX_EFES	 ;
	ERROR "CONDICION DE PAGO NO EXISTE" ;
	COLOR ,RGB(255,255,255,,,,)
@ 2.308,40.167 SAY IIF(EMPTY(M.CONDPAGO),"",SAYMIX(M.CONDPAGO,"PAGCOD")) ;
	SIZE 1.000,30.000 ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "@!" ;
	COLOR RGB(255,255,255,,,,)
@ 3.462,26.667 GET M.gasto ;
	SIZE 1.000,11.500 ;
	DEFAULT " " ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "@!" ;
	WHEN _1ym0jxzg2() ;
	VALID LAST()=27 .OR. (XSEEK(M.GASTO,'MIX','GASCOD') .AND. SGET("WIN2")) ;
	MESSAGE "Ingrese Concepto de Imputaci¢n"+TEX_EFES	 ;
	ERROR "CONCEPTO DE IMPUTACION NO EXISTE" ;
	COLOR ,RGB(255,255,255,,,,)
@ 3.462,40.000 SAY IIF(EMPTY(M.GASTO),"",SAYMIX(M.GASTO,"GASCOD")) ;
	SIZE 1.000,29.500 ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "@!" ;
	COLOR RGB(255,255,255,,,,)
@ 4.692,26.667 GET m.moneda ;
	SIZE 1.000,1.667 ;
	DEFAULT " " ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "!!" ;
	WHEN LAST()#27 .and. HAYFACTURA .and. !empty(m.gasto) ;
	VALID !empty(m.moneda) ;
	MESSAGE "Comprobante emitido en moneda..." ;
	ERROR novacio ;
	COLOR ,RGB(255,255,255,,,,)
@ 7.077,26.667 GET m.monto ;
	SIZE 1.000,14.167 ;
	DEFAULT 0 ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "99,999,999.99" ;
	WHEN LAST()#27 .and. HAYFACTURA ;
	MESSAGE "MONTO BRUTO DE LA "+TIT_SIN ;
	COLOR ,RGB(255,255,255,,,,)
@ 8.308,26.667 GET m.descuento ;
	SIZE 1.000,14.167 ;
	DEFAULT 0 ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "99,999,999.99" ;
	WHEN LAST()#27 .and. HAYFACTURA .and. !empty(m.monto) ;
	VALID _1ym0jxzgl() ;
	MESSAGE "DESCUENTO SOBRE LA "+TIT_SIN ;
	COLOR ,RGB(255,255,255,,,,)
@ 9.538,26.667 GET m.montobru ;
	SIZE 1.000,14.167 ;
	DEFAULT 0 ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "99,999,999.99" ;
	DISABLE ;
	COLOR ,RGB(255,255,255,,,,)
@ 10.692,26.667 GET m.montoiva ;
	SIZE 1.000,14.167 ;
	DEFAULT 0 ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "99,999,999.99" ;
	WHEN LAST()#27 .and. HAYFACTURA .and. !empty(m.monto) ;
	MESSAGE "MONTO DEL IVA INSCRIPTO" ;
	COLOR ,RGB(255,255,255,,,,)
@ 11.923,26.667 GET m.montoot2 ;
	SIZE 1.000,14.167 ;
	DEFAULT 0 ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "99,999,999.99" ;
	WHEN LAST()#27 .and. HAYFACTURA .and. !empty(m.monto) ;
	MESSAGE "MONTO DEL IVA NO INSCRIPTO" ;
	COLOR ,RGB(255,255,255,,,,)
@ 13.154,26.667 GET m.montoot3 ;
	SIZE 1.000,14.167 ;
	DEFAULT 0 ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "99,999,999.99" ;
	WHEN LAST()#27 .and. HAYFACTURA .and. !empty(m.monto) ;
	MESSAGE "MONTO DE IMPUESTOS INTERNOS" ;
	COLOR ,RGB(255,255,255,,,,)
@ 14.308,26.667 GET m.montoexe ;
	SIZE 1.000,14.167 ;
	DEFAULT 0 ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "99,999,999.99" ;
	WHEN LAST()#27 .and. HAYFACTURA .and. !empty(m.monto) ;
	MESSAGE "MONTO EXENTO" ;
	COLOR ,RGB(255,255,255,,,,)
@ 15.538,26.667 GET m.MONTOREF ;
	SIZE 1.000,14.167 ;
	DEFAULT 0 ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "99,999,999.99" ;
	WHEN LAST()#27 .and. HAYFACTURA .and. !empty(m.monto) ;
	MESSAGE "MONTO DEL RECARGO FINANCIERO" ;
	COLOR ,RGB(255,255,255,,,,)
@ 16.769,26.667 GET m.MONTOper ;
	SIZE 1.000,14.167 ;
	DEFAULT 0 ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "99,999,999.99" ;
	WHEN LAST()#27 .and. HAYFACTURA .and. !empty(m.monto) ;
	VALID _1ym0jxzh6() ;
	MESSAGE "MONTO DE LA PERCEPCION" ;
	COLOR ,RGB(255,255,255,,,,)
@ 17.923,1.167 SAY 'Total '+tit_sin ;
	SIZE 1.000,18.333 ;
	FONT "Arial", 10 ;
	STYLE "BIT" ;
	COLOR RGB(255,255,255,,,,)
@ 17.923,26.667 GET m.montoNET ;
	SIZE 1.000,14.167 ;
	DEFAULT " " ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	PICTURE "99,999,999.99" ;
	DISABLE ;
	COLOR ,RGB(255,255,255,,,,)
@ 9.692,44.500 GET M.SALE ;
	PICTURE "@*VN \<Confirma;\<Anula;\?\<Sale y No Graba" ;
	SIZE 1.438,18.333,0.813 ;
	DEFAULT 1 ;
	FONT "Arial", 10 ;
	STYLE "BT" ;
	VALID _1ym0jxzh7() ;
	COLOR ,,,,,,,,RGB(255,255,255,,,,)
@ 11.923,1.000 SAY "Retención I.V.A." ;
	FONT "Arial", 10 ;
	STYLE "BIT" ;
	COLOR RGB(255,255,255,,,,)
@ 13.154,1.000 SAY "Retención Ing. Brutos" ;
	FONT "Arial", 10 ;
	STYLE "BIT" ;
	COLOR RGB(255,255,255,,,,)
@ 10.692,1.000 SAY "I.V.A. Inscripto" ;
	FONT "Arial", 10 ;
	STYLE "BIT" ;
	COLOR RGB(255,255,255,,,,)

IF NOT WVISIBLE("win2")
	ACTIVATE WINDOW win2
ENDIF
IF NOT WVISIBLE("per")
	ACTIVATE WINDOW per
ENDIF


READ CYCLE ;
	SHOW _1ym0jxzh9()

RELEASE WINDOW per
RELEASE WINDOW win2

#REGION 0

SET READBORDER &rborder

IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       *********************************************************
*       *                                                         
*       *               PERRED/Windows Cleanup Code               
*       *                                                         
*       *********************************************************
*

#REGION 1
ELSE
   =IAUDI()
ENDIF
UNLO IN PER
=OFF_F2()
=KTRUCH()
   RELE MIX_VARI,MIX_T1,MIX_R1,MIX_C1,MIX_COD,MIX_IND,MIX_R2,MIX_C2,MIX_ALIAS,MIX_CAMPO,MIX_LARGO
RETURN


*       *********************************************************
*       *                                                         
*       *               IFACD/Windows Cleanup Code                
*       *                                                         
*       *********************************************************
*

#REGION 2
UNLO ALL
*IF LAST()=27 .AND. EMPTY(M.PROCOD)
*   EXIT
*ENDIF
*ENDDO
ELSE
=IAUDI()
ENDIF
=MEN_LIN(BOTOM)
RETURN



*       *********************************************************
*       *                                                         
*       *   PERRED/Windows Supporting Procedures and Functions    
*       *                                                         
*       *********************************************************
*

#REGION 1
FUNCTION CHKPER
RETURN !EMPTY(M.CLIENTE) .AND. !EMPTY(M.CODCLI)




*       *********************************************************
*       *                                                         
*       *   IFACD/Windows Supporting Procedures and Functions     
*       *                                                         
*       *********************************************************
*

#REGION 2
FUNCTION CARGA_IFACD
SELE MIX
GO BOTT
SKIP
SCAT MEMV BLAN
SELE per
GO BOTT
SKIP
SCAT MEMV BLAN
SELE FAR
SCAT MEMV BLAN
      STORE .T. TO HAYFACTURA
      STORE "" TO LACIUDA,ELIVA,PAANULAR,TEXTO,LACONDICIO,ELGASTO
      STORE NUL TO fechas,montocuot,fec,nad,LASCUOTAS
RETURN .T.


*       *********************************************************
*       *                                                         
*       * _1YM0JXZEH           m.codcli WHEN                      
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         PERRED,     Record Number:    5    
*       * Variable:            m.codcli                           
*       * Called By:           WHEN Clause                        
*       * Object Type:         Field                              
*       * Snippet Number:      1                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _1ym0jxzeh     &&  m.codcli WHEN
#REGION 1
M.PRIOBJ=_CUROBJ
=OFF_F2()
STORE ULPRANT TO ULPR
if empty(m.cliente)
STORE .T. TO INGRESO
STORE .F. TO CAMBIO
endif
ON KEY LABEL F2 M.CODCLI=QUEPOPUP("a Corregir",1,22)
ON KEY LABEL F3 M.CODCLI=SEEKTECX(30,'PER','CLIENTE','PER.CODCLI',CONTENIDO[4],ALIAS(),ORDER(),2,22)
ON KEY LABEL F4 DO M_ULTPER
RETURN EMPTY(M.CLIENTE)

*       *********************************************************
*       *                                                         
*       * _1YM0JXZEP           m.codcli VALID                     
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         PERRED,     Record Number:    5    
*       * Variable:            m.codcli                           
*       * Called By:           VALID Clause                       
*       * Object Type:         Field                              
*       * Snippet Number:      2                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _1ym0jxzep     &&  m.codcli VALID
#REGION 1
IF LAST()=27
   RETURN .T.
ENDIF
M.CODCLI1=M.CODCLI
M.CODCLI2=EVAL(TEXTO[4])
IF YAESTABA(M.CODCLI1,'PER',CONTENIDO[3]) .OR. ;
     YAESTABA(M.CODCLI2,'PER',CONTENIDO[3])
   STORE .T. TO CORRIGE
   =YAPER(TEXTO[1])
   STORE .F. TO INGRESO,CAMBIO
   IF DELE()
      RETURN LLPER("PER",ALLTRIM(PER.CODCLI)+"-"+ALLTRIM(PER.CLIENTE))
   ENDIF
ELSE
   STORE "" TO M.CODCLI
ENDIF
RETURN SGET("PER")


*       *********************************************************
*       *                                                         
*       * _1YM0JXZET           m.CLIENTE WHEN                     
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         PERRED,     Record Number:    6    
*       * Variable:            m.CLIENTE                          
*       * Called By:           WHEN Clause                        
*       * Object Type:         Field                              
*       * Snippet Number:      3                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _1ym0jxzet     &&  m.CLIENTE WHEN
#REGION 1
ON KEY LABEL F2 M.CLIENTE=QUEPOPUP("a Corregir",2,12)
ON KEY LABEL F3 M.CLIENTE=SEEKTECX(30,'PER','CLIENTE','CLIENTE',(CONTENIDO[4]))
RETURN LAST()#27 .AND. !NOCOD(M.CODCLI) .AND. ESPROPIO

*       *********************************************************
*       *                                                         
*       * _1YM0JXZEY           m.CLIENTE VALID                    
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         PERRED,     Record Number:    6    
*       * Variable:            m.CLIENTE                          
*       * Called By:           VALID Clause                       
*       * Object Type:         Field                              
*       * Snippet Number:      4                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _1ym0jxzey     &&  m.CLIENTE VALID
#REGION 1
IF LAST()=27
   RETURN .T.
ELSE
   IF YAESTABA(M.CLIENTE,'PER',CONTENIDO[4])
      IF DELE()
         RETURN LLPER("PER",ALLTRIM(PER.CODCLI)+"-"+CLI.CLIENTE)
      ENDIF
      IF INGRESO
         =YAPER(UPPER(TIPO_PER))
      ELSE
         XA=NROCAMPO(VARREAD(),"PER")
         IF RESPALDO[XA]#M.CLIENTE
            =YAPER(UPPER(TIPO_PER))
         ENDIF
      ENDIF
   ELSE
      STORE .T. TO CAMBIO
   ENDIF
ENDIF
RETURN .T.


*       *********************************************************
*       *                                                         
*       * _1YM0JXZF0           m.factura WHEN                     
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         IFACD,     Record Number:   27     
*       * Variable:            m.factura                          
*       * Called By:           WHEN Clause                        
*       * Object Type:         Field                              
*       * Snippet Number:      5                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _1ym0jxzf0     &&  m.factura WHEN
#REGION 2
IF LAST()=27 .OR. EMPTY(M.CODCLI)
   RETURN .T.
ENDIF
STORE .T. TO HAYFACTURA
RETURN OFF_F2() .AND. SGET("WIN2")


*       *********************************************************
*       *                                                         
*       * _1YM0JXZF1           m.factura VALID                    
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         IFACD,     Record Number:   27     
*       * Variable:            m.factura                          
*       * Called By:           VALID Clause                       
*       * Object Type:         Field                              
*       * Snippet Number:      6                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _1ym0jxzf1     &&  m.factura VALID
#REGION 2
M.FACTURA=UPPER(Q_FAC(M.FACTURA))
IF RIGHT(M.FACTURA,8)='00000000' .OR. ;
   LAST()=27
   STORE .F. TO HAYFACTURA
   RETURN .T.
ELSE
   IF USED("FAD") .AND. XSEEK(M.FACTURA+PER.CODCLI,'FAD','FACTURA')
      IF SOLOVER
         SELE FAD
         SCAT MEMV
         _CUROBJ=20
         RETURN SGET("WIN2")
      ELSE
         RETURN .F.
      ENDIF
   ENDIF
ENDIF
RETURN SGET("WIN2") .AND. !XSEEK(M.FACTURA+PER.CODCLI,'FAR','FACTURA')


*       *********************************************************
*       *                                                         
*       * _1YM0JXZFL           M.condpago WHEN                    
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         IFACD,     Record Number:   29     
*       * Variable:            M.condpago                         
*       * Called By:           WHEN Clause                        
*       * Object Type:         Field                              
*       * Snippet Number:      7                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _1ym0jxzfl     &&  M.condpago WHEN
#REGION 2
IF LAST()#27 .and. HAYFACTURA
ON KEY LABEL F2 M.CONDPAGO=QUEPOPUP("DE "+UPPER(TIT_SIN),8,37)
ON KEY LABEL F3 M.CONDPAGO=SEEKTECX(30,'MIX','TEXTO1','MIX.TEXTO1','TEXTO1',"","",8,37)
RETURN .T.
ELSE
RETURN .F.
ENDIF

*       *********************************************************
*       *                                                         
*       * _1YM0JXZG2           M.gasto WHEN                       
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         IFACD,     Record Number:   31     
*       * Variable:            M.gasto                            
*       * Called By:           WHEN Clause                        
*       * Object Type:         Field                              
*       * Snippet Number:      8                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _1ym0jxzg2     &&  M.gasto WHEN
#REGION 2
IF LAST()#27 .and. HAYFACTURA
ON KEY LABEL F2 M.GASTO=QUEPOPUP("DE "+UPPER(TIT_SIN),8,37)
ON KEY LABEL F3 M.GASTO=SEEKTECX(30,'MIX','TEXTO1','MIX.TEXTO1','TEXTO1',"","",8,37)
RETURN .T.
ELSE
RETURN .F.
ENDIF


*       *********************************************************
*       *                                                         
*       * _1YM0JXZGL           m.descuento VALID                  
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         IFACD,     Record Number:   35     
*       * Variable:            m.descuento                        
*       * Called By:           VALID Clause                       
*       * Object Type:         Field                              
*       * Snippet Number:      9                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _1ym0jxzgl     &&  m.descuento VALID
#REGION 2
m.montobru=m.monto-m.descuento
m.hayfactura=montobru>0
IF M.HAYFACTURA
STORE M.MONTOBRU*iva18 TO M.MONTOIVA
STORE nul TO M.MONTOOT2
STORE nul TO M.MONTOOT3
ENDIF
RETURN SGET("WIN2")


*       *********************************************************
*       *                                                         
*       * _1YM0JXZH6           m.MONTOper VALID                   
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         IFACD,     Record Number:   42     
*       * Variable:            m.MONTOper                         
*       * Called By:           VALID Clause                       
*       * Object Type:         Field                              
*       * Snippet Number:      10                                 
*       *                                                         
*       *********************************************************
*
FUNCTION _1ym0jxzh6     &&  m.MONTOper VALID
#REGION 2
m.montonet=m.montobru+m.montoiva+m.montoot2+m.montoot3+m.montoexe+m.montoref+m.montoper
m.montonet=round(m.montonet,2)
RETURN sget("win2")


*       *********************************************************
*       *                                                         
*       * _1YM0JXZH7           M.SALE VALID                       
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         IFACD,     Record Number:   45     
*       * Variable:            M.SALE                             
*       * Called By:           VALID Clause                       
*       * Object Type:         Push Button                        
*       * Snippet Number:      11                                 
*       *                                                         
*       *********************************************************
*
FUNCTION _1ym0jxzh7     &&  M.SALE VALID
#REGION 2
DO CASE
CASE M.SALE=3
   CLEA READ
CASE M.SALE=1
   if m.montonet#0
      if xseek(m.condpago,"mix","pagcod")
            CREATE CURSOR CUOTAS ;
              (FECHAVE D(8),;
              FVE_OK D(8),;
              NUMERO N(5),;
              MONTO N(12,2),;
              MONTO_OK N(12,2),;
              FECHA D(8),;
              USUARIO C(10))
            FECHAIN=DATE()
            RESTO=MOD(M.MONTONET,MIX.NU1)
            M.MONTO=(M.MONTONET-RESTO)/MIX.NU1
            M.MONTO_OK=M.MONTO
            FOR XA=1 TO MIX.NU1
               M.FECHAVE=FECHAIN+MIX.NU2+((XA-1)*MIX.NU5)
               M.FVE_OK=M.FECHAVE
               M.NUMERO=XA
               =AGRABAR("CUOTAS")
            NEXT
            GO TOP
            REPL MONTO WITH MONTO+RESTO
            REPL MONTO_OK WITH MONTO
            =MEN_LIN("Moficaci¢n Cuotas - [F10] Confirma - [ESC] Anula "+PROP(M.tit_sin))
            ON KEY LABEL F10 KEYB CHR(23)
            DO WHILE .T.
               SELE CUOTAS
               BROW FIELD ;
                 NUMERO:R:H=PADC("CUOTA",10):P="9999999999",;
                 FECHAVE:H="VENCIMIENTO":V=AJFEC():E="FECHA INCORRECTA",;
                 MONTO:H="MONTO CUOTA":P="99,999.99":V=AJMON():E=NOMENOR("0") ;
                 TITL " Discriminaci¢n del Pago - Monto Total :"+trans(m.montonet,"99,999.99")+" "
               SELE CUOTAS
               CALC SUM(MONTO) TO M.MONTOT
               IF M.MONTOT=M.MONTONET .OR. LAST()=27
                  EXIT
               ELSE
                  =WNCL("EL TOTAL A PAGAR NO COINCIDE CON EL MONTO ORIGINAL")
               ENDIF
            ENDDO
            ON KEY LABEL F10
            M.OK=(LAST()#27)
         IF LAST()#27 .AND. ;
              !EMPTY(per.codcli) .AND. ;
              !EMPTY(M.FACTURA) .AND. ;
              !EMPTY(M.MONTONET)
            SELE ccp
            m.nada=per.codcli
            m.nada1=m.moneda
            m.fechave=DATE()
            sele cuotas
            scan
               sele ccp
               M.LAFACOK=M.FACTURA
               SCAT MEMV BLAN
               M.FACTURA=M.LAFACOK
               m.compr=ABRE+" "+m.factura
               m.procod=m.nada
               m.fechaop=m.fechaem
               m.detalle="Rec. "+ABR1+" N§ "+m.factura
               m.comprre=UPPER(tipopec)
               m.numerore=m.factura
               m.moneda=m.nada1
               m.fechave=cuotas.fechave
               m.monto=cuotas.monto
               m.equivale=m.monto / XACOTIZ
               m.gy_haber=cuotas.monto
               =AGRABAR("CCP")
               sele cuotas
            endscan
            M.tipo=UPPER(tipopec)
            =AGRABAR("FAR")
            CLEA READ
         ELSE
            STORE .T. TO INGRESO
            =FALTADAT(TIT_INV)
            _CUROBJ=1
         ENDIF
      endif
   endif
ENDCASE
RETURN SGET("WIN2")


*       *********************************************************
*       *                                                         
*       * _1YM0JXZH9           Read Level Show                    
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         Multiple Screens                   
*       * Called By:           READ Statement                     
*       * Snippet Number:      12                                 
*       *                                                         
*       *********************************************************
*
FUNCTION _1ym0jxzh9     && Read Level Show
PRIVATE currwind
STORE WOUTPUT() TO currwind
*
* Show Code from screen: IFACD
*
#REGION 2
IF SYS(2016) = "WIN2" OR SYS(2016) = "*"
	ACTIVATE WINDOW win2 SAME
	@ 2.308,40.167 CLEAR TO 3.308,70.167
	@ 2.308,40.167 SAY IIF(EMPTY(M.CONDPAGO),"",SAYMIX(M.CONDPAGO,"PAGCOD")) ;
		SIZE 1.000,30.000, 0.000 ;
		FONT "Arial", 10 ;
		STYLE "BT" ;
		PICTURE "@!" ;
		COLOR RGB(255,255,255,,,,)
	@ 3.462,40.000 CLEAR TO 4.462,69.500
	@ 3.462,40.000 SAY IIF(EMPTY(M.GASTO),"",SAYMIX(M.GASTO,"GASCOD")) ;
		SIZE 1.000,29.500, 0.000 ;
		FONT "Arial", 10 ;
		STYLE "BT" ;
		PICTURE "@!" ;
		COLOR RGB(255,255,255,,,,)
	@ 17.923,1.167 CLEAR TO 18.923,19.500
	@ 17.923,1.167 SAY 'Total '+tit_sin ;
		SIZE 1.000,18.333, 0.000 ;
		FONT "Arial", 10 ;
		STYLE "BIT" ;
		COLOR RGB(255,255,255,,,,)
ENDIF
IF NOT EMPTY(currwind)
	ACTIVATE WINDOW (currwind) SAME
ENDIF