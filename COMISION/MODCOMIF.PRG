PROCEDURE MODCOMIF
HISTORICO=.F.
=OPCCL()
=OPCLI()
=OPMER()
IF HISTORICO
	=CLOSDBF("FAX")
	=CLOSDBF("FAC")
	=OPFAH()
ELSE
	=opfac()
ENDIF
store nul to respuesta
if elifac()
	SELE FAX
	=XSEEK(FAC.CODCLI, "PER","CODCLI")
       SET ORDE TO ARTICULO IN MER
       SET RELA TO ARTICULO INTO MER
	DEFI WIND WIN FROM 1,1 TO 37,80
	SET RELA TO ARTICULO INTO MER
	**ON KEY LABEL ESC KEYBOARD CHR(10)
	ON KEY LABEL F10 KEYBOARD CHR(23)
	BROW FIEL ;
		CANTIDAD:P="9999",;
		ARTICULO:P="@!",;
		MER.MERCA:P="@!",;
		PORCOMISIO:P="999.99":H="% COM.",;
		TOTAL:R:P="99,999.99" ;
		TITL " Facturado a "+alltrim(per.cliente)+" Factura "+FAC.FACTURA+" " ;
		FONT "ARIAL",9 ;
		COLOR RGB(255,0,0,255,255,255) ;
		WIND WIN ;
		FREEZE PORCOMISIO ;
		KEY FAC.FACTURA NODE NOAP 
	RELE WIND WIN
	**ON KEY LABEL ESC
	ON KEY LABEL F10
	IF LAST()#27
	   XDTO = 1 - (FAC.DESCUENTO/IIF(LEFT(PER.CONDIVA,1)="R",FAC.MONTO, FAC.DESCUENTO+FAC.MONTONET ))
	   STORE 0 TO M.TOTCOMISIO
   	   SELE FAX
          SCAN FOR FACTURA=FAC.FACTURA
    	          M.TOTCOMISIO = M.TOTCOMISIO + TOTAL / 100 * PORCOMISIO
          ENDSCAN
          M.TOTCOMISIO = M.TOTCOMISIO *  XDTO
          sele ccl
   	   set orde to numerore
          seek fac.factura
          REPL COMISION WITH M.TOTCOMISIO
	ENDIF
	=OFF_RELA()
ENDIF
RETURN .T.