* здFUNCION  дддддддддддддддддддддддддддддддддд©
* Ё    File Name: RESTACCH.PRG                 Ё
* Ё       Author: G. REINER                    Ё
* Ё Date created: 11-04-92                     Ё
* Ё Time created: 06:06:51pm                   Ё
* Ё    Copyright: SISTEMAS INFORMATICOS S.R.L. Ё
* юдддддддддддддддддддддддддддддддддддддддддддды
* IMPUTA PAGOS A FACTURAS DE COMPRA
FUNCTION RESTACCP
	PARAMETER VAR_PROVEE,VAR_FACTURA,VAR_MONTO,USA_SOBRA
	PRIVATE VAR_PROVEE,VAR_FACTURA,VAR_MONTO,VAR_ALIANT,SALIDA
	IF !EMPTY(VAR_MONTO)
		=MEN_LIN("IMPUTANDO PAGOS")
		STORE "" TO SALIDA
		M.VAR_ALIANT=ALIAS()
		*** PAGA LA FACTURA REQUERIDA
		SELE CCP
		SET ORDER TO TAG NUMERORE
		SEEK M.VAR_FACTURA
		SCAN WHILE CCP.NUMERORE=M.VAR_FACTURA .AND. M.VAR_MONTO>0
			=RESTACP1()
		ENDS
		IF USA_SOBRA
			*** SIGUE CON LAS OTRAS FACTURAS Y NOTAS DE CREDITO DEL CLIENTE
			IF M.VAR_MONTO>0
				SET ORDER TO TAG PROCOD
				SEEK M.VAR_PROVEE
				SCAN WHILE CCP.PROCOD=M.VAR_PROVEE  .AND. M.VAR_MONTO>0
					IF CCP.COMPRRE='FA' .OR. CCP.COMPRRE='NC' .OR. EMPTY(CCP.COMPRRE)
						=RESTACP1()
					ENDIF
				ENDS
			ENDIF
			*** ASIGNA LO QUE SOBRA A LA FACTURA PEDIDA
			IF M.VAR_MONTO>0
				SET ORDER TO TAG NUMERORE
				SEEK M.VAR_FACTURA
				M.REGISTRO=STR(RECNO())
				=RLOCK() .OR. LOK()
				REPL CCP.CUOTA WITH CCP.CUOTA+M.VAR_MONTO
				REPL CCP.PAGADA WITH CCP.CUOTA>=CCP.MONTO
			ENDIF
		ELSE
			SALIDA=M.VAR_MONTO
		ENDIF
		=MEN_LIN(BOTOM)
		IF !EMPTY(M.VAR_ALIANT)
			SELE (M.VAR_ALIANT)
		ENDIF
	ENDIF
RETURN SALIDA
* зд FUNCION  дддддддддддддддддд©
* Ё  Description: RESTACP1      Ё
* Ё       Author: G. REINER     Ё
* Ё Date created: 11-04-92      Ё
* Ё Time created: 06:02:01pm    Ё
* юддддддддддддддддддддддддддддды
FUNCTION RESTACP1
	IF !CCP.PAGADA
		IF CCP.CUOTA<CCP.MONTO
			M.RESTO=CCP.MONTO-CCP.CUOTA
			M.RESTO=MIN(M.RESTO,M.VAR_MONTO)
			M.VAR_MONTO=M.VAR_MONTO-M.RESTO
			M.REGISTRO=STR(RECNO())
			=RLOCK() .OR. LOK()
			REPL CCP.CUOTA WITH CCP.CUOTA+M.RESTO
			REPL CCP.PAGADA WITH CCP.CUOTA>=CCP.MONTO
			UNLO IN CCP
		ENDIF
	ENDIF
RETURN .T.
