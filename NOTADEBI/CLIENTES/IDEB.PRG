*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        13/04/94              IDEB.PRG                 23:25:23 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 1994 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

DEFINE WINDOW ideb ;
	FROM INT((SROW()-20)/2),INT((SCOL()-63)/2) ;
	TO INT((SROW()-20)/2)+19,INT((SCOL()-63)/2)+62 ;
	TITLE " NOTA DE DEBITO " ;
	NOFLOAT ;
	NOCLOSE ;
	SHADOW ;
	NOMINIMIZE ;
	COLOR SCHEME 1


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                  IDEB/MS-DOS Setup Code - SECTION 2            
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1

ULPR=HORA_ULP(PROGRAM())
IF CHEQSEG()
   DO WHILE .T.
      =CARGA_ID()
      M.ESNUM=(TYPE("FAC.FACTURA")="N")
      M.HAYEXE=HAYCAMPO("EXENTO","FAC")
      STORE NUL TO M.PUNMAR


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       IDEB/MS-DOS Screen Layout                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
IF WVISIBLE("ideb")
	ACTIVATE WINDOW ideb SAME
ELSE
	ACTIVATE WINDOW ideb NOSHOW
ENDIF
@ 1,9 GET m.codcli ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@!" ;
	WHEN _qp51e7d1o() ;
	VALID _qp51e7dib() ;
	MESSAGE "Ingrese Cliente"+TEX_EFES	 ;
	ERROR "CLIENTE INEXISTENTE"
@ 2,9 SAY IIF(EMPTY(M.CODCLI),"",PER.cliente) ;
	SIZE 1,30 ;
	PICTURE "@!"
@ 3,9 SAY IIF(EMPTY(M.CODCLI),"",PER.domicilio) ;
	SIZE 1,30 ;
	PICTURE "@!"
@ 3,40 SAY IIF(EMPTY(M.CODCLI),"",SAYMIX(PER.LOCALIDAD,"CIUCOD")) ;
	SIZE 1,20 ;
	PICTURE REPL('X',20)
@ 4,9 SAY IIF(EMPTY(M.CODCLI),"",XACIVA[PER.CONDIVA,1]) ;
	SIZE 1,22 ;
	PICTURE repl('X',20)
@ 4,40 SAY IIF(EMPTY(M.CODCLI),"",PER.nroiva) ;
	SIZE 1,15 ;
	PICTURE "@!"
@ 1,1 SAY "Cliente" ;
	SIZE 1,7, 0
@ 9,23 SAY ":" ;
	SIZE 1,1, 0
@ 9,1 SAY "Neto Gravado" ;
	SIZE 1,12, 0
@ 10,23 SAY ":" ;
	SIZE 1,1, 0
@ 13,1 SAY "Exento" ;
	SIZE 1,6, 0
@ 11,23 SAY ":" ;
	SIZE 1,1, 0
@ 12,23 SAY ":" ;
	SIZE 1,1, 0
@ 13,23 SAY ":" ;
	SIZE 1,1, 0
@ 6,1 SAY "Factura Relacionada   :" ;
	SIZE 1,23, 0
@ 8,1 SAY "Texto Aclaratorio     :" ;
	SIZE 1,23, 0
@ 7,16 SAY "       :" ;
	SIZE 1,8, 0
@ 10,1 SAY ALLTRIM(XACI[1]) ;
	SIZE 1,22 ;
	PICTURE "@!"
@ 11,1 SAY ALLTRIM(XACI[2]) ;
	SIZE 1,22 ;
	PICTURE "@!"
@ 12,1 SAY ALLTRIM(XACI[3]) ;
	SIZE 1,22 ;
	PICTURE "@!"
@ 10,39 GET IVA1 ;
	SIZE 1,6 ;
	DEFAULT " " ;
	PICTURE "999.99" ;
	WHEN !EMPTY(M.CODCLI) ;
	DISABLE
@ 11,39 GET IVA2 ;
	SIZE 1,6 ;
	DEFAULT " " ;
	PICTURE "999.99" ;
	WHEN !EMPTY(M.CODCLI) ;
	DISABLE
@ 12,39 GET IVA3 ;
	SIZE 1,6 ;
	DEFAULT " " ;
	PICTURE "999.99" ;
	WHEN !EMPTY(M.CODCLI) ;
	DISABLE
@ 6,25 GET m.paanular ;
	SIZE 1,14 ;
	DEFAULT " " ;
	PICTURE IIF(ESNUM,REPL('9',14),REPL('X',14)) ;
	WHEN _qp51e7edk() ;
	VALID _qp51e7eke() ;
	MESSAGE "N DE LA FACTURA RELACIONADA - [F4] FACTURAS DEL CLIENTE" ;
	ERROR "FACTURA INEXISTENTE"
@ 7,25 GET m.factura ;
	SIZE 1,14 ;
	DEFAULT " " ;
	PICTURE IIF(ESNUM,REPL('9',14),REPL('X',14)) ;
	WHEN _qp51e7erd() ;
	VALID _qp51e7f0z() ;
	MESSAGE "N DE LA NOTA DE DEBITO A EMITIR" ;
	ERROR "DOCUMENTO EXISTENTE - POR FAVOR CAMBIE EL NUMERO"
@ 8,25 GET m.texto ;
	SIZE 1,33 ;
	DEFAULT " " ;
	PICTURE repl('X',30) ;
	WHEN LAST()#27 ;
	MESSAGE "TEXTO DE LA NOTA DE DEBITO"
@ 9,25 GET m.montobru ;
	SIZE 1,13 ;
	DEFAULT 0 ;
	PICTURE "99,999,999.99" ;
	WHEN LAST()#27 ;
	VALID _qp51e7f9l() ;
	MESSAGE "NETO GRAVADO"
@ 10,25 GET m.montoiva ;
	SIZE 1,13 ;
	DEFAULT 0 ;
	PICTURE "99,999,999.99" ;
	WHEN LAST()#27 ;
	VALID SGET("IDEB") ;
	MESSAGE "MONTO DEL "+ALLTRIM(XACI[1])
@ 11,25 GET m.montoot2 ;
	SIZE 1,13 ;
	DEFAULT 0 ;
	PICTURE "99,999,999.99" ;
	WHEN LAST()#27 .AND. !EMPTY(XACIVA[PER.CONDIVA,4]) ;
	VALID SGET("IDEB") ;
	MESSAGE "MONTO DEL "+ALLTRIM(XACI[2])
@ 12,25 GET m.montoot3 ;
	SIZE 1,13 ;
	DEFAULT 0 ;
	PICTURE "99,999,999.99" ;
	WHEN LAST()#27 .AND. !EMPTY(XACIVA[PER.CONDIVA,6]) ;
	VALID SGET("IDEB") ;
	MESSAGE "MONTO DEL "+ALLTRIM(XACI[3])
@ 13,25 GET M.exento ;
	SIZE 1,13 ;
	DEFAULT 0 ;
	PICTURE "99,999,999.99" ;
	WHEN LAST()#27 .AND. M.HAYEXE ;
	VALID SGET("IDEB") ;
	MESSAGE "MONTO EXENTO"
@ 14,25 SAY M.MONTOBRU+M.EXENTO+M.MONTOIVA+MONTOOT2+MONTOOT3 ;
	SIZE 1,13 ;
	PICTURE "99,999,999.99"
@ 16,20 GET m.opcion ;
	PICTURE "@*HN \!\<Confirma;\?\<Anula" ;
	SIZE 1,10,1 ;
	DEFAULT 1 ;
	VALID _qp51e7fmz() ;
	MESSAGE "CONFIRMA LA NOTA DE DEBITO REALIZADA ?"
@ 10,46 SAY "%" ;
	SIZE 1,1, 0
@ 11,46 SAY "%" ;
	SIZE 1,1, 0
@ 12,46 SAY "%" ;
	SIZE 1,1, 0
@ 7,1 SAY "Nota D괷ito N" ;
	SIZE 1,14, 0
@ 14,1 SAY "TOTAL NOTA DE DEBITO  :" ;
	SIZE 1,23, 0

IF NOT WVISIBLE("ideb")
	ACTIVATE WINDOW ideb
ENDIF

READ CYCLE ;
	SHOW _qp51e7ga1()

RELEASE WINDOW ideb

#REGION 0

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       IDEB/MS-DOS Cleanup Code                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
UNLO ALL
IF LAST()=27 .AND. EMPTY(M.CODCLI)
   EXIT
ENDIF
ENDDO
ELSE
=IAUDI()
ENDIF
=MEN_LIN(BOTOM)
RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QP51E7D1O           m.codcli WHEN                      
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         IDEB,     Record Number:    2      
*        Variable:            m.codcli                           
*        Called By:           WHEN Clause                        
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qp51e7d1o     &&  m.codcli WHEN
#REGION 1
ON KEY LABEL F2 M.CODCLI=QUEPOPUP("P/NOTA DE DEBITO",1,9)
ON KEY LABEL F3 M.CODCLI=SEEKTECX(30,'PER','CLIENTE','PER.CODCLI','CLIENTE',"","",2,9)
RETURN .T.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QP51E7DIB           m.codcli VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         IDEB,     Record Number:    2      
*        Variable:            m.codcli                           
*        Called By:           VALID Clause                       
*        Snippet Number:      2                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qp51e7dib     &&  m.codcli VALID
#REGION 1
IF LAST()=27
   RETURN .T.
ELSE
   IF EMPTY(M.CODCLI)
      KEYB CHR(27)
      RETURN .T.
   ELSE
      IF XSEEK(M.CODCLI,'PER','CODCLI')
			SELE PER
         SCAT MEMV
         ELIVA=XACIVA[PER.CONDIVA,1]
         IVA1=XACIVA[PER.CONDIVA,2]
         IVA2=XACIVA[PER.CONDIVA,4]
         IVA3=XACIVA[PER.CONDIVA,6]
         =XSEEK(PER.LOCALIDAD,'MIX','CIUCOD')
         LACIUDA=MIX.TEXTO1
         SHOW GETS
         IF !XSEEK(PER.CODCLI,'FAC','CODCLI')
            =CARTEL("NO HAY FACTURAS DEL CLIENTE",;
              "POR LO TANTO SERA IMPOSIBLE HACERLE",;
              "UNA NOTA DE DEBITO",;
              "POR FAVOR, REVISE Y REINTENTE")
            =CARGA_ID()
            =SGET("IDEB")
            _CUROBJ=1
         ENDIF
         RETURN .T.
      ENDIF
   ENDIF
ENDIF
RETURN .F.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QP51E7EDK           m.paanular WHEN                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         IDEB,     Record Number:   25      
*        Variable:            m.paanular                         
*        Called By:           WHEN Clause                        
*        Snippet Number:      3                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qp51e7edk     &&  m.paanular WHEN
#REGION 1
IF LAST()=27
   RETURN .F.
ELSE
   ON KEY LABEL F2
   ON KEY LABEL F3
   ON KEY LABEL F4 M.PAANULAR=IDEB_BRO()
ENDIF
RETURN .T.

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QP51E7EKE           m.paanular VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         IDEB,     Record Number:   25      
*        Variable:            m.paanular                         
*        Called By:           VALID Clause                       
*        Snippet Number:      4                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qp51e7eke     &&  m.paanular VALID
#REGION 1
IF LAST()=27
RETURN .T.
ELSE
M.PAANULAR=IIF(TYPE("FAC.FACTURA")="C",Q_FAC(M.PAANULAR),M.PAANULAR)
RETURN SGET("IDEB") .AND. XSEEK(M.PAANULAR,'FAC','FACTURA')
ENDIF

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QP51E7ERD           m.factura WHEN                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         IDEB,     Record Number:   26      
*        Variable:            m.factura                          
*        Called By:           WHEN Clause                        
*        Snippet Number:      5                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qp51e7erd     &&  m.factura WHEN
#REGION 1
IF LAST()#27
   PUNMAR=5
   LETR=""
   IF TYPE("FAC.FACTURA")="C"
      LETR=LEFT(ALLTRIM(M.PAANULAR),1)
      IF LETR="B"
         PUNMAR=6
      ENDIF
   ENDIF
   GO PUNMAR IN DOC
   REGISTRO=STR(PUNMAR)
   =RLOCK() .OR. LOK("DOC",REGISTRO)
   STOR doc.numero TO m.factura
   M.FACTURA=Q_FAC(M.FACTURA,'FAC.FACTURA',LETR,SUCU)
   SHOW GETS WIND IDEB
   RETURN .T.
ENDIF
RETURN .F.

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QP51E7F0Z           m.factura VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         IDEB,     Record Number:   26      
*        Variable:            m.factura                          
*        Called By:           VALID Clause                       
*        Snippet Number:      6                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qp51e7f0z     &&  m.factura VALID
#REGION 1
IF LAST()=27
   RETURN .T.
ELSE
M.FACTURA=IIF(ESNUM,Q_FAC("A"+SUCU+"-"+STR(M.FACTURA)),Q_FAC(M.FACTURA))
RETURN !XSEEK(M.FACTURA,'FAC','FACTURA')
ENDIF

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QP51E7F9L           m.montobru VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         IDEB,     Record Number:   28      
*        Variable:            m.montobru                         
*        Called By:           VALID Clause                       
*        Snippet Number:      7                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qp51e7f9l     &&  m.montobru VALID
#REGION 1
STORE M.MONTOBRU*XACIVA[PER.CONDIVA,2]/100 TO M.MONTOIVA
STORE M.MONTOBRU*XACIVA[PER.CONDIVA,4]/100 TO M.MONTOOT2
STORE M.MONTOBRU*XACIVA[PER.CONDIVA,6]/100 TO M.MONTOOT3
RETURN SGET("IDEB")


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QP51E7FMZ           m.opcion VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         IDEB,     Record Number:   34      
*        Variable:            m.opcion                           
*        Called By:           VALID Clause                       
*        Snippet Number:      8                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qp51e7fmz     &&  m.opcion VALID
#REGION 1
DO CASE
CASE M.OPCION=1
 IF M.MONTOBRU+MONTOIVA+MONTOOT2+MONTOOT3+M.EXENTO>0
   REGISTRO=STR(PUNMAR)
   =LOCK() .OR. LOK("DOC")
   REPL DOC.NUMERO WITH IIF(ESNUM,m.factura,VAL(RIGHT(M.FACTURA,8)))+1
   UNLO IN DOC
   =FLOCK("CCL") .OR. FLOK("ccl")
   SAVE TO MEM.TMP
   SELE CCL
   SCAT MEMV BLAN
   SELE FAC
   SCAT MEMV BLAN
   REST FROM MEM.TMP ADDI
   STORE M.MONTOBRU+M.MONTOIVA+M.MONTOOT2+M.MONTOOT3+M.EXENTO TO M.MONTONET
   STORE DATE() TO M.FECHAOP,FECHAVE,FECHAEM
   STORE M.TEXTO TO M.DETALLE
   STORE "ND" TO M.COMPRRE,M.TIPO
   STORE IIF(ESNUM,Q_FAC(SUCU+"-"+STR(M.FACTURA)),M.FACTURA) TO NUMERORE
   STORE M.MONTONET TO M.MONTO
   STORE M.XAUSS TO M.MONEDA
   STORE M.MONTONET/M.XACOTIZ TO EQUIVALE
   =XSEEK(M.PAANULAR,'FAC','FACTURA')
   STORE IIF(EMPTY(FAC.TIPO),"FA",FAC.TIPO)+" N "+IIF(ESNUM,Q_FAC(SUCU+"-"+M.PAANULAR),M.PAANULAR) TO COMPR
   =AGRABAR("CCL")
   STORE FAC.CODVIA TO M.CODVIA
   STORE FAC.CONDPAGO TO M.CONDPAGO
   STORE M.MONTOBRU TO M.MONTO
   STORE M.XACOTIZ TO M.COTIZ
   =AGRABAR("FAC")
   =DISP_ND(LEFT(M.PAANULAR,1))
ENDIF
=CARGA_ID()
=SGET("IDEB")
RETURN 2
CASE M.OPCION=2
   IF EMPTY(M.CODCLI)
      CLEA READ ALL
   ELSE
      =CARGA_ID()
     =SGET("IDEB")
   ENDIF
ENDCASE
RETURN 1


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QP51E7GA1           Read Level Show                    
*                                                                
*        Function Origin:                                        
*                                                                
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         IDEB                               
*        Called By:           READ Statement                     
*        Snippet Number:      9                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qp51e7ga1     && Read Level Show
PRIVATE currwind
STORE WOUTPUT() TO currwind
*
* Show Code from screen: IDEB
*
#REGION 1
IF SYS(2016) = "IDEB" OR SYS(2016) = "*"
	ACTIVATE WINDOW ideb SAME
	@ 2,9 SAY IIF(EMPTY(M.CODCLI),"",PER.cliente) ;
		SIZE 1,30, 0 ;
		PICTURE "@!"
	@ 3,9 SAY IIF(EMPTY(M.CODCLI),"",PER.domicilio) ;
		SIZE 1,30, 0 ;
		PICTURE "@!"
	@ 3,40 SAY IIF(EMPTY(M.CODCLI),"",SAYMIX(PER.LOCALIDAD,"CIUCOD")) ;
		SIZE 1,20, 0 ;
		PICTURE REPL('X',20)
	@ 4,9 SAY IIF(EMPTY(M.CODCLI),"",XACIVA[PER.CONDIVA,1]) ;
		SIZE 1,22, 0 ;
		PICTURE repl('X',20)
	@ 4,40 SAY IIF(EMPTY(M.CODCLI),"",PER.nroiva) ;
		SIZE 1,15, 0 ;
		PICTURE "@!"
	@ 14,25 SAY M.MONTOBRU+M.EXENTO+M.MONTOIVA+MONTOOT2+MONTOOT3 ;
		SIZE 1,13, 0 ;
		PICTURE "99,999,999.99"
ENDIF
IF NOT EMPTY(currwind)
	ACTIVATE WINDOW (currwind) SAME
ENDIF
