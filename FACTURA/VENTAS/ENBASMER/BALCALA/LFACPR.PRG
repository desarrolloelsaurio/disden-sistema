*******************************************************************************
*-- Programa: lFACpr.prg
*-- Fecha   : 08/25/91
*-- Version : G. REINER
*-- Notas   : LISTADO DE RESUMEN DE FACURAS
********************************************************************************
STORE PROGRAM() TO ULPR
IF CHEQSEG()
	=working()
	NADA=GENTMP()
	IF FILMER=2
		SET ORDER TO ARTICULO IN MER
		SELE FAX
		SET RELA TO ARTICULO INTO MER
	ENDIF
	IF FILCLI=3
		SET ORDER TO CODCLI IN PER
		SELE FAC
		SET RELA TO CODCLI INTO PER ADDI
		sele FAX
		SET RELA TO FACTURA INTO FAC ADDI
		INDE ON PER.CODCLI TO (NADA) FOR EVAL(FISC) COMP
	ELSE
		IF FILVIA=3
			SET ORDER TO CODVIA IN VIA
			SELE FAC
			SET RELA TO CODVIA INTO VIA ADDI
			sele FAX
			SET RELA TO  FACTURA INTO FAC ADDI
			INDE ON VIA.VIAJANTE TO (NADA) FOR EVAL(FISC) COMP
		ELSE
			sele FAX
			SET RELA TO FACTURA INTO FAC ADDI
			sele FAX
			INDE ON FAX.FACTURA TO (NADA) FOR EVAL(FISC) COMP
		ENDIF
	ENDIF
	go top
	store nul to can,tcan,TOT,TTOT,TFAC
	STORE 1 TO FAC
	IF FILFAC=3
		ELARTICULO=FAX.FACTURA
		LAMERCA=FAC.FECHAEM
		store paip+PADC('FACTURA',13)+paip+PADC('FECHA',8)+paip+padc("CANTIDAD",XACDIGI)+paip+padc("MONTO",XACDIGI)+paip to acla
	else
		LAMERCA=FAC.FACTURA
		if filfec=3
			ELARTICULO=FAC.FECHAEM
			LAFACTURA=FAX.FACTURA
			store paip+PADC('FECHA',8)+paip+padc("CANTIDAD",XACDIGI)+paip+PADC("FACTURAS",XACDIGI)+PAIP+padc("MONTO",XACDIGI)+paip to acla
		ELSE
			IF FILVIA=3
				ELARTICULO=FAC.CODVIA
				LAFACTURA=VIA.VIAJANTE
				store paip+PADC(UPPER(BIAJA),30)+paip+padc("CANTIDAD",XACDIGI)+paip+PADC("FACTURAS",XACDIGI)+PAIP+padc("MONTO",XACDIGI)+paip to acla
			ELSE
				IF FILCLI=3
					ELARTICULO=FAC.CODCLI
					LAFACTURA=PER.CLIENTE
					store paip+PADC('CLIENTE',30)+paip+padc("CANTIDAD",XACDIGI)+paip+PADC("FACTURAS",XACDIGI)+PAIP+padc("MONTO",XACDIGI)+paip to acla
				ENDIF
			ENDIF
		endif
	ENDIF
	STORE REPL("=",LEN(acla)) TO lns
	tt=UPPER(TIT_INVOS)
	=unwork()
	=WIN0()
	pag=1
	=CABPAN()
	=tit_lns(1)
	GO TOP
	SCAN
		IF FILFAC=3
			ELCORTE=FAX.FACTURA
		ELSE
			IF FILFEC=3
				ELCORTE=FAC.FECHAEM
			ELSE
				IF FILVIA=3
					ELCORTE=FAC.CODVIA
				ELSE
					IF FILCLI=3
						ELCORTE=FAC.CODCLI
					ENDIF
				ENDIF
			ENDIF
		ENDIF
		IF ELCORTE#ELARTICULO
			=FLFACPR1()
		ENDIF
		IF ROW()=21
			IF TLFACPR1("SUBTOTAL")=27
				EXIT
			ENDIF
			CLEA
			STOR pag+1 TO pag
			=CABPAN()
			=tit_lns(2)
		ENDIF
		can=can+FAX.cantidad
		IF FILFEC=3
			IF FAX.FACTURA#LAFACTURA
				STORE FAC+1 TO FAC
				STORE TOT+FAC.MONTONET TO TOT
				LAFACTURA=FAX.FACTURA
			ENDIF
		ELSE
			IF FILFAC=3
				STORE FAC.MONTONET TO TOT
			ELSE
				IF FILVIA=3
					IF FAX.FACTURA#LAMERCA
						STORE FAC+1 TO FAC
						STORE TOT+FAC.MONTONET TO TOT
						LAMERCA=FAX.FACTURA
					ENDIF
				ELSE
					IF FILCLI=3
						IF FAX.FACTURA#LAMERCA
							STORE FAC+1 TO FAC
							STORE TOT+FAC.MONTONET TO TOT
							LAMERCA=FAX.FACTURA
						ENDIF
					ENDIF
				ENDIF
			ENDIF
		ENDIF
	ENDSCAN
	IF LAST()#27
		=FLFACPR1()
		=TLFACPR1("TOTAL")
	ENDIF
	=relewin("WIN")
	=REOPFAC()
ELSE
	=iaudi()
ENDIF
=men_lin(botom)
RETURN
function TLFACPR1
	parameter cosa
	private cosa
	? LNS
	? PAIP
	IF FILFAC=3
		?? PADR(COSA,13)
		?? PAIP
		?? SPACE(8)
	ELSE
		IF FILFEC=3
			?? PADR(COSA,8)
		else
			IF FILvia=3
				?? PADR(COSA,30)
			endif
		ENDIF
	ENDIF
	?? PAIP
	?? STR(TCAN,XACDIGI)
	?? PAIP
	IF FILFEC=3 .OR. FILVIA=3
		?? STR(TFAC,XACDIGI)
		?? PAIP
	ENDIF
	?? STR(TTOT,XACDIGI,2)
	?? PAIP
return(inkey(nul))
FUNCTION FLFACPR1
	? PAIP
	IF FILFAC=3
		?? SUCU+'-'+ZERO(ELARTICULO,8)
		?? PAIP
		?? LAMERCA
	ELSE
		IF FILFEC=3
			?? ELARTICULO
		else
			IF FILvia=3 .OR. FILCLI=3
				?? LAFACTURA
			endif
		ENDIF
	ENDIF
	?? paip
	?? str(can,xacdigi)
	?? PAIP
	tcan=tcan+can
	store nul to can
	IF FILFEC=3 .or. filvia=3 .OR. FILCLI=3
		?? STR(FAC,XACDIGI)
		?? PAIP
		TFAC=TFAC+FAC
		STORE NUL TO FAC
	ENDIF
	?? STR(TOT,XACDIGI,2)
	?? PAIP
	TTOT=TTOT+TOT
	STORE 0 TO TOT
	IF FILFAC=3
		ELARTICULO=FAX.FACTURA
		=FAC.FECHAEM
	ELSE
		IF FILFEC=3
			ELARTICULO=FAC.FECHAEM
		else
			IF FILvia=3
				ELARTICULO=FAC.CODVIA
				LAFACTURA=VIA.VIAJANTE
			ELSE
				IF FILCLI=3
					ELARTICULO=FAC.CODCLI
					LAFACTURA=PER.CLIENTE
				ENDIF
			endif
		ENDIF
	ENDIF
RETURN .T.
