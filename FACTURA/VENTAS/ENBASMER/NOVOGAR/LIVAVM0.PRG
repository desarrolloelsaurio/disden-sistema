* ษออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออป
* บ PROCEDIMIENTO : LIVAVM0.PRG                                              บ
* บ COMENTARIO    : GENERA CABECERA PARA LISTADO DE IVA POR MERCADERIAS      บ
* ฬออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออน
* บ AUTOR      : GOYO REINER                                                 บ
* บ FECHA      : 11-02-93                                                    บ
* บ HORA       : 09:10:21am                                                  บ
* บ COPYRIGHT  : 1993 by GREGORIO REINER                                     บ
* ศออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผ
FUNCTION LIVAVM0
	#DEFINE NUL  0                                && NUL
	#DEFINE PAIP   "|"                            && PAIP
	=WORKING()
	=DOTALK()
	TMP=GENTMP()
	SET DELE OFF
	SET ORDER TO TAG CODCLI IN PER
	SET ORDER TO TAG ARTICULO IN MER
	SELE FAC
	SET ORDER TO TAG FACTURA
	SET RELA TO CODCLI INTO PER
	SELE FAX
	SET ORDER TO
	SET RELA TO FACTURA INTO FAC ADDI
	SET RELA TO ARTICULO INTO MER ADDI

	=FLOCK("FAC") .OR. FLOK("FAC")
	=FLOCK("FAX") .OR. FLOK("FAX")
	=FLOCK("MER") .OR. FLOK("MER")
	=FLOCK('PER') .OR. FLOK('PER')

	SELE FAX
	SORT ON ARTICULO ;
		FOR &FISC ;
			TO (TMP) ;
			FIELD ARTICULO,;
			CANTIDAD,;
			MONTO1,;
			FAC.CODCLI,;
			FAC.TIPO,;
			PER.CONDIVA,;
			FAC.MONTOBRU,;
			FAC.DESCUENTO,;
			FAC.MONTOIVA,;
			FAC.MONTOOT2,;
			FAC.MONTOOT3,;
			FAC.MONTONET,;
			MER.ENLISTA

		UNLO ALL
		SELE FAX
		SET RELA OFF INTO MER

		SELE FAC
		USE
		USE (TMP) ALIAS FAC EXCL

		REPL ALL ENLISTA WITH .T.
		REPL ALL ENLISTA WITH (XACIVA[FAC.CONDIVA,3]="NO")
		REPL ALL ENLISTA WITH (FAC.MONTOBRU-FAC.DESCUENTO=FAC.MONTONET) FOR !ENLISTA

		REPL ALL MONTOOT2 WITH NUL,;
			MONTOIVA WITH NUL,;
			MONTONET WITH NUL,;
			MONTOOT3 WITH NUL

		REPL ALL MONTOIVA WITH XACIVA[FAC.CONDIVA,2],;
			MONTOOT2 WITH XACIVA[FAC.CONDIVA,4],;
			MONTO1 WITH MONTO1*CANTIDAD

		REPL ALL MONTOOT3 WITH MONTO1,;
			MONTONET WITH MONTOIVA+MONTOOT2

		REPL MONTONET WITH MONTONET/100+1 FOR ENLISTA

		REPL MONTONET WITH MONTO1/MONTONET FOR ENLISTA

		REPL MONTOIVA WITH MONTONET*MONTOIVA/100,;
			MONTOOT2 WITH MONTONET*MONTOOT2/100 FOR ENLISTA

		REPL MONTOIVA WITH MONTOIVA*MONTO1/100,;
			MONTOOT2 WITH MONTOOT2*MONTO1/100,;
			MONTONET WITH MONTO1,;
			MONTO1 WITH MONTOIVA+MONTOOT2+MONTONET ;
			FOR !ENLISTA

			=UNTALK()

			ACLA=PAIP+;
				PADC("ARTICULO",LEN(ARTICULO))+PAIP+;
				PADC("DETALLE",LEN(MER.MERCA))+PAIP+;
				PADC("CANTIDAD",XACDIGI-3)+PAIP+;
				PADC("NETO GRAVADO",XACDIGI)+PAIP+;
				PADC(ALLTRIM(XACI[1]),XACDIGI)+PAIP+;
				PADC(ALLTRIM(XACI[2]),XACDIGI)+PAIP+;
				PADC("TOTAL",XACDIGI)+PAIP
			LINEA=REPL("=",LEN(ACLA))
			SET DELE ON
			RETURN UNWORK()
