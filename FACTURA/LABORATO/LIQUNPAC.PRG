FUNCTION LIQUNPAC
	PARAMETER elpac,ELTIP,ELNUM,ELPRXCOD
	ULPR=HORA_ULP(PROGRAM())
	IF CHEQSEG()
		SELE PER
		SET ORDER TO TAG PACCOD
		IF SEEK(ELPAC)
			=XSEEK(PER.TEXTO1,"MUT","CODMUT")
			SELE PRX
			SET ORDER TO TAG UNIDAD
			SELE PRA
			SET ORDER TO TAG CODPRA
			SELE LIQ
			SET RELA TO PRACTICA INTO PRA ADDI
			LAM=ALLTRIM(MUT.MUTUAL)
			LAM1=ALLTRIM(MUT.MUTUALABR)
			STORE NUL TO M.P_GAL,M.P_GAS,M.P_RAD,M.P_REM,M.P_DES,M.P_CON
			STORE NUL TO M.O_GAL,M.O_GAS,M.O_RAD,M.O_REM,M.O_DES,M.O_CON
			STORE NUL TO M.T_GAL,M.T_GAS,M.T_RAD,M.T_REM,M.T_DES,M.T_CON
	STOR NUL TO CASOS,GASTOS,GALENOS,CATEGORIZ
	STOR NUL TO GALE_OS,GAST_OS,GALE_PAC,GAST_PAC,CATE_OS
	STOR NUL TO TOTAL,TMAT,TMED
				STORE TMP.TPR TO M.TPR
				STORE TMP.NUMERO TO M.NUMERO
				STORE TMP.PRACTICA TO M.PRACTICA
				STORE TMP.PRXCOD TO M.PRXCOD
			SCAN FOR TPR=ELTIP .AND. ;
				NUMERO=ELNUM .AND. ;
				PRXCOD=ELPRXCOD
				ELMUTUAL=PER.TEXTO1
				ELPLAN=LEFT(PER.TEXTO2,5)
				=XSEEK(ELMUTUAL+ELPLAN,"MUT","CODPLAN")
				ELARANC=MUT.TAR
				=XSEEK(ELMUTUAL+ELPLAN+"UNI","MUX","TIPO")
				ALPAC=MUX.AC_PACIEN
				ALMUT=MUX.AC_MUTUAL
			*** PROBANDO ACA
				GLN=PRA.CANTIDAD1*;
				SAYGRL(ELARANC+PRA.UNIDAD1,"MIX","ARACOD","MIX.NU1")
				GLN_PARC=GLN
				M.T_GAL=M.T_GAL+GLN
				GLN=GLN*ALMUT/100
				M.P_GAL=M.P_GAL+GLN_PARC*ALPAC/100
				M.O_GAL=GLN

				*** PROBANDO ACA TAMBIEN
				GTS=PRA.CANTIDAD2*;
				SAYGRL(ELARANC+PRA.UNIDAD2,"MIX","ARACOD","MIX.NU1")
				GTSPARC=GTS
				M.T_GAS=M.T_GAS+GTS
				GTS=GTS*ALMUT/100
				M.P_GAS=M.P_GAS+GTSPARC*ALPAC/100
				M.O_GAS=GTS
				?? STR(GTS,XACDIGI,2)

				PARC=GTS+GLN
				GALE_OS=GALE_OS+GLN
				GAST_OS=GAST_OS+GTS

				**** SE GUARDA EL MATERIAL PARA DESPUES
				IF !EMPTY(PRA.UNIDAD3)
					STORE PRA.UNIDAD3 TO M.PRAUNID3
					STORE PRA.TIPO3 TO M.PRATIPO3
					STORE 1 tO M.CANTI3
				ELSE
					STORE "" TO M.PRAUNID3,M.PRATIPO
				ENDIF
				*******
				=HAYCAT()
				**** CONTRASTE ?
				IF !EMPTY(PRA.CONTRASTE)
					=SAYCONT()
				ENDIF
				********** COMPONENTES
				SELE PRX
				SET ORDER TO TAG CODPRX1
				IF SEEK(LIQ.PRACTICA+LIQ.PRXCOD)
					SCAN WHILE PRX.CODPRA=LIQ.PRACTICA .AND. ;
						PRX.CODPRX=LIQ.PRXCOD
						IF EMPTY(PRX.UNIPRA) .OR. ;
							PRX.UNIPRA#LIQ.PRACTICA
							IF PRX.TIPO#"PRA"
								=SAYMAT(PRX.UNIDAD,PRX.TIPO)
							ELSE
								=SAYPRA(PRX.UNIPRA)
							ENDIF
							=CHKLIN()
						ENDIF
					ENDSCAN
				ENDIF
				SELE LIQ
				**** MATERIAL ?
				IF !EMPTY(PRAUNID3)
					=SAYMAT(PRAUNID3,PRATIPO3)
				ENDIF
				SELE LIQ
			ENDSCAN
			M.PAGA=.T.
    		=IIF(XSEEK(M.TPR+STR(M.NUMERO)+M.PRACTICA+M.PRXCOD,"LIX","NUMER1"),;			
			AGRABAR1("LIX",.F.,.T.),;
			AGRABAR("LIX",.F.,.F.,.T.))
			=IAUD(ELPAC)
		ENDIF
	ELSE
		=IAUDI()
	ENDIF
	=OFF_RELA()
RETURN MEN_LIN(BOTOM)

FUNCTION SAYMAT
	PARAMETER SA_UNID,SA_TIPO
	=XSEEK(SA_UNID,"MIX",SA_TIPO+"COD")
	M.CANTI3=PRX.CANTIDAD
	IF XSEEK(ELMUTUAL+ELPLAN+SA_TIPO,"MUX","TIPO")
		GTSOR=M.CANTI3*MIX.NU1
		GTS=M.CANTI3*MIX.NU1*MUX.AC_MUTUAL/100
	ELSE
		STORE M.CANTI3*MIX.NU1 TO GTS,GTSOR
	ENDIF
	GAST_OS=GAST_OS+GTS
	INDICE=SAYTIPO(SA_TIPO)
	DO CASE
	CASE INDICE=1
		M.O_DES=M.O_DES+GTS
		M.P_DES=M.P_DES+GTSOR*MUX.AC_PACIEN/100
		M.T_DES=M.T_DES+GTSOR
	CASE INDICE=2
		M.O_RAD=M.O_RAD+GTS
		M.P_RAD=M.P_RAD+GTSOR*MUX.AC_PACIEN/100
		M.T_RAD=M.T_RAD+GTSOR
	CASE INDICE=3
		M.O_REM=M.O_REM+GTS
		M.P_REM=M.P_REM+GTSOR*MUX.AC_PACIEN/100
		M.T_REM=M.T_REM+GTSOR
	CASE INDICE=4
		M.O_GAS=M.GAS+GTS
		M.P_GAS=M.P_GAS+GTSOR*MUX.AC_PACIEN/100
		M.T_GAS=M.T_GAS+GTSOR
	ENDCASE
RETURN .T.

FUNCTION SAYCONT
	GLN=GLN*PRA.CONTRASTE/100
	M.T_CON=M.T_CON+GLN
	M.O_CON=M.O_CON+GLN*ALMUT/100
	M.P_CON=M.P_CON+GLN*ALPAC/100
	GLN=GLN*ALMUT/100
	GTS=GTS*PRA.CONTRASTE/100
	M.T_CON=M.T_CON+GTS
	M.O_CON=M.O_CON+GTS*ALMUT/100
	M.P_CON=M.P_CON+GTS*ALPAC/100
	GTS=GTS*ALMUT/100
	GAST_OS=GAST_OS+GTS
	GALE_OS=GALE_OS+GLN

RETURN haycat()

FUNCTION SAYPRA
	PARAMETER LAPRA
	=SAYPR1(LAPRA)
	=XSEEK(LAPRA,"PRA","CODPRA")
	M.CTDD=PRX.CANTIDAD
	GLN=PRA.CANTIDAD1*M.CTDD*;
	SAYGRL(ELARANC+PRA.UNIDAD1,"MIX","ARACOD","MIX.NU1")*;
	(ALMUT/100)
	GTS=PRA.CANTIDAD2*;
	M.CTDD*;
	SAYGRL(ELARANC+PRA.UNIDAD2,"MIX","ARACOD","MIX.NU1")*;
	(ALMUT/100)
	GAST_OS=GAST_OS+GTS
	GALE_OS=GALE_OS+GLN
	=HAYCAT()
	*
	IF !EMPTY(PRA.UNIDAD3)
		=SAYMAT(PRA.UNIDAD3,PRA.TIPO3)
	ENDIF
	*
RETURN

FUNCTION SAYPR1
	PARAMETER PRA1
	IF EMPTY(RIGHT(PRA1,1))
	RETURN PRA1
ENDIF
IF RIGHT(PRA1,1)="A" .OR. ;
	RIGHT(PRA1,1)="B"
RETURN PRA1
ENDIF
RETURN LEFT(PRA1,6)+" "

FUNCTION HAYCAT
	** BUSCA MEDICO PARA CATEGORIZACION
	IF XSEEK(LIQ.INTERNO,"PER","INTERCOD")
		CAT=VAL(PER.DETALLE)
		LACAT=GLN*CAT/100
		CATEGORIZ=CATEGORIZ+LACAT
	ENDIF
RETURN .T.

FUNCTION CHKLIN
	IF _PLINENO>63
		=FIN_LIN(3,NUL)
		=cabpri1()
		=TIT_LIN(FOUR)
	ENDI
RETURN .T.
