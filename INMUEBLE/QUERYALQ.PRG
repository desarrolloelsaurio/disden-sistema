*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        23/12/93            QUERYALQ.PRG               07:36:14 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        GREGORIO REINER                                         
*                                                                
*        Copyright (c) 1993 GOYO REINER                          
*        MITRE 1480 '4' B                                       
*        ROSARIO, SF  2000                                       
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                QUERYALQ/MS-DOS Setup Code - SECTION 1          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 3
STORE "" TO ttinm, ttuni, tttip, ttCLI, ttgar, ttprp, ttciu, ;
            ttest, ttfve, ttfin, ttven, ttfal, ttact, ttmnd
STORE 1  TO filinm, filuni, filtip, filCLI, filgar, filprp, filciu, ;
            filest, filfve, filfin, filven, filfal, filact, filmnd
STORE "" TO queinm, queuni, quetip, queCLI, quegar, queprp, queciu, ;
            queest, quefve, quefin, queven, quefal, queact, quemnd
STORE SPACE(20) TO shinm, shuni, shtip, shCLI, shgar, shprp, shciu, ;
            shest, shfve, shfin, shven, shfal, shact, shmnd
store 1 to minobj
store 3 to maxobj
STORE .F. TO M.HUBORES




#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

IF NOT WEXIST("_qm00gaphz")
	DEFINE WINDOW _qm00gaphz ;
		FROM 2, 1 ;
		TO 6,25 ;
		NOFLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("_qm00gapo4")
	DEFINE WINDOW _qm00gapo4 ;
		FROM 2, 27 ;
		TO 6,51 ;
		NOFLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("queryalq") ;
	OR UPPER(WTITLE("QUERYALQ")) == "QUERYALQ.PJX" ;
	OR UPPER(WTITLE("QUERYALQ")) == "QUERYALQ.SCX" ;
	OR UPPER(WTITLE("QUERYALQ")) == "QUERYALQ.MNX" ;
	OR UPPER(WTITLE("QUERYALQ")) == "QUERYALQ.PRG" ;
	OR UPPER(WTITLE("QUERYALQ")) == "QUERYALQ.FRX" ;
	OR UPPER(WTITLE("QUERYALQ")) == "QUERYALQ.QPR"
	DEFINE WINDOW queryalq ;
		FROM 1, 0 ;
		TO 23,79 ;
		TITLE "L죑ites del Listado " ;
		NOFLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		DOUBLE ;
		COLOR SCHEME 1
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       QINM/MS-DOS Screen Layout                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
IF WVISIBLE("_qm00gaphz")
	ACTIVATE WINDOW _qm00gaphz SAME
ELSE
	ACTIVATE WINDOW _qm00gaphz NOSHOW
ENDIF
@ 0,0 GET m.filinm ;
	PICTURE "@*RVN \<Todos los Inmuebles;\<Un Inmueble;\<Opciones" ;
	SIZE 1,23,0 ;
	DEFAULT 1 ;
	WHEN betw(_curobj,minobj,maxobj) ;
	VALID _qm00gartr()




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       QINQ/MS-DOS Screen Layout                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 2
IF WVISIBLE("_qm00gapo4")
	ACTIVATE WINDOW _qm00gapo4 SAME
ELSE
	ACTIVATE WINDOW _qm00gapo4 NOSHOW
ENDIF
@ 0,0 GET m.filcli ;
	PICTURE "@*RVN \<Todos los Inquilin.;\<Opciones;\<Resumen" ;
	SIZE 1,23,0 ;
	DEFAULT 1 ;
	WHEN FILINM=3 .AND. betw(_curobj,minobj,maxobj) ;
	VALID VAL_OBJ1()




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     QUERYALQ/MS-DOS Screen Layout              
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 3
IF WVISIBLE("queryalq")
	ACTIVATE WINDOW queryalq SAME
ELSE
	ACTIVATE WINDOW queryalq NOSHOW
ENDIF
@ 12,13 GET m.filgar ;
	PICTURE "@*RVN \<Todos los Garantes;\<Un Garante;\<Resumen" ;
	SIZE 1,22,0 ;
	DEFAULT 1 ;
	WHEN FILINM=3 .AND. betw(_curobj,minobj,maxobj) ;
	VALID VAL_OBJ1()
@ 12,38 GET m.filprp ;
	PICTURE "@*RVN \<Todos los Propietar.;\<Opciones;\<Resumen" ;
	SIZE 1,24,0 ;
	DEFAULT 1 ;
	WHEN FILINM=3 .AND. betw(_curobj,minobj,maxobj) ;
	VALID VAL_OBJ1()
@ 19,32 GET m.lista ;
	PICTURE "@*HN \!Confirma;\?Anula" ;
	SIZE 1,10,1 ;
	DEFAULT 1 ;
	VALID _qm00gascy()

IF NOT WVISIBLE("queryalq")
	ACTIVATE WINDOW queryalq
ENDIF
IF NOT WVISIBLE("_qm00gapo4")
	ACTIVATE WINDOW _qm00gapo4
ENDIF
IF NOT WVISIBLE("_qm00gaphz")
	ACTIVATE WINDOW _qm00gaphz
ENDIF


READ CYCLE

RELEASE WINDOW _qm00gaphz
RELEASE WINDOW _qm00gapo4
RELEASE WINDOW queryalq

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     QUERYALQ/MS-DOS Cleanup Code               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 3
=opcli()
=opgar()
=opprp()
IF LAST()#27
   FISC=".T."
   tt='Listado de Alquileres'
   CANT_MAX=20
   DIME TEXTO[CANT_MAX,2], VARIABLE[CANT_MAX], Habilitado[CANT_MAX],habilant[cant_max]
   TEXTO[1,2] =10
   TEXTO[2,2] =10
   TEXTO[3,2] =40
   TEXTO[4,2] =20
   TEXTO[5,2] =10
   TEXTO[6,2]=8
   TEXTO[7,2]=8
   TEXTO[8,2]=30
   TEXTO[9,2]=30
   TEXTO[10,2]=30
   TEXTO[11,2]=30
   TEXTO[12,2]=2
   TEXTO[13,2]=2
   TEXTO[14,2]=8
   TEXTO[15,2]=15
   TEXTO[16,2]=XACDIGI
   TEXTO[17,2]=15
   TEXTO[18,2]=8
   TEXTO[19,2]=2
   TEXTO[20,2]=6
   TEXTO[1,1]='CODIGO INMUEBLE'
   TEXTO[2,1]='TIPO UNIDAD'
   TEXTO[3,1]='DOMICILIO'
   TEXTO[4,1]='PROPIETARIO'
   TEXTO[5,1]='ESTADO'
   TEXTO[6,1]='FECHA ALQUILER'
   TEXTO[7,1]='FECHA VENCIMIENTO'
   TEXTO[8,1]='INQUILINO'
   TEXTO[9,1]='1er GARANTE'
   TEXTO[10,1]='2do GARANTE'
   TEXTO[11,1]='3er GARANTE'
   TEXTO[12,1]='DIA DE PAGO'
   TEXTO[13,1]='MESES CONTRATO'
   TEXTO[14,1]='FIN DE CONTRATO'
   TEXTO[15,1]='TIPO DE ACT.'
   TEXTO[16,1]='MONTO ORIGINAL'
   TEXTO[17,1]='MONEDA'
   TEXTO[18,1]='ULTIMO PAGO'
   TEXTO[19,1]='ASEGURADO'
   TEXTO[20,1]='COMISION'

   store "" to ttque
   store .t. to habilitado
   STORE !XAREC_IMP TO HABILITADO[19], HABILITADO[15], HABILITADO[11]
   IF FILINM=1
      TTQUE=QW_TT("Todos los Inmuebles")
   ELSE
      STORE DATE() TO FECINI,FECFIN
      =qw_UNI(4,27,'INM.CODCLI')
      HABILITADO[2]=qw_TIP(4,52,'INM.TIPOUNID')
      HABILITADO[8]=qw_CLI(8,1 ,'INM.CODCLI')
      store qw_GAR(8,27,'INM.CODGAR') to HABILITADO[9], HABILITADO[10], HABILITADO[11]
      HABILITADO[4]=qw_PRP(8,52,'INM.PROCOD')
      =qw_CIU('INM.LOCALIDAD')
      HABILITADO[5]=qw_EST(12,27,'INM.ESTADO')
      =qw_ACT(20,1,'INM.CODACT')

      STORE FILFIN TO FILFEC
      STORE QUEFIN TO QUEFEC
      STORE IIF(FILFIN#1,2,1) TO FILFIN
      =qw_fec(12,52,'INM.fechaing')
      STORE QUEFEC TO QUEFIN
      STORE FILFEC TO FILFIN

      STORE FILFVE TO FILFEC
      STORE QUEFVE TO QUEFEC
      STORE IIF(FILFVE#1,2,1) TO FILFVE
      HABILITADO[14]=qw_fec(16,2,'INM.fechavenc')
      STORE QUEFEC TO QUEFVE
      STORE FILFEC TO FILFVE

      STORE IIF(FILven#1,2,1) TO FILven
      =qw_ven(16,27,'INM.DIAVENC')

      STORE FILFAL TO FILFEC
      STORE QUEFAL TO QUEFEC
      STORE IIF(FILFAL#1,2,1) TO FILFAL
      =qw_fec(16,52,'INM.fechaalq')
      STORE QUEFEC TO QUEFAL
      STORE FILFEC TO FILFAL

      HABILITADO[15]=qw_act(20,1 ,'INM.codact')
      HABILITADO[17]=qw_mnd(20,27,'INM.moneda')

      ***** FISC
      FISC=qw_FISC(FISC,queinm)
      FISC=qw_FISC(FISC,queuni)
      FISC=qw_FISC(FISC,quetip)
      FISC=qw_FISC(FISC,queCLI)
      FISC=qw_FISC(FISC,quegar)
      FISC=qw_FISC(FISC,queprp)
      FISC=qw_FISC(FISC,queciu)
      FISC=qw_FISC(FISC,queest)
      FISC=qw_FISC(FISC,quefve)
      FISC=qw_FISC(FISC,quefin)
      FISC=qw_FISC(FISC,queven)
      FISC=qw_FISC(FISC,quefal)
      FISC=qw_FISC(FISC,queact)
      FISC=qw_FISC(FISC,quemnd)
      FISC=IIF(EMPTY(FISC),'.T.',FISC)
      ***** TITULOS
      store "Resumen por " to ressu
      TTQUE=QW_TT(ttinm)+QW_TT(ttuni)+QW_TT(tttip)+QW_TT(ttCLI)+;
        QW_TT(ttgar)+QW_TT(ttprp)+QW_TT(ttciu)+QW_TT(ttest)+;
        QW_TT(ttfve)+QW_TT(ttfin)+QW_TT(ttven)+QW_TT(ttfal)+;
        QW_TT(ttmnd)
   ENDIF
   rele wind queryalq
   **** AL FIN LISTADOS
   =acopy(habilitado,habilant)
   do while CFGFAC()
      IF FILFVE=3
         DO RESXFVE
      ELSE
         IF PORPAN
            DO LALQP
         ELSE
            DO LALQI
         ENDIF
         =KTRUCH()
      ENDIF
      store .f. to variable
   ENDdo
   store .f. to variable
   =acopy(habilant,habilitado)
ELSE
   rele wind queryalq
ENDIF
RETURN LAST()#27 .AND. FILINM#2



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*         QUERYALQ/MS-DOS Supporting Procedures and Functions    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 3
PROCEDURE RESXFVE
=WORKING()
TT=ttque
SELE INM
SET ORDER TO TAG FECHAVENC
INDE ON fechavenc TO (GENTMP()) FOR EVAL(FISC) COMP
IF PORPAN
   repo form lALQPrf TO NADA.TMP PDSETUP
ELSE
   repo form lALQirf TO PRIN NOCONSOLE PDSETUP
ENDIF
RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QM00GARTR           m.filinm VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         QINM,     Record Number:    2      
*        Variable:            m.filinm                           
*        Called By:           VALID Clause                       
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qm00gartr     &&  m.filinm VALID
#REGION 1
IF READKEY()=15 .OR. READKEY()=271
   if _curobj=2
      IF ELIINM(-1,1,'')
         if porpan
            SELE INM
            SCAT MEMV
            =movewin(mINMr,mINMc,mINMr+mINMla,mINMc+mINMan,'win'," Muestra Inmueble ")
            STOR 25 TO COL
            DO MINM WITH .T.
            =inkey(nul,'HM')
            =relewin("win")
         else
            do lINMIF
         endif
      ENDIF
   else
      MINOBJ=CEIL(_CUROBJ/3)*3+1
      MAXOBJ=MINOBJ+2
      _CUROBJ=MINOBJ
   endif
ENDIF
RETURN .T.

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _QM00GASCY           m.lista VALID                      
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         QUERYALQ,     Record Number:    4  
*        Variable:            m.lista                            
*        Called By:           VALID Clause                       
*        Snippet Number:      2                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _qm00gascy     &&  m.lista VALID
#REGION 3
IF M.LISTA=1
   =WORKING()
   STORE "     " TO M.RETORNO

   ** VERIFICA LOCALIDAD
   IF !EMPTY(M.LOCALIDAD) .AND. XSEEK(M.LOCALIDAD,"MIX","CIUCOD")
      M.RETORNO=M.RETORNO+"PER.LOCALIDAD="+ALLTRIM(STR(M.LOCALIDAD))+" .AND."
      TT=TT+CHR(13)+CHR(10)+"Por Localidad:"+ALLTRIM(SAYMIX(M.LOCALIDAD,"CIUCOD"))
      HABILITADO[4]=.F.
   ENDIF

   ** VERIFICA NOMBRE
   IF !EMPTY(M.CLIENTE)
      =ADD_FISC(M.CLIENTE,"PER.CLIENTE","Cliente")
   ENDIF

   ** VERIFICA DOMICILIO
   IF !EMPTY(M.DOMICILIO)
      =ADD_FISC(M.DOMICILIO,"PER.DOMICILIO","Domicilio")
   ENDIF

   ** VERIFICA TELEFONO
   IF !EMPTY(M.TELEFONO)
      =ADD_FISC(M.TELEFONO,"PER.TELEFONO","Tel괽ono")
   ENDIF

   ** VERIFICA FAX
   IF !EMPTY(M.FAX)
      =ADD_FISC(M.FAX,"PER.FAX","Fax")
   ENDIF


   M.RETORNO=LEFT(M.RETORNO,LEN(M.RETORNO)-5)
   IF EMPTY(M.RETORNO)
      STORE ".T." TO M.RETORNO
   ENDIF
   =UNWORK()
   CLEA READ
ELSE
   IF M.LISTA=2 .OR. LAST()=27
      STORE ".F." TO M.RETORNO
      CLEA READ
   ENDIF
ENDIF
RETURN .T.
